

----STARTUP---- (30 October 2019 23:09:36) as /home/akima/Documents/ing/repo/cuis/CuisUniversity-3938.image!


Object subclass: #Cart
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #Cart category: #'Tus-Libros' stamp: 'fz_md 10/30/2019 23:17:01'!
Object subclass: #Cart
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

----SNAPSHOT----(30 October 2019 23:17:07) CuisUniversity-3938.image priorSource: 14319118!

TestCase subclass: #CartTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #CartTest category: #'Tus-Libros' stamp: 'fz_md 10/30/2019 23:19:36'!
TestCase subclass: #CartTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!CartTest methodsFor: 'nil' stamp: 'fz_md 10/30/2019 23:20:34'!
test01newCartIsEmpty
	|cart|
	
	cart := Cart new.
	
	self assert: cart isEmpty.! !

!testRun: #CartTest #test01newCartIsEmpty stamp: 'fz_md 10/30/2019 23:20:35'!
ERROR!
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:20:41'!
isEmpty
	self shouldBeImplemented.! !
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:20:48' prior: 50777392!
isEmpty
	^true.! !

!testRun: #CartTest #test01newCartIsEmpty stamp: 'fz_md 10/30/2019 23:20:50'!
PASSED!

!testRun: #CartTest #test01newCartIsEmpty stamp: 'fz_md 10/30/2019 23:20:50'!
PASSED!

!testRun: #CartTest #test01newCartIsEmpty stamp: 'fz_md 10/30/2019 23:20:54'!
PASSED!
!CartTest methodsFor: 'tests' stamp: 'fz_md 10/30/2019 23:26:12'!
test02cartWithABookIsNotEmpty
	|cart book|
	
	cart := Cart new.
	
	book := 'ISBN'.
	cart add: 1 copiesOf: book.
	
	self deny: cart isEmpty.! !

!testRun: #CartTest #test02cartWithABookIsNotEmpty stamp: 'fz_md 10/30/2019 23:26:18'!
ERROR!

!testRun: #CartTest #test02cartWithABookIsNotEmpty stamp: 'fz_md 10/30/2019 23:26:18'!
ERROR!
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:26:24'!
add: aSmallInteger copiesOf: aString 
	self shouldBeImplemented.! !

!classDefinition: #Cart category: #'Tus-Libros' stamp: 'fz_md 10/30/2019 23:26:56'!
Object subclass: #Cart
	instanceVariableNames: 'items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:26:55' prior: 50777421!
add: aQuantity copiesOf: aBook
	items add: aBook.! !

!testRun: #CartTest #test02cartWithABookIsNotEmpty stamp: 'fz_md 10/30/2019 23:26:57'!
ERROR!
!Cart methodsFor: 'nil' stamp: 'fz_md 10/30/2019 23:27:33'!
initialize
	items := Set new.! !
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:27:43' prior: 50777440!
initialize
	items := Dictionary new.! !
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:27:58' prior: 50777433!
add: aQuantity copiesOf: aBook
	items at: aBook put: aQuantity.! !

!testRun: #CartTest #test02cartWithABookIsNotEmpty stamp: 'fz_md 10/30/2019 23:28:01'!
FAILURE!

!testRun: #CartTest #test02cartWithABookIsNotEmpty stamp: 'fz_md 10/30/2019 23:28:01'!
FAILURE!
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:28:34' prior: 50777397!
isEmpty
	^items isEmpty! !

!testRun: #CartTest #test01newCartIsEmpty stamp: 'fz_md 10/30/2019 23:28:37'!
PASSED!

!testRun: #CartTest #test02cartWithABookIsNotEmpty stamp: 'fz_md 10/30/2019 23:28:37'!
PASSED!
!CartTest methodsFor: 'tests' stamp: 'fz_md 10/30/2019 23:42:12'!
test03booksAddedAreContainedInCart
	|cart book|
	
	cart := Cart new.
	
	book := 'ISBN'.
	cart add: 1 copiesOf: book.
	
	self assert: (cart has: book).! !

!testRun: #CartTest #test03booksAddedAreContainedInCart stamp: 'fz_md 10/30/2019 23:42:14'!
ERROR!
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:42:19'!
has: aString 
	self shouldBeImplemented.! !
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:42:42' prior: 50777481!
has: aBook
	^true! !

!testRun: #CartTest #test03booksAddedAreContainedInCart stamp: 'fz_md 10/30/2019 23:42:43'!
PASSED!

!testRun: #CartTest #test01newCartIsEmpty stamp: 'fz_md 10/30/2019 23:42:43'!
PASSED!

!testRun: #CartTest #test02cartWithABookIsNotEmpty stamp: 'fz_md 10/30/2019 23:42:43'!
PASSED!

!testRun: #CartTest #test03booksAddedAreContainedInCart stamp: 'fz_md 10/30/2019 23:42:43'!
PASSED!
!CartTest methodsFor: 'tests' stamp: 'fz_md 10/30/2019 23:43:02'!
test04booksNotAddedAreNotContainedInCart
	|cart book|
	
	cart := Cart new.
	
	book := 'ISBN'.
	cart add: 1 copiesOf: book.
	
	self assert: (cart has: book).! !
!CartTest methodsFor: 'tests' stamp: 'fz_md 10/30/2019 23:43:27' prior: 50777501!
test04booksNotAddedAreNotContainedInCart
	|cart addedBook|
	
	cart := Cart new.
	
	addedBook := 'ISBN'.
	cart add: 1 copiesOf: addedBook.
	
	self assert: (cart has: addedBook).! !
!CartTest methodsFor: 'tests' stamp: 'fz_md 10/30/2019 23:43:59' prior: 50777509!
test04booksNotAddedAreNotContainedInCart
	|cart addedBook notAddedBook|
	
	cart := Cart new.
	
	addedBook := 'ISBN1'.
	notAddedBook := 'ISBN1'.
	cart add: 1 copiesOf: addedBook.
	
	self assert: (cart has: addedBook).
	self deny: (cart has: notAddedBook).! !

!testRun: #CartTest #test04booksNotAddedAreNotContainedInCart stamp: 'fz_md 10/30/2019 23:44:00'!
FAILURE!

----End fileIn of /home/akima/Documents/ing/repo/cuis/Packages/TerseGuide.pck.st----!
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:45:40' prior: 50777486!
has: aBook
	^items includesKey: aBook! !

!testRun: #CartTest #test04booksNotAddedAreNotContainedInCart stamp: 'fz_md 10/30/2019 23:45:41'!
FAILURE!
!CartTest methodsFor: 'tests' stamp: 'fz_md 10/30/2019 23:45:52' prior: 50777518!
test04booksNotAddedAreNotContainedInCart
	|cart addedBook notAddedBook|
	
	cart := Cart new.
	
	addedBook := 'ISBN1'.
	notAddedBook := 'ISBN1'.
	
	cart add: 1 copiesOf: addedBook.
	
	self assert: (cart has: addedBook).
	self deny: (cart has: notAddedBook).! !

!testRun: #CartTest #test04booksNotAddedAreNotContainedInCart stamp: 'fz_md 10/30/2019 23:45:53'!
FAILURE!
!CartTest methodsFor: 'tests' stamp: 'fz_md 10/30/2019 23:46:21' prior: 50780552!
test04booksNotAddedAreNotContainedInCart
	|cart addedBook notAddedBook|
	
	cart := Cart new.
	
	addedBook := 'ISBN1'.
	notAddedBook := 'ISBN2'.
	
	cart add: 1 copiesOf: addedBook.
	
	self assert: (cart has: addedBook).
	self deny: (cart has: notAddedBook).! !

!testRun: #CartTest #test04booksNotAddedAreNotContainedInCart stamp: 'fz_md 10/30/2019 23:46:22'!
PASSED!

!testRun: #CartTest #test01newCartIsEmpty stamp: 'fz_md 10/30/2019 23:46:22'!
PASSED!

!testRun: #CartTest #test02cartWithABookIsNotEmpty stamp: 'fz_md 10/30/2019 23:46:22'!
PASSED!

!testRun: #CartTest #test03booksAddedAreContainedInCart stamp: 'fz_md 10/30/2019 23:46:22'!
PASSED!

!testRun: #CartTest #test04booksNotAddedAreNotContainedInCart stamp: 'fz_md 10/30/2019 23:46:22'!
PASSED!
!CartTest methodsFor: 'tests' stamp: 'fz_md 10/30/2019 23:51:28'!
test05listingOfAnEmptyCartIsEmpty
	|cart|
	
	cart := Cart new.
	
	self assert: cart list equals: ''! !

!testRun: #CartTest #test05listingOfAnEmptyCartIsEmpty stamp: 'fz_md 10/30/2019 23:51:30'!
ERROR!
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:51:34'!
list
	self shouldBeImplemented.! !
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:51:42' prior: 50780602!
list
	^''! !

!testRun: #CartTest #test05listingOfAnEmptyCartIsEmpty stamp: 'fz_md 10/30/2019 23:51:43'!
PASSED!

!testRun: #CartTest #test01newCartIsEmpty stamp: 'fz_md 10/30/2019 23:51:43'!
PASSED!

!testRun: #CartTest #test02cartWithABookIsNotEmpty stamp: 'fz_md 10/30/2019 23:51:43'!
PASSED!

!testRun: #CartTest #test03booksAddedAreContainedInCart stamp: 'fz_md 10/30/2019 23:51:43'!
PASSED!

!testRun: #CartTest #test04booksNotAddedAreNotContainedInCart stamp: 'fz_md 10/30/2019 23:51:43'!
PASSED!

!testRun: #CartTest #test05listingOfAnEmptyCartIsEmpty stamp: 'fz_md 10/30/2019 23:51:43'!
PASSED!
!CartTest methodsFor: 'tests' stamp: 'fz_md 10/30/2019 23:52:12'!
test06listingOfACartHasOnlyContainedBooks
	|cart|
	
	cart := Cart new.
	
	self assert: cart list equals: ''! !
!CartTest methodsFor: 'tests' stamp: 'fz_md 10/30/2019 23:53:22' prior: 50780627!
test06listingOfACartHasOnlyContainedBooks
	|cart addedBook notAddedBook|
	
	cart := Cart new.
	
	addedBook := 'ISBN1'.
	notAddedBook := 'ISBN2'.
	
	cart add: 1 copiesOf: addedBook.
	
	self assert: cart list equals: (addedBook, '|1')! !
!CartTest methodsFor: 'tests' stamp: 'fz_md 10/30/2019 23:53:40' prior: 50780634!
test06listingOfACartHasOnlyContainedBooks
	|cart addedBook|
	
	cart := Cart new.
	
	addedBook := 'ISBN1'.
	
	cart add: 1 copiesOf: addedBook.
	
	self assert: cart list equals: (addedBook, '|1')! !

!testRun: #CartTest #test06listingOfACartHasOnlyContainedBooks stamp: 'fz_md 10/30/2019 23:53:42'!
FAILURE!
!Cart methodsFor: 'as yet unclassified' stamp: 'fz_md 10/30/2019 23:55:47' prior: 50780606!
list
	|listing|
	listing := ''.
	items keysAndValuesDo: [:aKey :aValue | listing := listing, aKey, '|', aValue asString].
	
	^listing.! !

!testRun: #CartTest #test06listingOfACartHasOnlyContainedBooks stamp: 'fz_md 10/30/2019 23:55:48'!
PASSED!

!testRun: #CartTest #test01newCartIsEmpty stamp: 'fz_md 10/30/2019 23:55:48'!
PASSED!

!testRun: #CartTest #test02cartWithABookIsNotEmpty stamp: 'fz_md 10/30/2019 23:55:48'!
PASSED!

!testRun: #CartTest #test03booksAddedAreContainedInCart stamp: 'fz_md 10/30/2019 23:55:48'!
PASSED!

!testRun: #CartTest #test04booksNotAddedAreNotContainedInCart stamp: 'fz_md 10/30/2019 23:55:48'!
PASSED!

!testRun: #CartTest #test05listingOfAnEmptyCartIsEmpty stamp: 'fz_md 10/30/2019 23:55:48'!
PASSED!

!testRun: #CartTest #test06listingOfACartHasOnlyContainedBooks stamp: 'fz_md 10/30/2019 23:55:48'!
PASSED!

!testRun: #CartTest #test01newCartIsEmpty stamp: 'fz_md 10/30/2019 23:55:54'!
PASSED!

!testRun: #CartTest #test02cartWithABookIsNotEmpty stamp: 'fz_md 10/30/2019 23:55:54'!
PASSED!

!testRun: #CartTest #test03booksAddedAreContainedInCart stamp: 'fz_md 10/30/2019 23:55:54'!
PASSED!

!testRun: #CartTest #test04booksNotAddedAreNotContainedInCart stamp: 'fz_md 10/30/2019 23:55:54'!
PASSED!

!testRun: #CartTest #test05listingOfAnEmptyCartIsEmpty stamp: 'fz_md 10/30/2019 23:55:54'!
PASSED!

!testRun: #CartTest #test06listingOfACartHasOnlyContainedBooks stamp: 'fz_md 10/30/2019 23:55:54'!
PASSED!

----SNAPSHOT----(30 October 2019 23:58:18) CuisUniversity-3938.image priorSource: 14263027!

----QUIT----(30 October 2019 23:58:20) CuisUniversity-3938.image priorSource: 14369731!

----STARTUP---- (4 November 2019 17:40:32) as /home/fzanollo/Documents/ing/repo/cuis/CuisUniversity-3938.image!


!classRemoval: #Cart stamp: 'fz_md 11/4/2019 17:40:55'!
Object subclass: #Cart
	instanceVariableNames: 'items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classRemoval: #CartTest stamp: 'fz_md 11/4/2019 17:40:55'!
TestCase subclass: #CartTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

----End fileIn of /home/fzanollo/Documents/ing/repo/25-TusLibros_E2/TusLibros.st----!

TestCase subclass: #Cashier
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #Cashier category: #TusLibros stamp: 'fz_md 11/4/2019 17:41:40'!
TestCase subclass: #Cashier
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'nil' stamp: 'fz_md 11/4/2019 17:43:16'!
test01cannotCheckoutEmptyCart! !

!classDefinition: #Cashier category: #TusLibros stamp: 'fz_md 11/4/2019 17:51:59'!
Object subclass: #Cashier
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 17:51:37' prior: 50780921!
test01cannotCheckoutEmptyCart
	
	self should: [Cashier toCheckout: Cart new] 
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier cannotCheckoutEmptyCart]! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 17:52:37' prior: 50780932!
test01cannotCheckoutEmptyCart
	
	self should: [Cashier toCheckout: Cart new] 
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart]! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 17:52:43'!
test01canNotCheckoutEmptyCart
	
	self should: [Cashier toCheckout: Cart new] 
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart]! !

!methodRemoval: CashierTest #test01cannotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 17:52:43'!
test01cannotCheckoutEmptyCart
	
	self should: [Cashier toCheckout: Cart new] 
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart]!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 17:52:48'!
ERROR!
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 17:52:55'!
toCheckout: aCart 
	"DO NOT FORGET TO RENAME COLLABORATORS AND REMOVE THIS COMMENT!!!!"
	self shouldBeImplemented.
	^self new initializeToCheckout: aCart ! !
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 17:53:11' prior: 50780975!
toCheckout: aCart 
	^self new initializeToCheckout: aCart ! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 17:53:13'!
ERROR!

!classDefinition: #Cashier category: #TusLibros stamp: 'fz_md 11/4/2019 17:53:27'!
Object subclass: #Cashier
	instanceVariableNames: 'cart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 17:53:27'!
initializeToCheckout: aCart 
	self shouldBeImplemented.
	cart := aCart.! !
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 17:57:09' prior: 50780997!
initializeToCheckout: aCart 
	cart := aCart.! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 17:57:12'!
FAILURE!
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 17:58:00' prior: 50780983!
toCheckout: aCart 
	aCart isEmpty ifTrue:[^self error: self canNotCheckoutEmptyCart].
	^self new initializeToCheckout: aCart ! !
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 17:58:05' prior: 50781011!
toCheckout: aCart 
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	^self new initializeToCheckout: aCart ! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 17:58:06'!
ERROR!
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 17:58:42' prior: 50781019!
toCheckout: aCart 
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	^self new initializeToCheckout: aCart ! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 17:58:46'!
ERROR!
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 18:00:24' prior: 50780952!
test01canNotCheckoutEmptyCart
	"refactorizar la parte de llamar a cartTest, no?"
	
	self should: [Cashier toCheckout: (CartTest new createCart)] 
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart]! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 18:00:26'!
ERROR!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 18:00:37'!
ERROR!
!Cashier class methodsFor: 'error messages' stamp: 'fz_md 11/4/2019 18:01:01'!
canNotCheckoutEmptyCart
	self shouldBeImplemented.! !
!Cashier class methodsFor: 'error messages' stamp: 'fz_md 11/4/2019 18:01:13' prior: 50781059!
canNotCheckoutEmptyCart
	^'can not checkout an empty cart'! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 18:01:14'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 18:01:14'!
PASSED!
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 18:07:56' prior: 50781041!
test01canNotCheckoutEmptyCart
	"refactorizar la parte de llamar a cartTest, no?"
	
	self should: [Cashier toCheckout: (CartTest new createCart)]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart]! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 18:14:12' prior: 50781076!
test01canNotCheckoutEmptyCart
	"refactorizar la parte de llamar a cartTest, no?"
	|salesBook|
	
	salesBook := OrderedCollection new.
	
	self should: [Cashier toCheckout: (CartTest new createCart) registerOn: salesBook]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: salesBook isEmpty]! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 18:14:15'!
ERROR!
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 18:14:49'!
toCheckout: aCart registerOn: anOrderedCollection 
	"DO NOT FORGET TO RENAME COLLABORATORS AND REMOVE THIS COMMENT!!!!"
	self shouldBeImplemented.
	^self new initializeToCheckout: aCart registerOn: anOrderedCollection ! !
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 18:15:03' prior: 50781107!
toCheckout: aCart registerOn: aSalesBook 
	^self new initializeToCheckout: aCart registerOn: aSalesBook ! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 18:15:05'!
ERROR!

!classDefinition: #Cashier category: #TusLibros stamp: 'fz_md 11/4/2019 18:15:17'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 18:15:17'!
initializeToCheckout: aCart registerOn: aSalesBook 
	self shouldBeImplemented.
	cart := aCart.
	salesBook := aSalesBook.! !
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 18:15:20' prior: 50781133!
initializeToCheckout: aCart registerOn: aSalesBook 
	cart := aCart.
	salesBook := aSalesBook.! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 18:15:22'!
FAILURE!
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 18:15:45' prior: 50781117!
toCheckout: aCart registerOn: aSalesBook 
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	^self new initializeToCheckout: aCart registerOn: aSalesBook ! !

!methodRemoval: Cashier class #toCheckout: stamp: 'fz_md 11/4/2019 18:15:48'!
toCheckout: aCart 
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	^self new initializeToCheckout: aCart !

!methodRemoval: Cashier #initializeToCheckout: stamp: 'fz_md 11/4/2019 18:15:54'!
initializeToCheckout: aCart 
	cart := aCart.!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 18:15:58'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 18:15:58'!
PASSED!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 18:18:06'!
test02TotalCheckoutAmmountIsCorrect
	| cartTester cart cashier |
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	cart := cartTester createCart.
	cart add: CartTest itemSellByTheStore.
	
	cashier :=  Cashier toCheckout: cart.
	
	self assert: (cashier checkout) equals: 10.! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:41:21'!
ERROR!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:41:21'!
ERROR!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 18:42:00' prior: 50781175!
test02TotalCheckoutAmmountIsCorrect
	| cartTester cart cashier |
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	cashier :=  Cashier toCheckout: cart.
	
	self assert: (cashier checkout) equals: 10.! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:42:01'!
ERROR!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 18:42:48' prior: 50781194!
test02TotalCheckoutAmmountIsCorrect
	| cartTester cart cashier salesBook |
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook.
	
	self assert: (cashier checkout) equals: 10.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 18:43:12' prior: 50781210!
test02TotalCheckoutAmmountIsCorrect
	| cartTester cart cashier salesBook |
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook.
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook at:0) equals: 10.! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:43:15'!
ERROR!
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 18:43:23'!
checkout
	self shouldBeImplemented.! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 18:45:18' prior: 50781244!
checkout
	self shouldBeImplemented.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 18:47:06' prior: 50781225!
test02TotalCheckoutAmmountIsCorrect
	| cartTester cart cashier salesBook |
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: (Dictionary new; at: cartTester itemSellByTheStore put: 10).
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook at:0) equals: 10.! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:47:12'!
ERROR!
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 18:49:50'!
toCheckout: aCart registerOn: aSalesBook priceList: aPriceList  
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	^self new initializeToCheckout: aCart registerOn: aSalesBook ! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 18:49:50' prior: 50781088!
test01canNotCheckoutEmptyCart
	"refactorizar la parte de llamar a cartTest, no?"
	|salesBook|
	
	salesBook := OrderedCollection new.
	
	self should: [Cashier toCheckout: (CartTest new createCart) registerOn: salesBook priceList: Dictionary new]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: salesBook isEmpty]! !

!methodRemoval: Cashier class #toCheckout:registerOn: stamp: 'fz_md 11/4/2019 18:49:50'!
toCheckout: aCart registerOn: aSalesBook 
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	^self new initializeToCheckout: aCart registerOn: aSalesBook !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:50:00'!
ERROR!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 18:51:14' prior: 50781253!
test02TotalCheckoutAmmountIsCorrect
	| cartTester cart cashier salesBook priceList|
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList.
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook at:0) equals: 10.! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:51:16'!
ERROR!
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 18:52:24'!
initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList  
	cart := aCart.
	salesBook := aSalesBook.! !
!Cashier class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 18:52:24' prior: 50781274!
toCheckout: aCart registerOn: aSalesBook priceList: aPriceList  
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	^self new initializeToCheckout: aCart registerOn: aSalesBook priceList: Dictionary new ! !

!methodRemoval: Cashier #initializeToCheckout:registerOn: stamp: 'fz_md 11/4/2019 18:52:24'!
initializeToCheckout: aCart registerOn: aSalesBook 
	cart := aCart.
	salesBook := aSalesBook.!
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 18:52:36' prior: 50781342!
toCheckout: aCart registerOn: aSalesBook priceList: aPriceList  
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList ! !

!classDefinition: #Cashier category: #TusLibros stamp: 'fz_md 11/4/2019 18:52:58'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook priceList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 18:52:56' prior: 50781335!
initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList  
	cart := aCart.
	salesBook := aSalesBook.
	priceList := aPriceList.! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:53:00'!
ERROR!
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 18:56:12' prior: 50781249!
checkout
	^ cart items inject: 0 into: [:totalValue :item | totalValue + priceList at:item]! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:56:16'!
ERROR!
!Cart methodsFor: 'REFACTORIZAR' stamp: 'fz_md 11/4/2019 18:56:29'!
items
	self shouldBeImplemented.
	^items! !
!Cart methodsFor: 'REFACTORIZAR' stamp: 'fz_md 11/4/2019 18:56:53' prior: 50781395!
items
	^items! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:56:55'!
ERROR!
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 18:58:00' prior: 50781386!
checkout
	|totalCheckout|
	
	totalCheckout := cart items inject: 0 into: [:totalValue :item | totalValue + priceList at:item].
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:58:03'!
ERROR!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 18:58:21' prior: 50781312!
test02TotalCheckoutAmmountIsCorrect
	| cartTester cart cashier salesBook priceList|
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList.
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook top) equals: 10.! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:58:23'!
ERROR!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 18:58:38' prior: 50781418!
test02TotalCheckoutAmmountIsCorrect
	| cartTester cart cashier salesBook priceList|
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList.
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook first) equals: 10.! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:58:39'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 18:58:39'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 18:58:39'!
PASSED!

----SNAPSHOT----(4 November 2019 18:58:43) CuisUniversity-3938.image priorSource: 14369824!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:01:01'!
test03cannotCheckoutWithExpiredCreditCard
	| cartTester cart cashier salesBook priceList|
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList.
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook first) equals: 10.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:03:44' prior: 50781473!
test03cannotCheckoutWithExpiredCreditCard
	| cartTester cart cashier salesBook priceList aCreditCard |
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList withCreditCard: aCreditCard.
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook first) equals: 10.! !

!classDefinition: #CreditCard category: #TusLibros stamp: 'fz_md 11/4/2019 19:05:53'!
Object subclass: #CreditCard
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:05:46' prior: 50781493!
test03cannotCheckoutWithExpiredCreditCard
	| cartTester cart cashier salesBook priceList aCreditCard |
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	aCreditCard := CreditCard new.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList withCreditCard: aCreditCard.
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook first) equals: 10.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:10:36' prior: 50781521!
test03cannotCheckoutWithExpiredCreditCard
	| cartTester cart cashier salesBook priceList aCreditCard |
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	aCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2004 monthNumber:1).
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList withCreditCard: aCreditCard onDay: (FixedGregorianDate yearNumber: 2004 monthNumber: 1 dayNumber: 1).
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook first) equals: 10.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:12:35' prior: 50781543!
test03cannotCheckoutWithExpiredCreditCard
	| cartTester cart cashier salesBook priceList aCreditCard |
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	aCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList withCreditCard: aCreditCard onDay: (FixedGregorianDate yearNumber: 2004 monthNumber: 1 dayNumber: 1).
	
	self should: [Cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: salesBook isEmpty]! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:12:44' prior: 50781569!
test03cannotCheckoutWithExpiredCreditCard
	| cartTester cart cashier salesBook priceList aCreditCard |
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	aCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList withCreditCard: aCreditCard onDay: (FixedGregorianDate yearNumber: 2004 monthNumber: 1 dayNumber: 1).
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: salesBook isEmpty]! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:13:11' prior: 50781599!
test03cannotCheckoutWithExpiredCreditCard
	| cartTester cart cashier salesBook priceList aCreditCard |
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	aCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList withCreditCard: aCreditCard onDay: (FixedGregorianDate yearNumber: 2004 monthNumber: 1 dayNumber: 1).
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutWIthExpiredCreditCard.
								self assert: salesBook isEmpty]! !

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:13:18'!
ERROR!
!CreditCard class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 19:13:27'!
expiresOn: aGregorianMonthOfYear 
	"DO NOT FORGET TO RENAME COLLABORATORS AND REMOVE THIS COMMENT!!!!"
	self shouldBeImplemented.
	^self new initializeExpiresOn: aGregorianMonthOfYear ! !
!CreditCard class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 19:13:44' prior: 50781663!
expiresOn: aGregorianMonthOfYear 
	^self new initializeExpiresOn: aGregorianMonthOfYear ! !
!CreditCard class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 19:13:56' prior: 50781673!
expiresOn: expirationDate 
	^self new initializeExpiresOn: expirationDate ! !

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:14:01'!
ERROR!

!classDefinition: #CreditCard category: #TusLibros stamp: 'fz_md 11/4/2019 19:14:11'!
Object subclass: #CreditCard
	instanceVariableNames: 'expirationDate_CHANGE_ME'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CreditCard methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 19:14:11'!
initializeExpiresOn: expirationDate 
	self shouldBeImplemented.
	expirationDate_CHANGE_ME := expirationDate.! !
!CreditCard methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 19:14:15' prior: 50781696!
initializeExpiresOn: expirationDate 
	
	expirationDate_CHANGE_ME := expirationDate.! !
!CreditCard methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 19:14:53' prior: 50781703!
initializeExpiresOn: anExpirationDate 
	! !

!classDefinition: #CreditCard category: #TusLibros stamp: 'fz_md 11/4/2019 19:14:56'!
Object subclass: #CreditCard
	instanceVariableNames: 'expirationDate_CHANGE_ME expirationDate'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CreditCard methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 19:14:55' prior: 50781709!
initializeExpiresOn: anExpirationDate 
	
	expirationDate := anExpirationDate.! !

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:14:57'!
ERROR!
!Cashier class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:15:26'!
toCheckout: aCart registerOn: anOrderedCollection priceList: aDictionary withCreditCard: aCreditCard onDay: aFixedGregorianDate 
	self shouldBeImplemented.! !
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 19:17:14'!
toCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard   
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList ! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:17:14' prior: 50781284!
test01canNotCheckoutEmptyCart
	"refactorizar la parte de llamar a cartTest, no?"
	|salesBook|
	
	salesBook := OrderedCollection new.
	
	self should: [Cashier toCheckout: (CartTest new createCart) registerOn: salesBook priceList: Dictionary new withCreditCard: ((CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1)))]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: salesBook isEmpty]! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:17:15' prior: 50781441!
test02TotalCheckoutAmmountIsCorrect
	| cartTester cart cashier salesBook priceList|
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList withCreditCard: ((CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1))).
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook first) equals: 10.! !

!methodRemoval: Cashier class #toCheckout:registerOn:priceList: stamp: 'fz_md 11/4/2019 19:17:15'!
toCheckout: aCart registerOn: aSalesBook priceList: aPriceList  
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList !

!methodRemoval: Cashier class #toCheckout:registerOn:priceList:withCreditCard:onDay: stamp: 'fz_md 11/4/2019 19:17:30'!
toCheckout: aCart registerOn: anOrderedCollection priceList: aDictionary withCreditCard: aCreditCard onDay: aFixedGregorianDate 
	self shouldBeImplemented.!
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 19:18:08'!
toCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard onDay: aDay    
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList ! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:18:08' prior: 50781750!
test01canNotCheckoutEmptyCart
	"refactorizar la parte de llamar a cartTest, no?"
	|salesBook|
	
	salesBook := OrderedCollection new.
	
	self should: [Cashier toCheckout: (CartTest new createCart) registerOn: salesBook priceList: Dictionary new withCreditCard: ((CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1))) onDay: ((FixedGregorianDate yearNumber: 2004 monthNumber: 1 dayNumber: 1))]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: salesBook isEmpty]! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:18:08' prior: 50781770!
test02TotalCheckoutAmmountIsCorrect
	| cartTester cart cashier salesBook priceList|
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList withCreditCard: ((CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1))) onDay: ((FixedGregorianDate yearNumber: 2004 monthNumber: 1 dayNumber: 1)).
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook first) equals: 10.! !

!methodRemoval: Cashier class #toCheckout:registerOn:priceList:withCreditCard: stamp: 'fz_md 11/4/2019 19:18:08'!
toCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard   
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList !
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 19:18:42'!
initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard onDay: aDay    
	cart := aCart.
	salesBook := aSalesBook.
	priceList := aPriceList.! !

!methodRemoval: Cashier #initializeToCheckout:registerOn:priceList: stamp: 'fz_md 11/4/2019 19:18:50'!
initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList  
	cart := aCart.
	salesBook := aSalesBook.
	priceList := aPriceList.!
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 19:19:02' prior: 50781811!
toCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard onDay: aDay    
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard onDay: aDay    ! !

!classDefinition: #Cashier category: #TusLibros stamp: 'fz_md 11/4/2019 19:19:24'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook priceList creditCard'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 19:19:22' prior: 50781881!
initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard onDay: aDay    
	cart := aCart.
	salesBook := aSalesBook.
	priceList := aPriceList.
	creditCard := aCreditCard.
	day := aDay.! !

!classDefinition: #Cashier category: #TusLibros stamp: 'fz_md 11/4/2019 19:19:35'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook priceList creditCard date'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 19:19:31' prior: 50781918!
initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard onDay: aDay    
	cart := aCart.
	salesBook := aSalesBook.
	priceList := aPriceList.
	creditCard := aCreditCard.
	date := aDay.! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 19:19:40'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:19:40'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:19:40'!
FAILURE!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:19:40'!
FAILURE!
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:21:24' prior: 50781406!
checkout
	|totalCheckout|
	
	date > creditCard expirationDate ifTrue: [].
	
	totalCheckout := cart items inject: 0 into: [:totalValue :item | totalValue + priceList at:item].
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !
!CreditCard methodsFor: 'nil' stamp: 'fz_md 11/4/2019 19:22:00'!
expirationDate

	^ expirationDate.! !

Object subclass: #CreditCard
	instanceVariableNames: ' expirationDate'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #CreditCard category: #TusLibros stamp: 'fz_md 11/4/2019 19:22:04'!
Object subclass: #CreditCard
	instanceVariableNames: 'expirationDate'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

(GregorianMonthOfYear yearNumber: 2000 monthNumber:1)	 lastDayOfMonth !

|asd|

asd := GregorianMonthOfYear yearNumber: 2000 monthNumber:1.
!

self lastDay !

self lastDayNumber !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:24:26' prior: 50781960!
checkout
	|totalCheckout|
	
	date > creditCard expirationDate ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	
	totalCheckout := cart items inject: 0 into: [:totalValue :item | totalValue + priceList at:item].
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:24:30'!
ERROR!
!Cashier class methodsFor: 'error messages' stamp: 'fz_md 11/4/2019 19:24:39'!
canNotCheckoutWIthExpiredCreditCard
	self shouldBeImplemented.! !
!Cashier class methodsFor: 'error messages' stamp: 'fz_md 11/4/2019 19:24:50' prior: 50782007!
canNotCheckoutWIthExpiredCreditCard
	^'the credit card is no longer valid'! !

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:24:55'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 19:24:55'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:24:55'!
ERROR!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:24:55'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:24:55'!
ERROR!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:25:15' prior: 50781845!
test02TotalCheckoutAmmountIsCorrect
	| cartTester cart cashier salesBook priceList|
	
	salesBook := OrderedCollection new.
	
	"refactorizar esto del cart tester"
	cartTester := CartTest new.
	
	cart := cartTester createCart.
	cart add: cartTester itemSellByTheStore.
	
	priceList := Dictionary new.
	priceList at: cartTester itemSellByTheStore put: 10.
	
	cashier :=  Cashier toCheckout: cart registerOn: salesBook priceList: priceList withCreditCard: ((CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2020 monthNumber:1))) onDay: ((FixedGregorianDate yearNumber: 2004 monthNumber: 1 dayNumber: 1)).
	
	self assert: (cashier checkout) equals: 10.
	self assert: (salesBook first) equals: 10.! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:25:16'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 19:25:22'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:25:22'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:25:22'!
PASSED!
!CashierTest methodsFor: 'nil' stamp: 'fz_md 11/4/2019 19:26:48'!
setUp! !

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 19:27:21'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:27:19' prior: 50781823!
test01canNotCheckoutEmptyCart
	"refactorizar la parte de llamar a cartTest, no?"
	|salesBook|
	
	salesBook := OrderedCollection new.
	
	self should: [Cashier toCheckout: emptyCart registerOn: salesBook priceList: Dictionary new withCreditCard: ((CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1))) onDay: ((FixedGregorianDate yearNumber: 2004 monthNumber: 1 dayNumber: 1))]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: salesBook isEmpty]! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:27:36' prior: 50782072!
setUp
	emptyCart := CartTest new createCart.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:27:44' prior: 50782082!
test01canNotCheckoutEmptyCart
	|salesBook|
	
	salesBook := OrderedCollection new.
	
	self should: [Cashier toCheckout: emptyCart registerOn: salesBook priceList: Dictionary new withCreditCard: ((CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1))) onDay: ((FixedGregorianDate yearNumber: 2004 monthNumber: 1 dayNumber: 1))]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: salesBook isEmpty]! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:27:50' prior: 50782103!
setUp
	"refactorizar la parte de llamar a cartTest"
	
	emptyCart := CartTest new createCart.! !

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 19:28:06'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:28:05' prior: 50782108!
test01canNotCheckoutEmptyCart
	|salesBook|
	
	salesBook := OrderedCollection new.
	
	self should: [Cashier toCheckout: emptyCart registerOn: emptySalesBook priceList: Dictionary new withCreditCard: ((CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1))) onDay: ((FixedGregorianDate yearNumber: 2004 monthNumber: 1 dayNumber: 1))]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: salesBook isEmpty]! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:28:20' prior: 50782128!
setUp
	"refactorizar la parte de llamar a cartTest"
	
	emptyCart := CartTest new createCart.
	emptySalesBook := OrderedCollection new.! !

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 19:29:23'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:29:22' prior: 50782162!
setUp
	"refactorizar la parte de llamar a cartTest"
	
	emptyCart := CartTest new createCart.
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).! !

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 19:29:36'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:29:35' prior: 50782178!
setUp
	"refactorizar la parte de llamar a cartTest"
	
	emptyCart := CartTest new createCart.
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:29:42' prior: 50782197!
setUp
	"refactorizar la parte de llamar a cartTest"
	
	emptyCart := CartTest new createCart.
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).! !

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 19:30:02'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard date'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:30:01' prior: 50782142!
test01canNotCheckoutEmptyCart
	|salesBook|
	
	salesBook := OrderedCollection new.
	
	self should: [Cashier toCheckout: emptyCart registerOn: emptySalesBook priceList: Dictionary new withCreditCard: validCreditCard onDay: date]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: salesBook isEmpty]! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:30:15' prior: 50782211!
setUp
	"refactorizar la parte de llamar a cartTest"
	
	emptyCart := CartTest new createCart.
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	date := FixedGregorianDate yearNumber: 2004 monthNumber: 1 dayNumber: 1.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:30:28' prior: 50782249!
setUp
	"refactorizar la parte de llamar a cartTest"
	
	emptyCart := CartTest new createCart.
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	date := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 19:30:36'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:30:36' prior: 50782265!
setUp
	"refactorizar la parte de llamar a cartTest"
	
	emptyCart := CartTest new createCart.
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:30:36' prior: 50782233!
test01canNotCheckoutEmptyCart
	|salesBook|
	
	salesBook := OrderedCollection new.
	
	self should: [Cashier toCheckout: emptyCart registerOn: emptySalesBook priceList: Dictionary new withCreditCard: validCreditCard onDay: testingDate]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: salesBook isEmpty]! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 19:30:43'!
PASSED!

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 19:32:47'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 19:32:48'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:32:46' prior: 50782291!
setUp
	"refactorizar la parte de llamar a cartTest"
	
	emptyCart := CartTest new createCart.
	
	item := CartTest new itemSellByTheStore.
	cartWithItems := CartTest new createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:32:58' prior: 50782346!
setUp
	"refactorizar la parte de llamar a cartTest"
	item := CartTest new itemSellByTheStore.
	
	emptyCart := CartTest new createCart.
	
	cartWithItems := CartTest new createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !

TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems priceList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 19:34:44'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems pricesList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:34:43' prior: 50782366!
setUp
	"refactorizar la parte de llamar a cartTest"
	item := CartTest new itemSellByTheStore.
	
	emptyCart := CartTest new createCart.
	
	cartWithItems := CartTest new createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.
	
	pricesList := Dictionary new.
	pricesList at: item put: 10.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:36:16' prior: 50782035!
test02TotalCheckoutAmmountIsCorrect
	| cashier|
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook priceList: pricesList withCreditCard: validCreditCard onDay: testingDate.
	
	self assert: (cashier checkout) equals: 10.
	self assert: (emptySalesBook first) equals: 10.! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:36:23'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 19:36:23'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:36:23'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:36:23'!
PASSED!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:36:35' prior: 50782308!
test01canNotCheckoutEmptyCart
	
	self should: [Cashier toCheckout: emptyCart registerOn: emptySalesBook priceList: Dictionary new withCreditCard: validCreditCard onDay: testingDate]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: emptySalesBook isEmpty]! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 19:36:37'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 19:36:37'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:36:37'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:36:37'!
PASSED!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:38:28' prior: 50781629!
test03cannotCheckoutWithExpiredCreditCard
	| cashier|
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook priceList: pricesList withCreditCard: expiredCreditCard onDay: testingDate.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutWIthExpiredCreditCard.
								self assert: emptySalesBook isEmpty]! !

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:38:30'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 19:38:30'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:38:30'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:38:30'!
PASSED!

----SNAPSHOT----(4 November 2019 19:38:34) CuisUniversity-3938.image priorSource: 14394212!

Object subclass: #TusLibrosTestObjectFactory
	instanceVariableNames: 'expirationDate'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #TusLibrosTestObjectFactory category: #TusLibros stamp: 'fz_md 11/4/2019 19:40:02'!
Object subclass: #TusLibrosTestObjectFactory
	instanceVariableNames: 'expirationDate'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!TusLibrosTestObjectFactory methodsFor: 'nil' stamp: 'fz_md 11/4/2019 19:40:49'!
createCart
	
	^Cart acceptingItemsOf: self defaultCatalog! !
!TusLibrosTestObjectFactory methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:40:57'!
defaultCatalog
	
	^ Array with: self itemSellByTheStore! !
!TusLibrosTestObjectFactory methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:41:03'!
itemNotSellByTheStore
	
	^'invalidBook'! !
!TusLibrosTestObjectFactory methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:41:13'!
itemSellByTheStore
	
	^ 'validBook'! !

!methodRemoval: CartTest #itemSellByTheStore stamp: 'fz_md 11/4/2019 19:41:42'!
itemSellByTheStore
	
	^ 'validBook'!
!CartTest methodsFor: 'support' stamp: 'fz_md 11/4/2019 19:42:09'!
itemSellByTheStore
	^TusLibrosTestObjectFactory itemSellByTheStore! !
!TusLibrosTestObjectFactory class methodsFor: 'nil' stamp: 'fz_md 11/4/2019 19:42:38'!
createCart
	
	^Cart acceptingItemsOf: self defaultCatalog! !
!TusLibrosTestObjectFactory class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:42:43'!
defaultCatalog
	
	^ Array with: self itemSellByTheStore! !
!TusLibrosTestObjectFactory class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:42:50'!
itemNotSellByTheStore
	
	^'invalidBook'! !
!TusLibrosTestObjectFactory class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:43:00'!
itemSellByTheStore
	^'valid book'! !
!TusLibrosTestObjectFactory class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:43:07' prior: 50782567!
itemSellByTheStore

	^'validBook'! !

!methodRemoval: TusLibrosTestObjectFactory #createCart stamp: 'fz_md 11/4/2019 19:43:10'!
createCart
	
	^Cart acceptingItemsOf: self defaultCatalog!

!methodRemoval: TusLibrosTestObjectFactory #defaultCatalog stamp: 'fz_md 11/4/2019 19:43:10'!
defaultCatalog
	
	^ Array with: self itemSellByTheStore!

!methodRemoval: TusLibrosTestObjectFactory #itemNotSellByTheStore stamp: 'fz_md 11/4/2019 19:43:10'!
itemNotSellByTheStore
	
	^'invalidBook'!

!methodRemoval: TusLibrosTestObjectFactory #itemSellByTheStore stamp: 'fz_md 11/4/2019 19:43:10'!
itemSellByTheStore
	
	^ 'validBook'!
!CartTest methodsFor: 'support' stamp: 'fz_md 11/4/2019 19:43:46' prior: 50780890!
itemNotSellByTheStore
	
	^TusLibrosTestObjectFactory itemNotSellByTheStore ! !
!CartTest methodsFor: 'support' stamp: 'fz_md 11/4/2019 19:43:52' prior: 50780899!
defaultCatalog
	
	^ TusLibrosTestObjectFactory defaultCatalog ! !
!CartTest methodsFor: 'support' stamp: 'fz_md 11/4/2019 19:43:58' prior: 50780894!
createCart
	
	^TusLibrosTestObjectFactory createCart ! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:44:31' prior: 50782403!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.
	
	pricesList := Dictionary new.
	pricesList at: item put: 10.! !

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 19:45:06'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems pricesList itemPrice'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:45:05' prior: 50782610!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	itemPrice := 10.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.
	
	pricesList := Dictionary new.
	pricesList at: item put: 10.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:45:11' prior: 50782642!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	itemPrice := 10.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.
	
	pricesList := Dictionary new.
	pricesList at: item put: itemPrice.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:45:16' prior: 50782425!
test02TotalCheckoutAmmountIsCorrect
	| cashier|
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook priceList: pricesList withCreditCard: validCreditCard onDay: testingDate.
	
	self assert: (cashier checkout) equals: itemPrice.
	self assert: (emptySalesBook first) equals: itemPrice.! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 19:45:25'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:45:25'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:45:25'!
PASSED!
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:48:00' prior: 50781992!
checkout
	|totalCheckout|
	
	date > creditCard expirationDate ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	
	totalCheckout := cart totalPrice.
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !

!methodRemoval: Cart #items stamp: 'fz_md 11/4/2019 19:48:08'!
items
	^items!
!Cart methodsFor: 'queries' stamp: 'fz_md 11/4/2019 19:48:36'!
totalPrice
	items inject: 0 into: [:totalValue :item | totalValue + catalog at:item].! !
!Cart methodsFor: 'queries' stamp: 'fz_md 11/4/2019 19:48:39' prior: 50782722!
totalPrice
	^items inject: 0 into: [:totalValue :item | totalValue + catalog at:item].! !
!TusLibrosTestObjectFactory class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:49:38' prior: 50782556!
defaultCatalog

	^ Dictionary new; at: self itemSellByTheStore put: 10.! !
!TusLibrosTestObjectFactory class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:49:49' prior: 50782735!
defaultCatalog

	^ Dictionary new; at: self itemSellByTheStore put: self itemPrice.! !
!TusLibrosTestObjectFactory class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:49:57'!
itemPrice
	^10.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:50:32' prior: 50782664!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	itemPrice := TusLibrosTestObjectFactory itemPrice.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.
	
	pricesList := Dictionary new.
	pricesList at: item put: itemPrice.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 19:50:46' prior: 50782752!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !

TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 19:51:07'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Cart methodsFor: 'assertions' stamp: 'fz_md 11/4/2019 19:52:09' prior: 50780747!
assertIsValidItem: anItem

	(catalog includesKey: anItem) ifFalse: [ self error: self invalidItemErrorMessage ]! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'fz_md 11/4/2019 19:52:35'!
ERROR!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'fz_md 11/4/2019 19:52:35'!
ERROR!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'fz_md 11/4/2019 19:52:35'!
ERROR!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'fz_md 11/4/2019 19:52:35'!
ERROR!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'fz_md 11/4/2019 19:52:35'!
ERROR!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'fz_md 11/4/2019 19:52:35'!
ERROR!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'fz_md 11/4/2019 19:52:35'!
ERROR!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'fz_md 11/4/2019 19:52:35'!
ERROR!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'fz_md 11/4/2019 19:52:38'!
ERROR!
!TusLibrosTestObjectFactory class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:53:49' prior: 50782742!
defaultCatalog
	|catalog|
	
	catalog := Dictionary new.
	catalog at: self itemSellByTheStore put: self itemPrice.
	^ catalog ! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'fz_md 11/4/2019 19:53:50'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'fz_md 11/4/2019 19:53:52'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'fz_md 11/4/2019 19:53:52'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'fz_md 11/4/2019 19:53:52'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'fz_md 11/4/2019 19:53:52'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'fz_md 11/4/2019 19:53:52'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'fz_md 11/4/2019 19:53:52'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'fz_md 11/4/2019 19:53:52'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'fz_md 11/4/2019 19:53:52'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 19:53:56'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:53:56'!
FAILURE!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:53:56'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:53:56'!
FAILURE!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:55:04'!
FAILURE!

----SNAPSHOT----(4 November 2019 19:55:14) CuisUniversity-3938.image priorSource: 14427388!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:55:51' prior: 50782687!
test02TotalCheckoutAmmountIsCorrect
	| cashier|
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:57:02' prior: 50782477!
test03cannotCheckoutWithExpiredCreditCard
	| cashier|
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: expiredCreditCard onDay: testingDate.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutWIthExpiredCreditCard.
								self assert: emptySalesBook isEmpty]! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 19:57:12' prior: 50782450!
test01canNotCheckoutEmptyCart
	
	self should: [Cashier toCheckout: emptyCart registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: emptySalesBook isEmpty]! !
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 19:57:48' prior: 50781936!
initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard onDay: aDay    
	cart := aCart.
	salesBook := aSalesBook.
	creditCard := aCreditCard.
	date := aDay.! !
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 19:57:55'!
initializeToCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay    
	cart := aCart.
	salesBook := aSalesBook.
	creditCard := aCreditCard.
	date := aDay.! !
!Cashier class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 19:57:55' prior: 50781898!
toCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard onDay: aDay    
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay    ! !

!methodRemoval: Cashier #initializeToCheckout:registerOn:priceList:withCreditCard:onDay: stamp: 'fz_md 11/4/2019 19:57:55'!
initializeToCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard onDay: aDay    
	cart := aCart.
	salesBook := aSalesBook.
	creditCard := aCreditCard.
	date := aDay.!

Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook creditCard date'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #Cashier category: #TusLibros stamp: 'fz_md 11/4/2019 19:58:01'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook creditCard date'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 19:58:06'!
toCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay    
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay    ! !

!methodRemoval: Cashier class #toCheckout:registerOn:priceList:withCreditCard:onDay: stamp: 'fz_md 11/4/2019 19:58:06'!
toCheckout: aCart registerOn: aSalesBook priceList: aPriceList withCreditCard: aCreditCard onDay: aDay    
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay    !

----SNAPSHOT----(4 November 2019 19:58:17) CuisUniversity-3938.image priorSource: 14440013!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 19:58:20'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 19:58:20'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 19:58:20'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'fz_md 11/4/2019 19:58:22'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'fz_md 11/4/2019 19:58:22'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'fz_md 11/4/2019 19:58:22'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'fz_md 11/4/2019 19:58:22'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'fz_md 11/4/2019 19:58:22'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'fz_md 11/4/2019 19:58:22'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'fz_md 11/4/2019 19:58:22'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'fz_md 11/4/2019 19:58:22'!
PASSED!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:00:58'!
test02TotalCheckoutAmmountIsCorrectAndIsRegistered
	| cashier|
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.! !

!methodRemoval: CashierTest #test02TotalCheckoutAmmountIsCorrect stamp: 'fz_md 11/4/2019 20:00:59'!
test02TotalCheckoutAmmountIsCorrect
	| cashier|
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:01:44'!
test04validCheckoutCallsMP
	| cashier|
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:12:52' prior: 50783090!
test04validCheckoutCallsMP
	| cashier aMP |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate withMerchantProcessor: aMP.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.! !

!classDefinition: #MerchantProcessor category: #TusLibros stamp: 'fz_md 11/4/2019 20:13:51'!
Object subclass: #MerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:13:46' prior: 50783104!
test04validCheckoutCallsMP
	| cashier aMP |
	
	aMP := MerchantProcessor tester.
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate withMerchantProcessor: aMP.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:14:01' prior: 50783126!
test04validCheckoutCallsMP
	| cashier aMP |
	
	aMP := MerchantProcessor newTester.
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate withMerchantProcessor: aMP.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.! !

!testRun: #CashierTest #test04validCheckoutCallsMP stamp: 'fz_md 11/4/2019 20:14:46'!
ERROR!
!MerchantProcessor class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 20:14:51'!
newTester
	"DO NOT FORGET TO RENAME COLLABORATORS AND REMOVE THIS COMMENT!!!!"
	self shouldBeImplemented.
	^self new initializeNewTester! !
!MerchantProcessor class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 20:15:00' prior: 50783161!
newTester
	^self new initializeNewTester! !

!testRun: #CashierTest #test04validCheckoutCallsMP stamp: 'fz_md 11/4/2019 20:15:03'!
ERROR!

!testRun: #CashierTest #test04validCheckoutCallsMP stamp: 'fz_md 11/4/2019 20:15:25'!
ERROR!

!testRun: #CashierTest #test04validCheckoutCallsMP stamp: 'fz_md 11/4/2019 20:15:25'!
ERROR!

!testRun: #CashierTest #test04validCheckoutCallsMP stamp: 'fz_md 11/4/2019 20:16:13'!
ERROR!

!testRun: #CashierTest #test04validCheckoutCallsMP stamp: 'fz_md 11/4/2019 20:16:13'!
ERROR!
!MerchantProcessor class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 20:17:25' prior: 50783169!
newTester
	^self new! !

!testRun: #CashierTest #test04validCheckoutCallsMP stamp: 'fz_md 11/4/2019 20:17:33'!
ERROR!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:23:13' prior: 50783142!
test04validCheckoutCallsMP
	| cashier aMP |
	
	aMP := MerchantProcessor newTester.
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: aMP.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:24:11' prior: 50783196!
test04validCheckoutCallsMP
	| cashier aMP |
	
	aMP := MerchantProcessor new.
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: aMP.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.! !

!methodRemoval: MerchantProcessor class #newTester stamp: 'fz_md 11/4/2019 20:24:16'!
newTester
	^self new!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:25:07' prior: 50783211!
test04validCheckoutCallsMP
	| cashier aMP |
	
	aMP := MerchantProcessor new.
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: aMP.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:25:52'!
test04canNotChargeInvalidCreditCard
	| cashier aMP |
	
	aMP := MerchantProcessor new.
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: aMP.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.! !

!methodRemoval: CashierTest #test04validCheckoutCallsMP stamp: 'fz_md 11/4/2019 20:25:52'!
test04validCheckoutCallsMP
	| cashier aMP |
	
	aMP := MerchantProcessor new.
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: aMP.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:26:30' prior: 50783244!
test04canNotChargeInvalidCreditCard
	| cashier aMP |
	
	aMP := MerchantProcessor new.
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: aMP.
	
	self should: []
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError | ]! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:30:04'!
test04canNotChargeInvalidCreditCardOwner
	| cashier aMP |
	
	aMP := MerchantProcessor new.
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: aMP.
	
	self should: []
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError | ]! !

!methodRemoval: CashierTest #test04canNotChargeInvalidCreditCard stamp: 'fz_md 11/4/2019 20:30:04'!
test04canNotChargeInvalidCreditCard
	| cashier aMP |
	
	aMP := MerchantProcessor new.
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: aMP.
	
	self should: []
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError | ]!

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 20:32:47'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems cardWithInvalidOwnerName'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 20:32:46' prior: 50782776!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	cardWithInvalidOwnerName := CreditCard blankCopyOf: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) scaledBy: 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa'.
		
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 20:33:15' prior: 50783324!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	cardWithInvalidOwnerName := CreditCard blankCopyOf: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) scaledBy: 'tooLongOfAStringlolaaaaaaaaaaaaaaaaaaa'.
		
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 20:34:02' prior: 50783349!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	cardWithInvalidOwnerName := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa'.
		
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 20:34:40' prior: 50783374!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	cardWithInvalidOwnerName := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: 1.
		
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !
!CreditCard class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 20:35:55'!
expiresOn: expirationDate ownedBy: anOwner  
	^self new initializeExpiresOn: expirationDate ! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 20:35:55' prior: 50783399!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1) ownedBy: 'owner'.
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'owner'.
	cardWithInvalidOwnerName := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: 1.
		
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !

!methodRemoval: CreditCard class #expiresOn: stamp: 'fz_md 11/4/2019 20:35:55'!
expiresOn: expirationDate 
	^self new initializeExpiresOn: expirationDate !
!CreditCard class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 20:36:23'!
expiresOn: expirationDate ownedBy: anOwner withNumber: aNumber   
	^self new initializeExpiresOn: expirationDate ! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 20:36:23' prior: 50783431!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	cardWithInvalidOwnerName := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: 1.
		
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !

!methodRemoval: CreditCard class #expiresOn:ownedBy: stamp: 'fz_md 11/4/2019 20:36:23'!
expiresOn: expirationDate ownedBy: anOwner  
	^self new initializeExpiresOn: expirationDate !
!CreditCard class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 20:36:50' prior: 50783462!
expiresOn: expirationDate ownedBy: anOwner withNumber: aNumber   
	^self new initializeExpiresOn: expirationDate ownedBy: anOwner withNumber: aNumber   ! !

!classDefinition: #CreditCard category: #TusLibros stamp: 'fz_md 11/4/2019 20:37:23'!
Object subclass: #CreditCard
	instanceVariableNames: 'expirationDate owner'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #CreditCard category: #TusLibros stamp: 'fz_md 11/4/2019 20:37:24'!
Object subclass: #CreditCard
	instanceVariableNames: 'expirationDate owner number'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CreditCard methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 20:37:22'!
initializeExpiresOn: anExpirationDate ownedBy: anOwner withNumber: aNumber   
	expirationDate := anExpirationDate.
	owner := anOwner.
	number := aNumber.! !

!methodRemoval: CreditCard #initializeExpiresOn: stamp: 'fz_md 11/4/2019 20:37:28'!
initializeExpiresOn: anExpirationDate 
	
	expirationDate := anExpirationDate.!
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 20:37:51' prior: 50782710!
checkout
	|totalCheckout|
	
	date > creditCard expirationDate ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	
	totalCheckout := cart totalPrice.
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 20:38:53' prior: 50783469!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	cardWithInvalidOwnerName := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: 1.
		
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 20:43:24'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems cardWithInvalidOwnerName cardWithInvalidNumber'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 20:39:21' prior: 50783548!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	cardWithInvalidOwnerName := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: 1.
	cardWithInvalidNumber := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: -1.		
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 20:43:28' prior: 50783586!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	cardWithInvalidOwnerName := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: 1.
	cardWithInvalidNumber := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: -1.		
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 20:43:32' prior: 50783618!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	cardWithInvalidOwnerName := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: 1.
	cardWithInvalidNumber := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: -1.
	
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 20:44:14' prior: 50783650!
setUp
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	
	validCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	cardWithInvalidOwnerName := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: 1.
	cardWithInvalidNumber := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2200 monthNumber:1) ownedBy: 'Juan Perez' withNumber: -1.
	
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 20:45:18' prior: 50783682!
setUp
	|validCardDate|
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	
	validCardDate := (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: validCardDate ownedBy: 'owner' withNumber: 1.
	cardWithInvalidOwnerName := CreditCard expiresOn: validCardDate ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: 1.
	cardWithInvalidNumber := CreditCard expiresOn: validCardDate ownedBy: 'Juan Perez' withNumber: -1.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:50:11' prior: 50783287!
test04canNotChargeInvalidCreditCardOwner
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate.
	
	self should: []
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError | ]! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:50:51' prior: 50783744!
test04canNotChargeInvalidCreditCardOwner
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidOwner.
								self assert: emptySalesBook isEmpty]! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:51:11'!
test04canNotCheckoutCreditCardWithInvalidOwner
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidOwner.
								self assert: emptySalesBook isEmpty]! !

!methodRemoval: CashierTest #test04canNotChargeInvalidCreditCardOwner stamp: 'fz_md 11/4/2019 20:51:11'!
test04canNotChargeInvalidCreditCardOwner
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidOwner.
								self assert: emptySalesBook isEmpty]!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz_md 11/4/2019 20:51:14'!
FAILURE!
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 20:51:51' prior: 50783538!
checkout
	|totalCheckout|
	
	creditCard owner size > 30 ifTrue: [self error: self class canNotCheckoutCardWithInvalidOwner].
	date > creditCard expirationDate ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	
	totalCheckout := cart totalPrice.
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz_md 11/4/2019 20:51:53'!
ERROR!
!CreditCard methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 20:52:01'!
owner
	self shouldBeImplemented.
	^owner! !
!CreditCard methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 20:52:03' prior: 50783825!
owner
	^owner! !

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz_md 11/4/2019 20:52:09'!
FAILURE!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:52:25' prior: 50783772!
test04canNotCheckoutCreditCardWithInvalidOwner
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidOwnerName onDay: testingDate.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidOwner.
								self assert: emptySalesBook isEmpty]! !

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz_md 11/4/2019 20:52:27'!
ERROR!
!Cashier class methodsFor: 'error messages' stamp: 'fz_md 11/4/2019 20:52:34'!
canNotCheckoutCardWithInvalidOwner
	self shouldBeImplemented.! !
!Cashier class methodsFor: 'error messages' stamp: 'fz_md 11/4/2019 20:52:47' prior: 50783857!
canNotCheckoutCardWithInvalidOwner
	^'can not checkout card with invalid owner'! !

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz_md 11/4/2019 20:52:48'!
FAILURE!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz_md 11/4/2019 20:53:06'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 20:53:06'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz_md 11/4/2019 20:53:06'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 20:53:06'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz_md 11/4/2019 20:53:06'!
PASSED!

----SNAPSHOT----(4 November 2019 20:53:20) CuisUniversity-3938.image priorSource: 14443932!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 20:58:46'!
test05canNotCheckoutCreditCardWithInvalidNumber
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidNumber onDay: testingDate.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidNumber.
								self assert: emptySalesBook isEmpty]! !

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz_md 11/4/2019 20:58:53'!
FAILURE!
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 20:59:45' prior: 50783808!
checkout
	|totalCheckout|
	
	creditCard number < 0 ifTrue: [self error: self class canNotCheckoutCardWithInvalidNumber].
	creditCard owner size > 30 ifTrue: [self error: self class canNotCheckoutCardWithInvalidOwner].
	date > creditCard expirationDate ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	
	totalCheckout := cart totalPrice.
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz_md 11/4/2019 20:59:47'!
ERROR!
!CreditCard methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 20:59:53'!
number
	self shouldBeImplemented.
	^number! !
!CreditCard methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 20:59:55' prior: 50783931!
number
	^number! !

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz_md 11/4/2019 20:59:58'!
ERROR!
!Cashier class methodsFor: 'error messages' stamp: 'fz_md 11/4/2019 21:00:05'!
canNotCheckoutCardWithInvalidNumber
	self shouldBeImplemented.! !
!Cashier class methodsFor: 'error messages' stamp: 'fz_md 11/4/2019 21:00:17' prior: 50783943!
canNotCheckoutCardWithInvalidNumber
	^'can not checkout card with invalid number'! !

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz_md 11/4/2019 21:00:18'!
FAILURE!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz_md 11/4/2019 21:00:22'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 21:00:24'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz_md 11/4/2019 21:00:24'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 21:00:24'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz_md 11/4/2019 21:00:24'!
PASSED!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz_md 11/4/2019 21:00:24'!
PASSED!

----SNAPSHOT----(4 November 2019 21:00:27) CuisUniversity-3938.image priorSource: 14471603!
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 21:01:03' prior: 50783911!
checkout
	|totalCheckout|
	
	self isValidCreditCard.
	
	totalCheckout := cart totalPrice.
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 21:01:11'!
isValidCreditCard
	creditCard number < 0 ifTrue: [self error: self class canNotCheckoutCardWithInvalidNumber].
	creditCard owner size > 30 ifTrue: [self error: self class canNotCheckoutCardWithInvalidOwner].
	date > creditCard expirationDate ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	! !
!Cashier methodsFor: 'asserts' stamp: 'fz_md 11/4/2019 21:01:36'!
assertValidCreditCard
	creditCard number < 0 ifTrue: [self error: self class canNotCheckoutCardWithInvalidNumber].
	creditCard owner size > 30 ifTrue: [self error: self class canNotCheckoutCardWithInvalidOwner].
	date > creditCard expirationDate ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 21:01:36' prior: 50783983!
checkout
	|totalCheckout|
	
	self assertValidCreditCard.
	
	totalCheckout := cart totalPrice.
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !

!methodRemoval: Cashier #isValidCreditCard stamp: 'fz_md 11/4/2019 21:01:36'!
isValidCreditCard
	creditCard number < 0 ifTrue: [self error: self class canNotCheckoutCardWithInvalidNumber].
	creditCard owner size > 30 ifTrue: [self error: self class canNotCheckoutCardWithInvalidOwner].
	date > creditCard expirationDate ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'fz_md 11/4/2019 21:01:55'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'fz_md 11/4/2019 21:01:55'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'fz_md 11/4/2019 21:01:55'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'fz_md 11/4/2019 21:01:56'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'fz_md 11/4/2019 21:01:56'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'fz_md 11/4/2019 21:01:56'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'fz_md 11/4/2019 21:01:56'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'fz_md 11/4/2019 21:01:56'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 21:01:56'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz_md 11/4/2019 21:01:56'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 21:01:56'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz_md 11/4/2019 21:01:56'!
PASSED!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz_md 11/4/2019 21:01:56'!
PASSED!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 21:04:58'!
test06validPurchaseIsChargedThroughMP
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidNumber onDay: testingDate.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidNumber.
								self assert: emptySalesBook isEmpty]! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 21:05:04' prior: 50784078!
test06validPurchaseIsChargedThroughMP
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidNumber onDay: testingDate.
	
	! !

!classRemoval: #MerchantProcessor stamp: 'fz_md 11/4/2019 21:08:57'!
Object subclass: #MerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Cashier class methodsFor: 'instance creation' stamp: 'fz_md 11/4/2019 21:13:12'!
toCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay through: aMerchantProcessor     
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay    ! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 21:13:12' prior: 50783062!
test02TotalCheckoutAmmountIsCorrectAndIsRegistered
	| cashier|
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self.
	
	self assert: (cashier checkout) equals: TusLibrosTestObjectFactory itemPrice.
	self assert: (emptySalesBook first) equals: TusLibrosTestObjectFactory itemPrice.! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 21:13:12' prior: 50782934!
test01canNotCheckoutEmptyCart
	
	self should: [Cashier toCheckout: emptyCart registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutEmptyCart.
								self assert: emptySalesBook isEmpty]! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 21:13:12' prior: 50783837!
test04canNotCheckoutCreditCardWithInvalidOwner
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidOwnerName onDay: testingDate through: self.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidOwner.
								self assert: emptySalesBook isEmpty]! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 21:13:12' prior: 50784094!
test06validPurchaseIsChargedThroughMP
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidNumber onDay: testingDate through: self.
	
	! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 21:13:12' prior: 50782918!
test03cannotCheckoutWithExpiredCreditCard
	| cashier|
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: expiredCreditCard onDay: testingDate through: self.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutWIthExpiredCreditCard.
								self assert: emptySalesBook isEmpty]! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 21:13:12' prior: 50783891!
test05canNotCheckoutCreditCardWithInvalidNumber
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidNumber onDay: testingDate through: self.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidNumber.
								self assert: emptySalesBook isEmpty]! !

!methodRemoval: Cashier class #toCheckout:registerOn:withCreditCard:onDay: stamp: 'fz_md 11/4/2019 21:13:12'!
toCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay    
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay    !
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 21:13:50'!
initializeToCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay through: aMerchantProcessor     
	cart := aCart.
	salesBook := aSalesBook.
	creditCard := aCreditCard.
	date := aDay.! !
!Cashier class methodsFor: 'as yet unclassified' stamp: 'fz_md 11/4/2019 21:13:50' prior: 50784109!
toCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay through: aMerchantProcessor     
	
	aCart isEmpty ifTrue:[self error: self canNotCheckoutEmptyCart].
	
	^self new initializeToCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay through: aMerchantProcessor    ! !

!methodRemoval: Cashier #initializeToCheckout:registerOn:withCreditCard:onDay: stamp: 'fz_md 11/4/2019 21:13:50'!
initializeToCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay    
	cart := aCart.
	salesBook := aSalesBook.
	creditCard := aCreditCard.
	date := aDay.!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 21:14:34'!
debit: anAmmount from: aCreditCard! !

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 21:15:12'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems cardWithInvalidOwnerName cardWithInvalidNumber merchantProcessorBehaviour'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 21:15:10' prior: 50784256!
debit: anAmmount from: aCreditCard
	merchantProcessorBehaviour value.! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 21:15:36' prior: 50784169!
test06validPurchaseIsChargedThroughMP
	| cashier |
	
	merchantProcessorBehaviour := [].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidNumber onDay: testingDate through: self.
	
	! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 21:15:44' prior: 50783713!
setUp
	|validCardDate|
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	
	validCardDate := (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: validCardDate ownedBy: 'owner' withNumber: 1.
	cardWithInvalidOwnerName := CreditCard expiresOn: validCardDate ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: 1.
	cardWithInvalidNumber := CreditCard expiresOn: validCardDate ownedBy: 'Juan Perez' withNumber: -1.
	
	merchantProcessorBehaviour := []! !

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 21:17:07'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems cardWithInvalidOwnerName cardWithInvalidNumber merchantProcessorBehaviour debitedCard'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 21:17:08'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems cardWithInvalidOwnerName cardWithInvalidNumber merchantProcessorBehaviour debitedCard debitedAmmount'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 21:17:06' prior: 50784277!
test06validPurchaseIsChargedThroughMP
	| cashier |
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		debitedCard := aCreditCard.
		debitedAmmount := anAmmount ].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidNumber onDay: testingDate through: self.
	
	! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 21:17:44' prior: 50784345!
test06validPurchaseIsChargedThroughMP
	| cashier |
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		debitedCard := aCreditCard.
		debitedAmmount := anAmmount ].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidNumber onDay: testingDate through: self.
	cashier checkout.
	
	! !

TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems cardWithInvalidOwnerName cardWithInvalidNumber merchantProcessorBehaviour '
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #CashierTest category: #TusLibros stamp: 'fz_md 11/4/2019 21:17:50'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems cardWithInvalidOwnerName cardWithInvalidNumber merchantProcessorBehaviour'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 21:18:38' prior: 50784358!
test06validPurchaseIsChargedThroughMP
	| cashier debitedCard debitedAmmount|
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		debitedCard := aCreditCard.
		debitedAmmount := anAmmount ].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidNumber onDay: testingDate through: self.
	cashier checkout.
	
	! !
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 21:19:43' prior: 50784393!
test06validPurchaseIsChargedThroughMP
	| cashier debitedCard debitedAmmount ammount|
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		debitedCard := aCreditCard.
		debitedAmmount := anAmmount ].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self.
	ammount := cashier checkout.
	
	self assert: debitedCard equals: validCreditCard.
	self assert: debitedAmmount equals: ammount.! !

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz_md 11/4/2019 21:19:45'!
FAILURE!

!classDefinition: #Cashier category: #TusLibros stamp: 'fz_md 11/4/2019 21:20:26'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook creditCard date merchantProcessor'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Cashier methodsFor: 'initialization' stamp: 'fz_md 11/4/2019 21:20:24' prior: 50784224!
initializeToCheckout: aCart registerOn: aSalesBook withCreditCard: aCreditCard onDay: aDay through: aMerchantProcessor     
	cart := aCart.
	salesBook := aSalesBook.
	creditCard := aCreditCard.
	date := aDay.
	merchantProcessor := aMerchantProcessor! !

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz_md 11/4/2019 21:20:34'!
FAILURE!
!Cashier methodsFor: 'checkout' stamp: 'fz_md 11/4/2019 21:21:09' prior: 50784015!
checkout
	|totalCheckout|
	
	self assertValidCreditCard.
	
	totalCheckout := cart totalPrice.
	merchantProcessor debit: totalCheckout from: creditCard.
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !
!Cashier methodsFor: 'checkout' stamp: 'fz_md 11/4/2019 21:21:11' prior: 50784452!
checkout
	|totalCheckout|
	
	self assertValidCreditCard.
	
	totalCheckout := cart totalPrice.
	
	merchantProcessor debit: totalCheckout from: creditCard.
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz_md 11/4/2019 21:21:20'!
ERROR!
!CashierTest methodsFor: 'fake messages' stamp: 'fz_md 11/4/2019 21:21:54' prior: 50784272!
debit: anAmmount from: aCreditCard
	merchantProcessorBehaviour value: anAmmount value: aCreditCard.! !
!CashierTest methodsFor: 'setUp' stamp: 'fz_md 11/4/2019 21:22:22' prior: 50784288!
setUp
	|validCardDate|
	item := TusLibrosTestObjectFactory itemSellByTheStore.
	
	emptyCart := TusLibrosTestObjectFactory createCart.
	
	cartWithItems := TusLibrosTestObjectFactory createCart.
	cartWithItems add: item.
	
	emptySalesBook := OrderedCollection new.
	testingDate := FixedGregorianDate yearNumber: 2019 monthNumber: 12 dayNumber: 31.
	
	expiredCreditCard := CreditCard expiresOn: (GregorianMonthOfYear yearNumber: 2000 monthNumber:1) ownedBy: 'owner' withNumber: 1.
	
	validCardDate := (GregorianMonthOfYear yearNumber: 2200 monthNumber:1).
	
	validCreditCard := CreditCard expiresOn: validCardDate ownedBy: 'owner' withNumber: 1.
	cardWithInvalidOwnerName := CreditCard expiresOn: validCardDate ownedBy: 'tooLongOfAString_lol_aaaaaaaaaaaaaaaaaa' withNumber: 1.
	cardWithInvalidNumber := CreditCard expiresOn: validCardDate ownedBy: 'Juan Perez' withNumber: -1.
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard|]! !

[]value:1!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz_md 11/4/2019 21:22:42'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz_md 11/4/2019 21:22:44'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz_md 11/4/2019 21:22:44'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz_md 11/4/2019 21:22:44'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz_md 11/4/2019 21:22:44'!
PASSED!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz_md 11/4/2019 21:22:44'!
PASSED!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz_md 11/4/2019 21:22:44'!
PASSED!

----SNAPSHOT----(4 November 2019 21:22:47) CuisUniversity-3938.image priorSource: 14474507!
!CashierTest methodsFor: 'tests' stamp: 'fz_md 11/4/2019 21:23:16' prior: 50784408!
test06validPurchaseIsChargedThroughMP
	| cashier debitedCard debitedAmmount ammount|
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		debitedCard := aCreditCard.
		debitedAmmount := anAmmount ].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self.
	ammount := cashier checkout.
	
	self assert: debitedCard equals: validCreditCard.
	self assert: debitedAmmount equals: ammount.
	
	"test07: el mp se trula"! !

----QUIT----(4 November 2019 21:23:24) CuisUniversity-3938.image priorSource: 14492374!

----STARTUP---- (7 November 2019 13:45:19) as /home/akima/Documents/ing_II/repo/cuis/CuisUniversity-3938.image!

!CashierTest methodsFor: 'tests' stamp: 'fz 11/7/2019 13:47:00'!
test07doesNotCheckoutWhenMPThrowsError
	| cashier |
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: cardWithInvalidNumber onDay: testingDate through: self.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidNumber.
								self assert: emptySalesBook isEmpty]! !
!CashierTest methodsFor: 'tests' stamp: 'fz 11/7/2019 13:47:30' prior: 50784541!
test06validPurchaseIsChargedThroughMP
	| cashier debitedCard debitedAmmount ammount|
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		debitedCard := aCreditCard.
		debitedAmmount := anAmmount ].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self.
	ammount := cashier checkout.
	
	self assert: debitedCard equals: validCreditCard.
	self assert: debitedAmmount equals: ammount.! !
!CashierTest methodsFor: 'tests' stamp: 'fz 11/7/2019 13:48:52' prior: 50784566!
test07doesNotCheckoutWhenMPThrowsError
	| cashier debitedCard debitedAmmount ammount|
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		self error: 'el MP se trul' ].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidNumber.
								self assert: emptySalesBook isEmpty]! !
!CashierTest methodsFor: 'tests' stamp: 'fz 11/7/2019 13:49:11' prior: 50784601!
test07doesNotCheckoutWhenMPThrowsError
	| cashier|
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		self error: 'el MP se trul' ].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidNumber.
								self assert: emptySalesBook isEmpty]! !
!CashierTest methodsFor: 'tests' stamp: 'fz 11/7/2019 13:54:35' prior: 50784621!
test07doesNotCheckoutWhenMPThrowsError
	| cashier|
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		self error: 'el MP se trul' ].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier canNotCheckoutCardWithInvalidNumber.
								self assert: emptySalesBook isEmpty]! !
!CashierTest methodsFor: 'tests' stamp: 'fz 11/7/2019 13:57:32' prior: 50784640!
test07doesNotCheckoutWhenMPThrowsError
	| cashier|
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		self error: 'el MP se trul' ].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier merchantProcessorNotWorkingErrorMessage.
								self assert: emptySalesBook isEmpty]! !

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 13:57:44'!
ERROR!
!Cashier class methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 13:58:04'!
merchantProcessorNotWorkingErrorMessage
	self shouldBeImplemented.! !
!Cashier class methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 13:58:52' prior: 50784682!
merchantProcessorNotWorkingErrorMessage
	^'asd'! !

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 13:58:54'!
FAILURE!
!Cashier methodsFor: 'checkout' stamp: 'fz 11/7/2019 14:01:27' prior: 50784462!
checkout
	|totalCheckout|
	
	self assertValidCreditCard.
	
	totalCheckout := cart totalPrice.
	
	[merchantProcessor debit: totalCheckout from: creditCard] on: Error do:[:error | self error: self class merchantProcessorNotWorkingErrorMessage].
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz 11/7/2019 14:01:33'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:01:33'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz 11/7/2019 14:01:33'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:01:33'!
PASSED!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz 11/7/2019 14:01:33'!
PASSED!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz 11/7/2019 14:01:33'!
PASSED!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:01:33'!
PASSED!
!Cashier class methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 14:02:20'!
merchantProcessorNotWorkingErrorMessage: anErrorDescription
	^'asd'! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 14:02:20' prior: 50784696!
checkout
	|totalCheckout|
	
	self assertValidCreditCard.
	
	totalCheckout := cart totalPrice.
	
	[merchantProcessor debit: totalCheckout from: creditCard] on: Error do:[:error | self error: self class merchantProcessorNotWorkingErrorMessage: ''].
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 14:02:20' prior: 50784659!
test07doesNotCheckoutWhenMPThrowsError
	| cashier|
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		self error: 'el MP se trul' ].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier merchantProcessorNotWorkingErrorMessage: ''.
								self assert: emptySalesBook isEmpty]! !

!methodRemoval: Cashier class #merchantProcessorNotWorkingErrorMessage stamp: 'fz 11/7/2019 14:02:20'!
merchantProcessorNotWorkingErrorMessage
	^'asd'!
!Cashier class methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 14:02:27' prior: 50784732!
merchantProcessorNotWorkingErrorMessage: anErrorDescription
	^anErrorDescription! !
!CashierTest methodsFor: 'tests' stamp: 'fz 11/7/2019 14:03:46' prior: 50784751!
test07doesNotCheckoutWhenMPThrowsError
	| cashier errorDescription |
	
	errorDescription := 'el MP se trul'.
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		self error: errorDescription].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = Cashier merchantProcessorNotWorkingErrorMessage: errorDescription.
								self assert: emptySalesBook isEmpty]! !
!Cashier methodsFor: 'asserts' stamp: 'fz 11/7/2019 14:05:43' prior: 50784002!
assertValidCreditCard
	creditCard number < 0 ifTrue: [self error: self class canNotCheckoutCardWithInvalidNumber].
	creditCard owner size > 30 ifTrue: [self error: self class canNotCheckoutCardWithInvalidOwner].
	(creditCard isExpiredOn: date) ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz 11/7/2019 14:05:49'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:05:49'!
ERROR!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz 11/7/2019 14:05:49'!
ERROR!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:05:49'!
PASSED!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz 11/7/2019 14:05:49'!
PASSED!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz 11/7/2019 14:05:49'!
ERROR!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:05:49'!
ERROR!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:05:52'!
ERROR!
!CreditCard methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 14:06:08'!
isExpiredOn: aFixedGregorianDate 
	self shouldBeImplemented.! !
!CreditCard methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 14:07:17' prior: 50784844!
isExpiredOn: aDate 
	^ aDate > expirationDate ! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:07:18'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz 11/7/2019 14:07:22'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:07:22'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz 11/7/2019 14:07:22'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:07:22'!
PASSED!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz 11/7/2019 14:07:22'!
PASSED!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz 11/7/2019 14:07:22'!
PASSED!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:07:22'!
ERROR!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:07:22'!
ERROR!
!Cashier methodsFor: 'checkout' stamp: 'fz 11/7/2019 14:08:10' prior: 50784738!
checkout
	|totalCheckout|
	
	self assertValidCreditCard.
	
	totalCheckout := cart totalPrice.
	
	[merchantProcessor debit: totalCheckout from: creditCard] on: Error do:[:error | self error: (self class merchantProcessorNotWorkingErrorMessage: error messageText)].
	
	salesBook add: totalCheckout.
	
	^totalCheckout! !

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:08:17'!
ERROR!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:08:17'!
ERROR!
!CashierTest methodsFor: 'tests' stamp: 'fz 11/7/2019 14:08:38' prior: 50784782!
test07doesNotCheckoutWhenMPThrowsError
	| cashier errorDescription |
	
	errorDescription := 'el MP se trul'.
	
	merchantProcessorBehaviour := [:anAmmount :aCreditCard | 
		self error: errorDescription].
	
	cashier :=  Cashier toCheckout: cartWithItems registerOn: emptySalesBook withCreditCard: validCreditCard onDay: testingDate through: self.
	
	self should: [cashier checkout ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError| self assert: anError messageText = (Cashier merchantProcessorNotWorkingErrorMessage: errorDescription).
								self assert: emptySalesBook isEmpty]! !

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:08:40'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz 11/7/2019 14:08:42'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:08:42'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz 11/7/2019 14:08:42'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:08:42'!
PASSED!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz 11/7/2019 14:08:42'!
PASSED!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz 11/7/2019 14:08:42'!
PASSED!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:08:42'!
PASSED!
!Cashier methodsFor: 'asserts' stamp: 'fz 11/7/2019 14:09:20' prior: 50784804!
assertValidCreditCard
	(creditCard isValidNumber) ifTrue: [self error: self class canNotCheckoutCardWithInvalidNumber].
	creditCard owner size > 30 ifTrue: [self error: self class canNotCheckoutCardWithInvalidOwner].
	(creditCard isExpiredOn: date) ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz 11/7/2019 14:09:24'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:09:24'!
ERROR!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz 11/7/2019 14:09:24'!
ERROR!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:09:24'!
ERROR!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz 11/7/2019 14:09:24'!
ERROR!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz 11/7/2019 14:09:24'!
ERROR!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:09:24'!
ERROR!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:09:26'!
ERROR!
!CreditCard methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 14:09:32'!
isValidNumber
	self shouldBeImplemented.! !
!CreditCard methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 14:09:43' prior: 50784991!
isValidNumber
	^number >= 0! !
!CreditCard methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 14:10:13' prior: 50784996!
isValidNumber
	^number >= 0 and:[number isKindOf: Integer]! !

4 isKindOf: Integer!

-4 isKindOf: Integer!

-4.0 isKindOf: Integer!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:10:48'!
ERROR!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:10:49'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz 11/7/2019 14:10:51'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:10:51'!
ERROR!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz 11/7/2019 14:10:51'!
FAILURE!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:10:51'!
FAILURE!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz 11/7/2019 14:10:51'!
FAILURE!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz 11/7/2019 14:10:51'!
ERROR!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:10:51'!
FAILURE!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:10:53'!
ERROR!
!Cashier methodsFor: 'asserts' stamp: 'fz 11/7/2019 14:11:25' prior: 50784951!
assertValidCreditCard
	(creditCard isValidNumber) ifFalse: [self error: self class canNotCheckoutCardWithInvalidNumber].
	creditCard owner size > 30 ifTrue: [self error: self class canNotCheckoutCardWithInvalidOwner].
	(creditCard isExpiredOn: date) ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz 11/7/2019 14:11:28'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:11:28'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz 11/7/2019 14:11:28'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:11:28'!
PASSED!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz 11/7/2019 14:11:28'!
PASSED!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz 11/7/2019 14:11:28'!
PASSED!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:11:28'!
PASSED!
!Cashier methodsFor: 'asserts' stamp: 'fz 11/7/2019 14:11:52' prior: 50785041!
assertValidCreditCard
	(creditCard isValidNumber) ifFalse: [self error: self class canNotCheckoutCardWithInvalidNumber].
	creditCard owner size > 30 ifTrue: [self error: self class canNotCheckoutCardWithInvalidOwner].
	(creditCard isValidOn: date) ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	! !
!Cashier methodsFor: 'asserts' stamp: 'fz 11/7/2019 14:12:16' prior: 50785078!
assertValidCreditCard
	(creditCard isValidNumber) ifFalse: [self error: self class canNotCheckoutCardWithInvalidNumber].
	creditCard owner size > 30 ifTrue: [self error: self class canNotCheckoutCardWithInvalidOwner].
	(creditCard isExpiredOn: date) ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	! !
!Cashier methodsFor: 'asserts' stamp: 'fz 11/7/2019 14:12:57' prior: 50785091!
assertValidCreditCard
	(creditCard isValidNumber) ifFalse: [self error: self class canNotCheckoutCardWithInvalidNumber].
	(creditCard isValidNumber) ifFalse: [self error: self class canNotCheckoutCardWithInvalidOwner].
	(creditCard isExpiredOn: date) ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz 11/7/2019 14:12:59'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:12:59'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz 11/7/2019 14:12:59'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:12:59'!
FAILURE!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz 11/7/2019 14:12:59'!
PASSED!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz 11/7/2019 14:12:59'!
PASSED!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:12:59'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:12:59'!
FAILURE!
!Cashier methodsFor: 'asserts' stamp: 'fz 11/7/2019 14:13:26' prior: 50785104!
assertValidCreditCard
	(creditCard isValidNumber) ifFalse: [self error: self class canNotCheckoutCardWithInvalidNumber].
	(creditCard isValidOwner) ifFalse: [self error: self class canNotCheckoutCardWithInvalidOwner].
	(creditCard isExpiredOn: date) ifTrue: [self error: self class canNotCheckoutWIthExpiredCreditCard ].
	! !

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz 11/7/2019 14:13:29'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:13:29'!
ERROR!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz 11/7/2019 14:13:29'!
ERROR!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:13:29'!
ERROR!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz 11/7/2019 14:13:29'!
PASSED!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz 11/7/2019 14:13:29'!
ERROR!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:13:29'!
ERROR!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:13:31'!
ERROR!
!CreditCard methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 14:13:37'!
isValidOwner
	self shouldBeImplemented.! !
!CreditCard methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 14:13:51' prior: 50785184!
isValidOwner
	^owner size <= 30! !

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:13:54'!
PASSED!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz 11/7/2019 14:13:56'!
PASSED!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz 11/7/2019 14:13:56'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:13:56'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz 11/7/2019 14:13:56'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:13:56'!
PASSED!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz 11/7/2019 14:13:56'!
PASSED!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:13:56'!
PASSED!

!methodRemoval: CreditCard #number stamp: 'fz 11/7/2019 14:14:05'!
number
	^number!

!methodRemoval: CreditCard #owner stamp: 'fz 11/7/2019 14:14:08'!
owner
	^owner!

!methodRemoval: CreditCard #expirationDate stamp: 'fz 11/7/2019 14:14:10'!
expirationDate

	^ expirationDate.!

!testRun: #CashierTest #test01canNotCheckoutEmptyCart stamp: 'fz 11/7/2019 14:14:33'!
PASSED!

!testRun: #CashierTest #test02TotalCheckoutAmmountIsCorrectAndIsRegistered stamp: 'fz 11/7/2019 14:14:33'!
PASSED!

!testRun: #CashierTest #test03cannotCheckoutWithExpiredCreditCard stamp: 'fz 11/7/2019 14:14:33'!
PASSED!

!testRun: #CashierTest #test04canNotCheckoutCreditCardWithInvalidOwner stamp: 'fz 11/7/2019 14:14:33'!
PASSED!

!testRun: #CashierTest #test05canNotCheckoutCreditCardWithInvalidNumber stamp: 'fz 11/7/2019 14:14:33'!
PASSED!

!testRun: #CashierTest #test06validPurchaseIsChargedThroughMP stamp: 'fz 11/7/2019 14:14:33'!
PASSED!

!testRun: #CashierTest #test07doesNotCheckoutWhenMPThrowsError stamp: 'fz 11/7/2019 14:14:33'!
PASSED!

----SNAPSHOT----(7 November 2019 14:16:12) CuisUniversity-3938.image priorSource: 14493086!

----SNAPSHOT----(7 November 2019 16:05:39) CuisUniversity-3938.image priorSource: 14515241!

----SNAPSHOT----(7 November 2019 16:08:35) CuisUniversity-3938.image priorSource: 14515334!

----QUIT----(7 November 2019 16:08:41) CuisUniversity-3938.image priorSource: 14515427!

----STARTUP---- (7 November 2019 19:02:15) as /home/akima/Documents/ing_II/repo/cuis/CuisUniversity-3938.image!


!classRemoval: #TusLibrosTestObjectFactory stamp: 'fz 11/7/2019 19:02:28'!
Object subclass: #TusLibrosTestObjectFactory
	instanceVariableNames: 'expirationDate'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #CreditCard stamp: 'fz 11/7/2019 19:02:28'!
Object subclass: #CreditCard
	instanceVariableNames: 'expirationDate owner number'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #Cashier stamp: 'fz 11/7/2019 19:02:29'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook creditCard date merchantProcessor'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #Cart stamp: 'fz 11/7/2019 19:02:29'!
Object subclass: #Cart
	instanceVariableNames: 'catalog items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #CashierTest stamp: 'fz 11/7/2019 19:02:30'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'emptyCart emptySalesBook expiredCreditCard validCreditCard testingDate item cartWithItems cardWithInvalidOwnerName cardWithInvalidNumber merchantProcessorBehaviour'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #CartTest stamp: 'fz 11/7/2019 19:02:30'!
TestCase subclass: #CartTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

----End fileIn of /home/akima/Documents/ing_II/repo/25-TusLibros/3/TusLibros.st----!

Object subclass: #UserAPI
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/7/2019 19:04:52'!
Object subclass: #UserAPI
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/7/2019 19:05:26'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'no messages' stamp: 'fz 11/7/2019 19:07:03'!
test01CreateCartFailsWithUnknownUser! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:08:09' prior: 50785885!
test01CreateCartFailsWithUnknownUser

	self should: []
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:17:40' prior: 50785890!
test01CreateCartFailsWithUnknownUser

	self should: [UserAPI createCartOf: 'user' withPassword: 'password'.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = Cashier canNotCreateCartWithWongUser. ].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:30:43' prior: 50785897!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI new.
	
	self should: [userAPI createCartOf: 'user' withPassword: 'password'.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = Cashier canNotCreateCartWithWongUser].! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 19:30:51'!
ERROR!
!UserAPI methodsFor: 'API' stamp: 'fz 11/7/2019 19:31:14'!
createCartOf: aString withPassword: aString2 
	self shouldBeImplemented.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:32:07' prior: 50785909!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI new.
	
	self should: [userAPI createCartOf: 'user' withPassword: 'password'.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithWongUser].! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/7/2019 19:32:15' prior: 50785924!
createCartOf: aString withPassword: aString2 
	^ self error: self class canNotCreateCartWithWongUser.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 19:32:18'!
ERROR!
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/7/2019 19:32:32'!
canNotCreateCartWithWongUser
	self shouldBeImplemented.! !
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/7/2019 19:33:20' prior: 50785951!
canNotCreateCartWithWongUser
	^ 'no se pueden crear carritos con usuarios que no esten inscriptos en el sistema'! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 19:33:21'!
ERROR!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 19:33:29'!
PASSED!
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:34:18'!
test01CreatedCartIsEmpty
	|userAPI|
	
	userAPI := UserAPI new.
	
	self should: [userAPI createCartOf: 'user' withPassword: 'password'.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithWongUser].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:34:24'!
test02CreatedCartIsEmpty
	|userAPI|
	
	userAPI := UserAPI new.
	
	self should: [userAPI createCartOf: 'user' withPassword: 'password'.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithWongUser].! !

!methodRemoval: UserAPITest #test01CreatedCartIsEmpty stamp: 'fz 11/7/2019 19:34:24'!
test01CreatedCartIsEmpty
	|userAPI|
	
	userAPI := UserAPI new.
	
	self should: [userAPI createCartOf: 'user' withPassword: 'password'.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithWongUser].!
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:35:52' prior: 50785981!
test02CreatedCartIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI new.
	
	cartID := userAPI createCartOf: 'user' withPassword: 'password'.
	
	self assert: userAPI cartOfID: cartID .! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:36:08' prior: 50786005!
test02CreatedCartIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI new.
	
	cartID := userAPI createCartOf: 'user' withPassword: 'password'.
	
	self assert: (userAPI cartOfID: cartID ).! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:36:25' prior: 50786014!
test02CreatedCartIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI new.
	
	cartID := userAPI createCartOf: 'user' withPassword: 'password'.
	
	self assert: (userAPI cartOfID: cartID isEmpty).! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:39:30'!
test02CartIsCreatedForValidUser
	|userAPI cartID |
	
	userAPI := UserAPI new.
	
	cartID := userAPI createCartOf: 'user' withPassword: 'password'.
	
	self assert: (userAPI cartOfID: cartID isEmpty).! !

!methodRemoval: UserAPITest #test02CreatedCartIsEmpty stamp: 'fz 11/7/2019 19:39:30'!
test02CreatedCartIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI new.
	
	cartID := userAPI createCartOf: 'user' withPassword: 'password'.
	
	self assert: (userAPI cartOfID: cartID isEmpty).!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:39:49'!
test02CartIsCreatedForValidUserAndIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI new.
	
	cartID := userAPI createCartOf: 'user' withPassword: 'password'.
	
	self assert: (userAPI cartOfID: cartID isEmpty).! !

!methodRemoval: UserAPITest #test02CartIsCreatedForValidUser stamp: 'fz 11/7/2019 19:39:49'!
test02CartIsCreatedForValidUser
	|userAPI cartID |
	
	userAPI := UserAPI new.
	
	cartID := userAPI createCartOf: 'user' withPassword: 'password'.
	
	self assert: (userAPI cartOfID: cartID isEmpty).!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:40:05'!
ERROR!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:40:05'!
ERROR!
!UserAPI methodsFor: 'API' stamp: 'fz 11/7/2019 19:40:45' prior: 50785942!
createCartOf: aUser withPassword: aString2 
	^ self error: self class canNotCreateCartWithWongUser.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/7/2019 19:40:51' prior: 50786075!
createCartOf: aUser withPassword: aPassword 
	^ self error: self class canNotCreateCartWithWongUser.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:41:42' prior: 50786050!
test02CartIsCreatedForValidUserAndIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	
	cartID := userAPI createCartOf: 'user' withPassword: 'password'.
	
	self assert: (userAPI cartOfID: cartID isEmpty).! !

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:41:45'!
ERROR!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:41:45'!
ERROR!
!UserAPI class methodsFor: 'instance creation' stamp: 'fz 11/7/2019 19:41:51'!
withUserManager: anUserAPITest 
	"DO NOT FORGET TO RENAME COLLABORATORS AND REMOVE THIS COMMENT!!!!"
	self shouldBeImplemented.
	^self new initializeWithUserManager: anUserAPITest ! !
!UserAPI class methodsFor: 'instance creation' stamp: 'fz 11/7/2019 19:42:13' prior: 50786104!
withUserManager: aUM 
	^self new initializeWithUserManager: aUM ! !

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:42:15'!
ERROR!

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/7/2019 19:42:25'!
Object subclass: #UserAPI
	instanceVariableNames: 'uM'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/7/2019 19:42:25'!
initializeWithUserManager: aUM 
	self shouldBeImplemented.
	uM := aUM.! !
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/7/2019 19:42:29' prior: 50786128!
initializeWithUserManager: aUM 
	uM := aUM.! !

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:42:36'!
ERROR!
!UserAPI methodsFor: 'API' stamp: 'fz 11/7/2019 19:43:54' prior: 50786081!
createCartOf: aUser withPassword: aPassword 
	(uM isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotCreateCartWithWongUser].
	
	^1! !
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/7/2019 19:44:24'!
canNotCreateCartWithWrongUserErrorMessage
	^ 'no se pueden crear carritos con usuarios que no esten inscriptos en el sistema'! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:44:24' prior: 50786141!
createCartOf: aUser withPassword: aPassword 
	(uM isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotCreateCartWithWrongUserErrorMessage].
	
	^1! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:44:24' prior: 50785930!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI new.
	
	self should: [userAPI createCartOf: 'user' withPassword: 'password'.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithWrongUserErrorMessage].! !

!methodRemoval: UserAPI class #canNotCreateCartWithWongUser stamp: 'fz 11/7/2019 19:44:24'!
canNotCreateCartWithWongUser
	^ 'no se pueden crear carritos con usuarios que no esten inscriptos en el sistema'!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:44:27'!
ERROR!
!UserAPITest methodsFor: 'user manager' stamp: 'fz 11/7/2019 19:44:40'!
isValidUser: aString withPassword: aString2 
	self shouldBeImplemented.! !
!UserAPITest methodsFor: 'user manager' stamp: 'fz 11/7/2019 19:44:45' prior: 50786187!
isValidUser: aUser withPassword: aString2 
	self shouldBeImplemented.! !
!UserAPITest methodsFor: 'user manager' stamp: 'fz 11/7/2019 19:44:58' prior: 50786193!
isValidUser: aUser withPassword: aPassword 
	self shouldBeImplemented.! !
!UserAPITest methodsFor: 'user manager' stamp: 'fz 11/7/2019 19:45:06' prior: 50786199!
isValidUser: aUser withPassword: aPassword 
	^true.! !

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:45:07'!
ERROR!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:45:24' prior: 50786087!
test02CartIsCreatedForValidUserAndIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	
	cartID := userAPI createCartOf: 'user' withPassword: 'password'.
	
	self assert: ((userAPI cartOfID: cartID) isEmpty).! !

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:45:25'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:45:32'!
cartOfID: aSmallInteger 
	self shouldBeImplemented.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:46:08' prior: 50786226!
cartOfID: aCartID
	^Cart new.! !

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:46:09'!
ERROR!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:48:46' prior: 50786213!
test02CartIsCreatedForValidUserAndIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	
	cartID := userAPI createCartOf: 'user' withPassword: 'password'.
	
	self assert: (userAPI isValidCartID: cartID).! !

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:48:48'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:48:55'!
isValidCartID: aSmallInteger 
	self shouldBeImplemented.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:49:06' prior: 50786251!
isValidCartID: aCartID 
	^true! !

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:49:07'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 19:49:07'!
ERROR!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:49:07'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 19:49:07'!
ERROR!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:49:17'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 19:49:17'!
ERROR!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:49:17'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 19:49:17'!
ERROR!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:49:21'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:49:31' prior: 50786165!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self.
	
	self should: [userAPI createCartOf: 'user' withPassword: 'password'.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithWrongUserErrorMessage].! !

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:49:34'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 19:49:38'!
FAILURE!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 19:49:38'!
FAILURE!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/7/2019 19:51:05'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:51:04'!
setUp
	usersLog := Dictionary new.
	! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:51:24' prior: 50786320!
setUp
	usersLog := Dictionary new.
	usersLog at: 'validUser' put: 'validUserPasswd'! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:51:34' prior: 50786324!
setUp
	usersLog := Dictionary new.
	usersLog at: 'validUser' put: 'validUserPassword'.! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/7/2019 19:52:17'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/7/2019 19:52:18'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/7/2019 19:52:57'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:52:55' prior: 50786330!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	
	validUserButWrongPassword := 'wrongPassword'.	
	
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword .! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/7/2019 19:53:10'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/7/2019 19:53:11'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:53:10' prior: 50786363!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	
	validUserButWrongPassword := 'wrongPassword'.	
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword .! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:53:14' prior: 50786396!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	
	validUserButWrongPassword := 'wrongPassword'.	
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword .! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:53:29' prior: 50786289!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserPassword .]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithWrongUserErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:53:30' prior: 50786420!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithWrongUserErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:53:37' prior: 50786434!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self.
	
	self should: [userAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithWrongUserErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:53:52' prior: 50786238!
test02CartIsCreatedForValidUserAndIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI isValidCartID: cartID).! !
!UserAPITest methodsFor: 'user manager' stamp: 'fz 11/7/2019 19:54:55' prior: 50786205!
isValidUser: aUser withPassword: aPassword 
	^(usersLog at: aUser ifAbsent: [^false]) = aPassword.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 19:55:02'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 19:55:02'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:56:23'!
test03CreateCartFailsWithWrongPassword
	|userAPI|
	
	userAPI := UserAPI withUserManager: self.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithWrongUserErrorMessage].! !
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/7/2019 19:57:02'!
canNotCreateCartWithInvalidCredentialsErrorMessage
	^ 'no se pueden crear carritos con usuarios que no esten inscriptos en el sistema'! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:57:02' prior: 50786156!
createCartOf: aUser withPassword: aPassword 
	(uM isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotCreateCartWithInvalidCredentialsErrorMessage].
	
	^1! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:57:02' prior: 50786485!
test03CreateCartFailsWithWrongPassword
	|userAPI|
	
	userAPI := UserAPI withUserManager: self.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 19:57:02' prior: 50786448!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self.
	
	self should: [userAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !

!methodRemoval: UserAPI class #canNotCreateCartWithWrongUserErrorMessage stamp: 'fz 11/7/2019 19:57:02'!
canNotCreateCartWithWrongUserErrorMessage
	^ 'no se pueden crear carritos con usuarios que no esten inscriptos en el sistema'!
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/7/2019 19:57:45' prior: 50786499!
canNotCreateCartWithInvalidCredentialsErrorMessage
	^ 'usuario o contrasea invalida'! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 19:58:56'!
test04CreatedCartLIstCartIsEmpty
	|userAPI|
	
	userAPI := UserAPI withUserManager: self.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:00:49' prior: 50786558!
test04CreatedCartLIstCartIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword .
	
	self assert: (userAPI cartOfID: cartID) equals: '0'.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:02:10' prior: 50786572!
test04CreatedCartLIstCartIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword .
	
	self assert: (userAPI cartOfID: cartID) listCart equals: '0'.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:02:29' prior: 50786582!
test04CreatedCartLIstCartIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword .
	
	self assert: (userAPI cartOfID: cartID) listCart isEmpty.! !

!testRun: #UserAPITest #test04CreatedCartLIstCartIsEmpty stamp: 'fz 11/7/2019 20:02:42'!
ERROR!

!testRun: #UserAPITest #test04CreatedCartLIstCartIsEmpty stamp: 'fz 11/7/2019 20:02:42'!
ERROR!
!Cart methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:03:04'!
listCart
	self shouldBeImplemented.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:03:43' prior: 50786593!
test04CreatedCartLIstCartIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword .
	
	self assert: (userAPI cartOfID: cartID) listCart isEmpty.! !

!methodRemoval: UserAPITest #test04CreatedCartLIstCartIsEmpty stamp: 'fz 11/7/2019 20:04:14'!
test04CreatedCartLIstCartIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword .
	
	self assert: (userAPI cartOfID: cartID) listCart isEmpty.!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:07:27'!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI isValidCartID: cartID).! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/7/2019 20:09:15'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword validBookISBN'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:09:12' prior: 50786633!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: validBookISBN quantity: 1.
	
	self assert: (userAPI isValidCartID: cartID).! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:09:29' prior: 50786408!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	
	validUserButWrongPassword := 'wrongPassword'.	
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword .
	
	validBookISBN := 0! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:09:30' prior: 50786666!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	
	validUserButWrongPassword := 'wrongPassword'.	
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword .
	
	validBookISBN := 0.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:10:13' prior: 50786679!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	
	validUserButWrongPassword := 'wrongPassword'.	
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword .
	
	testObjectsFactory := StoreTestObjectsFactory new.! !

TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/7/2019 20:10:22'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:10:55' prior: 50786654!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSellByTheStore quantity: 1.
	
	self assert: (userAPI isValidCartID: cartID).! !

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:10:58'!
ERROR!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:11:26' prior: 50786724!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSellByTheStore quantity: 1.
	
	self assert: (userAPI cartOfID: cartID) .! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:12:37' prior: 50786740!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSellByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSellByTheStore) equals: 1.! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'fz 11/7/2019 20:12:52'!
itemSoldByTheStore
	
	^ 'validBook'! !
!CartTest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50785403!
test04CanNotAddNonPositiveNumberOfItems

	| cart |
	
	cart := testObjectsFactory createCart.
	
	self 
		should: [cart add: 0 of: testObjectsFactory itemSoldByTheStore ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = cart invalidQuantityErrorMessage.
			self assert: cart isEmpty ]! !
!CartTest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50785430!
test08CartRemembersTheNumberOfAddedItems

	| cart |
	
	cart := testObjectsFactory createCart.
	
	cart add: 2 of: testObjectsFactory itemSoldByTheStore.
	self assert: (cart occurrencesOf: testObjectsFactory itemSoldByTheStore) = 2! !
!CartTest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50785453!
test07CartDoesNotHoldNotAddedItems

	| cart |
	
	cart := testObjectsFactory createCart.
	
	self deny: (cart includes: testObjectsFactory itemSoldByTheStore)! !
!CartTest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50785475!
test06CartRemembersAddedItems

	| cart |
	
	cart := testObjectsFactory createCart.
	
	cart add: testObjectsFactory itemSoldByTheStore.
	self assert: (cart includes: testObjectsFactory itemSoldByTheStore)! !
!CartTest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50785445!
test03AfterAddingAnItemTheCartIsNotEmptyAnymore

	| cart |
	
	cart := testObjectsFactory createCart.
	
	cart add: testObjectsFactory itemSoldByTheStore.
	self deny: cart isEmpty ! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50785663!
test05CashierChargesCreditCardUsingMerchantProcessor

	| cart cashier salesBook total creditCard debitedAmout debitedCreditCard  |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSoldByTheStore.
	creditCard := testObjectsFactory notExpiredCreditCard.
	salesBook := OrderedCollection new.
 
	cashier:= Cashier 
		toCheckout: cart 
		charging: creditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.
		
	debitBehavior := [ :anAmount :aCreditCard | 
		debitedAmout := anAmount.
		debitedCreditCard := aCreditCard ].
	total := cashier checkOut.
					
	self assert: debitedCreditCard = creditCard.
	self assert: debitedAmout = total.! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50785705!
test02CalculatedTotalIsCorrect

	| cart cashier |
	
	cart := testObjectsFactory createCart.
	cart add: 2 of: testObjectsFactory itemSoldByTheStore.
	
	cashier :=  Cashier
		toCheckout: cart 
		charging: testObjectsFactory notExpiredCreditCard 
		throught: self
		on: testObjectsFactory today 
		registeringOn: OrderedCollection new.
		
	self assert: cashier checkOut = (testObjectsFactory itemSellByTheStorePrice * 2)! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50785598!
test03CanNotCheckoutWithAnExpiredCreditCart

	| cart salesBook |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSoldByTheStore.
	salesBook := OrderedCollection new.
	
	self
		should: [ Cashier 
				toCheckout: cart 
				charging: testObjectsFactory expiredCreditCard 
				throught: self
				on: testObjectsFactory today
				registeringOn: salesBook ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError | 
			self assert: anError messageText = Cashier canNotChargeAnExpiredCreditCardErrorMessage.
			self assert: salesBook isEmpty ]! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50785619!
test04CheckoutRegistersASale

	| cart cashier salesBook total |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSoldByTheStore.
	salesBook := OrderedCollection new.
 
	cashier:= Cashier 
		toCheckout: cart 
		charging: testObjectsFactory notExpiredCreditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.
		
	total := cashier checkOut.
					
	self assert: salesBook size = 1.
	self assert: salesBook first total = total.! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50785637!
test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit

	| cart cashier salesBook creditCard |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSoldByTheStore.
	creditCard := testObjectsFactory notExpiredCreditCard.
	salesBook := OrderedCollection new.
 	debitBehavior := [ :anAmount :aCreditCard | self error: Cashier creditCardHasNoCreditErrorMessage].
	
	cashier:= Cashier 
		toCheckout: cart 
		charging: creditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.
		
	self 
		should: [cashier checkOut ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cashier creditCardHasNoCreditErrorMessage.
			self assert: salesBook isEmpty ]! !
!StoreTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50785831!
defaultCatalog
	
	^ Dictionary new
		at: self itemSoldByTheStore put: self itemSellByTheStorePrice;
		yourself ! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:12:52' prior: 50786753!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !

!methodRemoval: StoreTestObjectsFactory #itemSellByTheStore stamp: 'fz 11/7/2019 20:12:52'!
itemSellByTheStore
	
	^ 'validBook'!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:12:54'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:13:18'!
addToCart: aSmallInteger book: aString quantity: aSmallInteger3 
	self shouldBeImplemented.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:13:27' prior: 50786961!
addToCart: aSmallInteger book: aString quantity: aSmallInteger3 
	^true.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:13:47' prior: 50786967!
addToCart: aCartID book: aBookISBN quantity: aQuantity 
	^true.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:14:01' prior: 50786973!
addToCart: aCartID book: aBookISBN quantity: aQuantity 
	^ self shouldBeImplemented .! !

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:14:02'!
ERROR!

Object subclass: #UserAPI
	instanceVariableNames: 'uM cartsRegister'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/7/2019 20:15:24'!
Object subclass: #UserAPI
	instanceVariableNames: 'uM cartsRegister'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/7/2019 20:16:31'!
Object subclass: #UserAPI
	instanceVariableNames: 'uM cartsRegister theCatalog'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'for testing only' stamp: 'fz 11/7/2019 20:16:29' prior: 50786231!
cartOfID: aCartID
	^Cart acceptingItemsOf: theCatalog.! !

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/7/2019 20:16:38'!
Object subclass: #UserAPI
	instanceVariableNames: 'uM cartsRegister catalog'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:16:38' prior: 50787005!
cartOfID: aCartID
	^Cart acceptingItemsOf: catalog.! !
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/7/2019 20:19:05'!
initializeWithUserManager: aUM Catalog: aCatalog  
	uM := aUM.! !
!UserAPI class methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:19:05' prior: 50786113!
withUserManager: aUM 
	^self new initializeWithUserManager: aUM Catalog: Dictionary new. ! !

!methodRemoval: UserAPI #initializeWithUserManager: stamp: 'fz 11/7/2019 20:19:05'!
initializeWithUserManager: aUM 
	uM := aUM.!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/7/2019 20:19:47' prior: 50787021!
initializeWithUserManager: aUM Catalog: aCatalog  
	uM := aUM.
	catalog = aCatalog.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 20:19:52'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 20:19:53'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/7/2019 20:19:53'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:19:53'!
ERROR!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:19:53'!
ERROR!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:20:20'!
ERROR!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:20:20'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:21:02' prior: 50786978!
addToCart: aCartID book: aBookISBN quantity: aQuantity 
	^ self cartOfID: aCartID.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:21:05' prior: 50787064!
addToCart: aCartID book: aBookISBN quantity: aQuantity 
	^ self cartOfID: aCartID add.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:21:10' prior: 50787070!
addToCart: aCartID book: aBookISBN quantity: aQuantity 
	^ self cartOfID: aCartID.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:21:59' prior: 50787076!
addToCart: aCartID book: aBookISBN quantity: aQuantity 
	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN .! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:22:35' prior: 50787082!
addToCart: aCartID book: aBookISBN quantity: aQuantity 
	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:22:56'!
ERROR!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:22:56'!
ERROR!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:23:53'!
ERROR!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:23:53'!
ERROR!
!UserAPI class methodsFor: 'instance creation' stamp: 'fz 11/7/2019 20:25:30'!
withUserManager: aUM Catalog: aCatalog  
	^self new initializeWithUserManager: aUM Catalog: Dictionary new. ! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:25:30' prior: 50786462!
test02CartIsCreatedForValidUserAndIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self Catalog: Dictionary new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI isValidCartID: cartID).! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:25:30' prior: 50786531!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self Catalog: Dictionary new.
	
	self should: [userAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:25:30' prior: 50786516!
test03CreateCartFailsWithWrongPassword
	|userAPI|
	
	userAPI := UserAPI withUserManager: self Catalog: Dictionary new.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:25:30' prior: 50786940!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self Catalog: Dictionary new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !

!methodRemoval: UserAPI class #withUserManager: stamp: 'fz 11/7/2019 20:25:30'!
withUserManager: aUM 
	^self new initializeWithUserManager: aUM Catalog: Dictionary new. !
!UserAPI class methodsFor: 'instance creation' stamp: 'fz 11/7/2019 20:25:37' prior: 50787107!
withUserManager: aUM Catalog: aCatalog  
	^self new initializeWithUserManager: aUM Catalog: aCatalog . ! !
!UserAPI class methodsFor: 'instance creation' stamp: 'fz 11/7/2019 20:25:46'!
withUserManager: aUM catalog: aCatalog  
	^self new initializeWithUserManager: aUM Catalog: aCatalog . ! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:25:46' prior: 50787114!
test02CartIsCreatedForValidUserAndIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self catalog: Dictionary new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI isValidCartID: cartID).! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:25:46' prior: 50787126!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self catalog: Dictionary new.
	
	self should: [userAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:25:46' prior: 50787141!
test03CreateCartFailsWithWrongPassword
	|userAPI|
	
	userAPI := UserAPI withUserManager: self catalog: Dictionary new.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:25:46' prior: 50787156!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self catalog: Dictionary new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !

!methodRemoval: UserAPI class #withUserManager:Catalog: stamp: 'fz 11/7/2019 20:25:46'!
withUserManager: aUM Catalog: aCatalog  
	^self new initializeWithUserManager: aUM Catalog: aCatalog . !
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/7/2019 20:26:00'!
initializeWithUserManager: aUM catalog: aCatalog  
	uM := aUM.
	catalog = aCatalog.! !
!UserAPI class methodsFor: 'as yet unclassified' stamp: 'fz 11/7/2019 20:26:00' prior: 50787183!
withUserManager: aUM catalog: aCatalog  
	^self new initializeWithUserManager: aUM catalog: aCatalog . ! !

!methodRemoval: UserAPI #initializeWithUserManager:Catalog: stamp: 'fz 11/7/2019 20:26:00'!
initializeWithUserManager: aUM Catalog: aCatalog  
	uM := aUM.
	catalog = aCatalog.!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 20:26:02'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 20:26:02'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/7/2019 20:26:02'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:26:02'!
ERROR!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:26:02'!
ERROR!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 20:26:39'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 20:26:39'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/7/2019 20:26:39'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:26:39'!
ERROR!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:26:39'!
ERROR!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/7/2019 20:27:15' prior: 50787253!
initializeWithUserManager: aUM catalog: aCatalog  
	uM := aUM.
	catalog := aCatalog.! !

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:27:18'!
ERROR!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:28:12' prior: 50787232!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog .
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:28:13' prior: 50787311!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:28:15'!
FAILURE!
!UserAPI methodsFor: 'for testing only' stamp: 'fz 11/7/2019 20:29:22' prior: 50787017!
cartOfID: aCartID
	^cartsRegister at: aCartID! !
!UserAPI methodsFor: 'for testing only' stamp: 'fz 11/7/2019 20:29:55' prior: 50786256!
isValidCartID: aCartID 
	^cartsRegister includesKey: aCartID ! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/7/2019 20:30:26' prior: 50786507!
createCartOf: aUser withPassword: aPassword 
	(uM isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotCreateCartWithInvalidCredentialsErrorMessage].
	
	cartsRegister at: 1 put: (Cart acceptingItemsOf: catalog).
	
	^1! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 20:30:42'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 20:30:42'!
ERROR!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/7/2019 20:30:42'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:30:42'!
ERROR!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 20:30:45'!
ERROR!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/7/2019 20:31:35' prior: 50787302!
initializeWithUserManager: aUM catalog: aCatalog  
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 20:31:37'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 20:31:37'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/7/2019 20:31:37'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:31:37'!
PASSED!

----SNAPSHOT----(7 November 2019 20:31:41) CuisUniversity-3938.image priorSource: 14515520!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:33:30'!
test05CanNotAddItemsToInvalidCartID
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:34:42' prior: 50787405!
test05CanNotAddItemsToInvalidCartID
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartID].! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/7/2019 20:35:00'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword invalidCartID'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:34:59' prior: 50787421!
test05CanNotAddItemsToInvalidCartID
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self should: [userAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartID].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:35:21' prior: 50787453!
test05CanNotAddItemsToInvalidCartID
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self should: [userAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartID].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:36:34' prior: 50787471!
test05CanNotAddItemsToInvalidCartID
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartID].! !

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/7/2019 20:36:38'!
ERROR!

TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/7/2019 20:36:53'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:37:00' prior: 50787489!
test05CanNotAddItemsToInvalidCartID
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartID].! !

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/7/2019 20:37:01'!
ERROR!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:37:12' prior: 50787531!
test05CanNotAddItemsToInvalidCartID
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/7/2019 20:37:31'!
ERROR!
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/7/2019 20:37:55'!
invalidCartIDErrorMessage
	self shouldBeImplemented.! !
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/7/2019 20:38:06' prior: 50787578!
invalidCartIDErrorMessage
	^'invalid cart ID'! !

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/7/2019 20:38:08'!
FAILURE!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/7/2019 20:38:20'!
FAILURE!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/7/2019 20:38:20'!
FAILURE!
!UserAPI methodsFor: 'for testing only' stamp: 'fz 11/7/2019 20:39:00' prior: 50787346!
cartOfID: aCartID
	^cartsRegister at: aCartID ifAbsent: [self error: self class invalidCartIDErrorMessage]! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 20:39:04'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 20:39:04'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/7/2019 20:39:04'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:39:04'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/7/2019 20:39:04'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:42:36'!
test06AddingItemsToMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:42:52' prior: 50787619!
test06AddingItemsToMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:44:21'!
test06AddingItemsWithMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	
	
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cart2ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: ((userAPI cartOfID: cart1ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 0.! !

!methodRemoval: UserAPITest #test06AddingItemsToMultipleCartsBehavesCorrectly stamp: 'fz 11/7/2019 20:44:24'!
test06AddingItemsToMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/7/2019 20:44:26'!
FAILURE!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/7/2019 20:44:26'!
FAILURE!

Object subclass: #UserAPI
	instanceVariableNames: 'uM cartsRegister catalog currentID'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/7/2019 20:44:39'!
Object subclass: #UserAPI
	instanceVariableNames: 'uM cartsRegister catalog currentID'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/7/2019 20:44:49' prior: 50787383!
initializeWithUserManager: aUM catalog: aCatalog  
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/7/2019 20:45:50' prior: 50787356!
createCartOf: aUser withPassword: aPassword 
	|cartID|
	(uM isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotCreateCartWithInvalidCredentialsErrorMessage].
	
	cartID := currentID.
	currentID  := currentID +1.
	
	cartsRegister at: cartID put: (Cart acceptingItemsOf: catalog).
	
	^cartID.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 20:45:54'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 20:45:54'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/7/2019 20:45:54'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:45:54'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/7/2019 20:45:54'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/7/2019 20:45:54'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:51:37'!
test07ListCartOfNewCartIsEmpty
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	
	
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cart2ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: ((userAPI cartOfID: cart1ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 0.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:54:25' prior: 50787741!
test07ListCartOfNewCartIsEmpty
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 0.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:56:34' prior: 50787766!
test07ListCartOfNewCartIsEmpty
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI listCart: cartID) equals: 0.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:56:56' prior: 50787779!
test07ListCartOfNewCartIsEmpty
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI listCart: cartID isEmpty) .! !

!methodRemoval: Cart #listCart stamp: 'fz 11/7/2019 20:57:23'!
listCart
	self shouldBeImplemented.!
!UserAPI methodsFor: 'API' stamp: 'fz 11/7/2019 20:57:56'!
listCart: aCartID! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/7/2019 20:58:18' prior: 50787805!
listCart: aCartID

	^ Set new.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 20:58:21'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 20:58:21'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/7/2019 20:58:21'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:58:21'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/7/2019 20:58:21'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/7/2019 20:58:21'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/7/2019 20:58:21'!
ERROR!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/7/2019 20:58:21'!
ERROR!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/7/2019 20:58:27'!
ERROR!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/7/2019 20:58:27'!
ERROR!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:58:39' prior: 50787791!
test07ListCartOfNewCartIsEmpty
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI listCart: cartID) isEmpty.! !

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/7/2019 20:58:40'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 20:58:40'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 20:58:40'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/7/2019 20:58:40'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 20:58:40'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/7/2019 20:58:40'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/7/2019 20:58:40'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/7/2019 20:58:40'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:58:54'!
test08ListCartReflectsAddedItems
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI listCart: cartID) isEmpty.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 20:59:14' prior: 50787879!
test08ListCartReflectsAddedItems
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: (userAPI listCart: cartID) isEmpty.! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'fz 11/7/2019 21:00:02'!
anotherItemSoldByTheStore

	^ 'anotherValidBook'! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'fz 11/7/2019 21:00:24'!
anotherItemSellByTheStorePrice
	
	^25! !
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'fz 11/7/2019 21:00:58' prior: 50786933!
defaultCatalog
	
	^ Dictionary new
		at: self itemSoldByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSoldByTheStore put: self anotherItemSellByTheStorePrice;
		yourself ! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 21:03:50' prior: 50787891!
test08ListCartReflectsAddedItems
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	self assert: (userAPI listCart: cartID) isEmpty.! !

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/7/2019 21:03:53'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/7/2019 21:03:53'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/7/2019 21:03:53'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/7/2019 21:03:53'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/7/2019 21:03:53'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/7/2019 21:03:53'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/7/2019 21:03:53'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/7/2019 21:03:53'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/7/2019 21:03:53'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 21:07:28' prior: 50787927!
test08ListCartReflectsAddedItems
	|userAPI cartID correctList |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	correctList.
	
	self assert: (userAPI listCart: cartID) equals: 0.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 21:09:10' prior: 50787975!
test08ListCartReflectsAddedItems
	|userAPI cartID correctList |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	correctList := Dictionary new; at: testObjectsFactory itemSoldByTheStore put: 2; at: testObjectsFactory anotherItemSoldByTheStore put: 1.
	
	self assert: (userAPI listCart: cartID) equals: 0.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/7/2019 21:09:20' prior: 50787996!
test08ListCartReflectsAddedItems
	|userAPI cartID correctList |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	correctList := Dictionary new; at: testObjectsFactory itemSoldByTheStore put: 2; at: testObjectsFactory anotherItemSoldByTheStore put: 1.
	
	self assert: (userAPI listCart: cartID) equals: correctList .! !

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/7/2019 21:09:22'!
ERROR!

----QUIT----(7 November 2019 21:11:06) CuisUniversity-3938.image priorSource: 14584048!

----STARTUP---- (11 November 2019 17:07:21) as /home/akima/Documents/ing_II/repo/cuis/CuisUniversity-3938.image!


!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 17:39:22'!
ERROR!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 17:39:22'!
ERROR!

|dict|

dict := Dictionary new.
dict at: 'asd' put:3.!

|dict|

dict := Dictionary new.
dict at: 'asd' put:3.
dict!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 17:45:40' prior: 50788021!
test08ListCartReflectsAddedItems
	|userAPI cartID correctList |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	correctList := Dictionary new.
	correctList at: testObjectsFactory itemSoldByTheStore put: 2.
	correctList at: testObjectsFactory anotherItemSoldByTheStore put: 1.
	
	self assert: (userAPI listCart: cartID) equals: correctList .! !

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 17:45:42'!
FAILURE!
!Cart methodsFor: 'queries' stamp: 'fz 11/11/2019 17:55:47'!
listItems
	^items copy! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/11/2019 17:56:19' prior: 50787808!
listCart: aCartID

	^ (self cartOfID: aCartID) listItems.! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/11/2019 17:57:20'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword itemsList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 17:57:38' prior: 50788065!
test08ListCartReflectsAddedItems
	|userAPI cartID correctList |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	correctList := Dictionary new.
	correctList at: testObjectsFactory itemSoldByTheStore put: 2.
	correctList at: testObjectsFactory anotherItemSoldByTheStore put: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: itemsList equals: 1.! !

TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/11/2019 17:57:44'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 17:58:01' prior: 50788113!
test08ListCartReflectsAddedItems
	|userAPI cartID correctList itemsList |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	correctList := Dictionary new.
	correctList at: testObjectsFactory itemSoldByTheStore put: 2.
	correctList at: testObjectsFactory anotherItemSoldByTheStore put: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: itemsList equals: 1.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 17:58:33' prior: 50788158!
test08ListCartReflectsAddedItems
	|userAPI cartID correctList itemsList |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	correctList := Dictionary new.
	correctList at: testObjectsFactory itemSoldByTheStore put: 2.
	correctList at: testObjectsFactory anotherItemSoldByTheStore put: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 17:58:51' prior: 50788184!
test08ListCartReflectsAddedItems
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: (itemsList occurrencesOf: testObjectsFactory anotherItemSoldByTheStore) equals: 1.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 17:59:26' prior: 50788212!
test08ListCartReflectsAddedItems
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: (itemsList occurrencesOf: testObjectsFactory anotherItemSoldByTheStore) equals: 1.
	self assert: itemsList size equals: 3.! !

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 17:59:27'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 17:59:27'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 17:59:27'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 17:59:27'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 17:59:27'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 17:59:27'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 17:59:27'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 17:59:27'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 17:59:27'!
PASSED!

----SNAPSHOT----(11 November 2019 17:59:32) CuisUniversity-3938.image priorSource: 14604732!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:02:13'!
test09canNotAddItemsToCartAfter30Mins
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:02:52' prior: 50788296!
test09canNotAddItemsToCartAfter30Mins
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !

!methodRemoval: UserAPITest #test09canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:03:55'!
test09canNotAddItemsToCartAfter30Mins
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:06:45'!
test09newCartHasLastAccesedTimeRightNow
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self catalog: Dictionary new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI lastAccesedTime: cartID) equals: self currentTime.! !
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/11/2019 18:07:30'!
initializeWithUserManager: aUM clock: aClock catalog: aCatalog  
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.! !
!UserAPI class methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:07:30' prior: 50787259!
withUserManager: aUM catalog: aCatalog  
	^self new initializeWithUserManager: aUM clock: self catalog: aCatalog . ! !

!methodRemoval: UserAPI #initializeWithUserManager:catalog: stamp: 'fz 11/11/2019 18:07:30'!
initializeWithUserManager: aUM catalog: aCatalog  
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.!
!UserAPI class methodsFor: 'instance creation' stamp: 'fz 11/11/2019 18:08:06'!
withUserManager: aUM clock: aClock catalog: aCatalog  
	^self new initializeWithUserManager: aUM clock: self catalog: aCatalog . ! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:08:06' prior: 50787554!
test05CanNotAddItemsToInvalidCartID
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:08:06' prior: 50787843!
test07ListCartOfNewCartIsEmpty
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI listCart: cartID) isEmpty.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:08:06' prior: 50787643!
test06AddingItemsWithMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	
	
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cart2ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: ((userAPI cartOfID: cart1ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 0.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:08:07' prior: 50788238!
test08ListCartReflectsAddedItems
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: (itemsList occurrencesOf: testObjectsFactory anotherItemSoldByTheStore) equals: 1.
	self assert: itemsList size equals: 3.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:08:07' prior: 50788352!
test09newCartHasLastAccesedTimeRightNow
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI lastAccesedTime: cartID) equals: self currentTime.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:08:07' prior: 50787190!
test02CartIsCreatedForValidUserAndIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI isValidCartID: cartID).! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:08:07' prior: 50787202!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new.
	
	self should: [userAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:08:07' prior: 50787217!
test03CreateCartFailsWithWrongPassword
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:08:07' prior: 50787327!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !

!methodRemoval: UserAPI class #withUserManager:catalog: stamp: 'fz 11/11/2019 18:08:07'!
withUserManager: aUM catalog: aCatalog  
	^self new initializeWithUserManager: aUM clock: self catalog: aCatalog . !
!UserAPI class methodsFor: 'instance creation' stamp: 'fz 11/11/2019 18:08:12' prior: 50788386!
withUserManager: aUM clock: aClock catalog: aCatalog  
	^self new initializeWithUserManager: aUM clock: aClock catalog: aCatalog . ! !

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/11/2019 18:08:28'!
Object subclass: #UserAPI
	instanceVariableNames: 'uM cartsRegister catalog currentID clock'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/11/2019 18:08:26' prior: 50788364!
initializeWithUserManager: aUM clock: aClock catalog: aCatalog  
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.! !

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:08:48'!
ERROR!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:08:48'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:08:58'!
lastAccesedTime: aSmallInteger 
	self shouldBeImplemented.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:09:27' prior: 50788591!
lastAccesedTime: aCartID 
	^ clock currentTime. ! !

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:09:29'!
ERROR!
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:09:37'!
currentTime
	self shouldBeImplemented.! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/11/2019 18:09:55'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:09:53' prior: 50788604!
currentTime
	^ time! !

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:09:59'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:10:10'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:12:16' prior: 50786692!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	
	validUserButWrongPassword := 'wrongPassword'.	
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword .
	
	testObjectsFactory := StoreTestObjectsFactory new.
	
	time := GregorianDateTime now.! !

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:12:28'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 18:12:28'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 18:12:28'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 18:12:28'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:12:28'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:12:28'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 18:12:28'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 18:12:28'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 18:12:28'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:12:28'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:14:45'!
test10canNotAddItemsToCartAfter30Mins
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:14:51'!
FAILURE!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:16:28' prior: 50787089!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	(clock currentTime > (self lastAccesedTime: aCartID)) ifTrue: []. 

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:17:03' prior: 50788700!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	(clock currentTime > (self lastAccesedTime: aCartID) next: (TimeUnits minute with: 30)) ifTrue: [self error: self class ]. 

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:17:21' prior: 50788709!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	(clock currentTime > (self lastAccesedTime: aCartID) next: (TimeUnits minute with: 30)) ifTrue: [self error: self class expiredCartErrorMessage]. 

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 18:17:27'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 18:17:27'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 18:17:27'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:17:27'!
ERROR!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:17:27'!
ERROR!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 18:17:27'!
ERROR!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 18:17:27'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 18:17:27'!
ERROR!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:17:27'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:17:27'!
ERROR!

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/11/2019 18:19:20'!
Object subclass: #UserAPI
	instanceVariableNames: 'uM cartsRegister catalog currentID clock cartTimeRegister'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'API' stamp: 'fz 11/11/2019 18:19:17' prior: 50787709!
createCartOf: aUser withPassword: aPassword 
	|cartID|
	(uM isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotCreateCartWithInvalidCredentialsErrorMessage].
	
	cartID := currentID.
	currentID  := currentID +1.
	
	cartsRegister at: cartID put: (Cart acceptingItemsOf: catalog).
	cartTimeRegister at: cartID put: clock currentTime.
	
	^cartID.! !
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/11/2019 18:19:35' prior: 50788576!
initializeWithUserManager: aUM clock: aClock catalog: aCatalog  
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.
	cartTimeRegister := Dictionary new.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:20:27' prior: 50788596!
lastAccesedTime: aCartID 
	^ cartTimeRegister at: aCartID . ! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 18:20:36'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 18:20:36'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 18:20:36'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:20:36'!
ERROR!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:20:36'!
FAILURE!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 18:20:36'!
ERROR!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 18:20:36'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 18:20:36'!
ERROR!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:20:36'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:20:36'!
ERROR!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:20:41'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:21:00' prior: 50788720!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	(clock currentTime > (self lastAccesedTime: aCartID next: (TimeUnits minute with: 30))) ifTrue: [self error: self class expiredCartErrorMessage]. 

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:21:04'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:21:45' prior: 50788838!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	(clock currentTime > ((self lastAccesedTime: aCartID) next: (TimeUnits minute with: 30))) ifTrue: [self error: self class expiredCartErrorMessage]. 

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 18:21:48'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 18:21:48'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 18:21:48'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:21:48'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:21:48'!
FAILURE!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 18:21:48'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 18:21:48'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 18:21:48'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:21:48'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:21:48'!
ERROR!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:21:53'!
FAILURE!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:22:40'!
FAILURE!

self currentTime !

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:24:44'!
FAILURE!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:26:46'!
FAILURE!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:27:15' prior: 50788797!
lastAccesedTime: aCartID 
	^ cartTimeRegister at: aCartID ifAbsent: [self error: self class invalidCartIDErrorMessage]. ! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 18:27:20'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 18:27:20'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 18:27:20'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:27:20'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:27:20'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 18:27:20'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 18:27:20'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 18:27:20'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:27:20'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:27:20'!
ERROR!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:27:20'!
ERROR!
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/11/2019 18:27:34'!
expiredCartErrorMessage
	self shouldBeImplemented.! !
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/11/2019 18:27:54' prior: 50788953!
expiredCartErrorMessage
	^'cart is expired'! !

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:27:56'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 18:28:00'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 18:28:00'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 18:28:00'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:28:00'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:28:00'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 18:28:00'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 18:28:00'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 18:28:00'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:28:00'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:28:00'!
PASSED!

----SNAPSHOT----(11 November 2019 18:28:04) CuisUniversity-3938.image priorSource: 14612565!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:29:09'!
test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:30:02' prior: 50789001!
test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 20).
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 20).
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:30:20' prior: 50789022!
test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 20).
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 20).
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: (itemsList occurrencesOf: testObjectsFactory anotherItemSoldByTheStore) equals: 1.
	self assert: itemsList size equals: 3.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:30:27' prior: 50789042!
test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 20).
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 20).
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: itemsList size equals: 2.! !

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/11/2019 18:30:28'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:31:07' prior: 50788853!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	(clock currentTime > ((self lastAccesedTime: aCartID) next: (TimeUnits minute with: 30))) ifTrue: [self error: self class expiredCartErrorMessage]. 

	cartTimeRegister at: aCartID put: clock currentTime.

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 18:31:10'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 18:31:10'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 18:31:10'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:31:10'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:31:10'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 18:31:10'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 18:31:10'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 18:31:10'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:31:10'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:31:10'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/11/2019 18:31:10'!
PASSED!

----SNAPSHOT----(11 November 2019 18:31:16) CuisUniversity-3938.image priorSource: 14635106!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:32:49' prior: 50789100!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	(self isValidCartID: aCartID) ifFalse: [self error: self class invalidCartIDErrorMessage].
	(clock currentTime > ((self lastAccesedTime: aCartID) next: (TimeUnits minute with: 30))) ifTrue: [self error: self class expiredCartErrorMessage]. 

	cartTimeRegister at: aCartID put: clock currentTime.

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !
!UserAPI methodsFor: 'for testing only' stamp: 'fz 11/11/2019 18:32:58' prior: 50787597!
cartOfID: aCartID
	^cartsRegister at: aCartID.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 18:33:09' prior: 50788911!
lastAccesedTime: aCartID 
	^ cartTimeRegister at: aCartID.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 18:33:12'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 18:33:12'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 18:33:12'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:33:12'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:33:12'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 18:33:12'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 18:33:12'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 18:33:12'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:33:12'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:33:12'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/11/2019 18:33:12'!
PASSED!

----SNAPSHOT----(11 November 2019 18:33:16) CuisUniversity-3938.image priorSource: 14639955!

----SNAPSHOT----(11 November 2019 18:34:08) CuisUniversity-3938.image priorSource: 14642061!
!UserAPI methodsFor: 'API' stamp: 'fz 11/11/2019 18:34:43' prior: 50789153!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	(self isValidCartID: aCartID) ifFalse: [self error: self class invalidCartIDErrorMessage].
	(self isExpiredCartID: aCartID) ifTrue: [self error: self class expiredCartErrorMessage]. 

	cartTimeRegister at: aCartID put: clock currentTime.

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/11/2019 18:35:02' prior: 50789221!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	(self isValidCartID: aCartID) ifFalse: [self error: self class invalidCartIDErrorMessage].
	(self isExpiredCart: aCartID) ifTrue: [self error: self class expiredCartErrorMessage]. 

	cartTimeRegister at: aCartID put: clock currentTime.

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !
!UserAPI methodsFor: 'testing' stamp: 'fz 11/11/2019 18:35:28'!
isExpiredCart: aCartID 
	^clock currentTime > ((self lastAccesedTime: aCartID) next: (TimeUnits minute with: 30))! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 18:35:50'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 18:35:50'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 18:35:50'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:35:50'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:35:50'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 18:35:50'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 18:35:50'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 18:35:50'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:35:50'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:35:50'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/11/2019 18:35:50'!
PASSED!

----SNAPSHOT----(11 November 2019 18:35:54) CuisUniversity-3938.image priorSource: 14642155!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:36:47'!
test12canNotListCartAfter30Mins
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [userAPI listCart: cartID]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/11/2019 18:36:48'!
FAILURE!
!UserAPI methodsFor: 'API' stamp: 'fz 11/11/2019 18:37:05' prior: 50788097!
listCart: aCartID
	(self isExpiredCart: aCartID) ifTrue: [self error: self class expiredCartErrorMessage]. 
	^ (self cartOfID: aCartID) listItems.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 18:37:13'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 18:37:13'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 18:37:13'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:37:13'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:37:13'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 18:37:13'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 18:37:13'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 18:37:13'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:37:13'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:37:13'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/11/2019 18:37:13'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/11/2019 18:37:13'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:37:46'!
test13CanNotLIstInvalidCartID
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI listCart: invalidCartID ]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/11/2019 18:37:50'!
FAILURE!
!UserAPI methodsFor: 'API' stamp: 'fz 11/11/2019 18:38:05' prior: 50789316!
listCart: aCartID
	
	(self isValidCartID: aCartID) ifFalse: [self error: self class invalidCartIDErrorMessage].
	(self isExpiredCart: aCartID) ifTrue: [self error: self class expiredCartErrorMessage]. 
	^ (self cartOfID: aCartID) listItems.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 18:38:07'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 18:38:07'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 18:38:07'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 18:38:07'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 18:38:07'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 18:38:07'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 18:38:07'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 18:38:07'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 18:38:07'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 18:38:07'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/11/2019 18:38:08'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/11/2019 18:38:08'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/11/2019 18:38:08'!
PASSED!
!UserAPI methodsFor: 'API' stamp: 'fz 11/11/2019 18:38:57' prior: 50789235!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	self assertValidCart: aCartID.
	(self isValidCartID: aCartID) ifFalse: [self error: self class invalidCartIDErrorMessage].
	(self isExpiredCart: aCartID) ifTrue: [self error: self class expiredCartErrorMessage]. 

	cartTimeRegister at: aCartID put: clock currentTime.

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/11/2019 18:39:03' prior: 50789438!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	self assertValidCart: aCartID.
	
	cartTimeRegister at: aCartID put: clock currentTime.

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/11/2019 18:39:18' prior: 50789385!
listCart: aCartID
	self assertValidCart: aCartID.
	^ (self cartOfID: aCartID) listItems.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/11/2019 18:39:33'!
assertValidCart: aCartID.
	(self isValidCartID: aCartID) ifFalse: [self error: self class invalidCartIDErrorMessage].
	(self isExpiredCart: aCartID) ifTrue: [self error: self class expiredCartErrorMessage]. ! !
!UserAPI methodsFor: 'testing' stamp: 'fz 11/11/2019 18:40:07' prior: 50789467!
assertValidCart: aCartID.
	(cartsRegister includesKey: aCartID) ifFalse: [self error: self class invalidCartIDErrorMessage].
	(self isExpiredCart: aCartID) ifTrue: [self error: self class expiredCartErrorMessage]. ! !
!UserAPI methodsFor: 'testing' stamp: 'fz 11/11/2019 18:39:33' prior: 50789477!
assertValidCart: aCartID.
	(self isValidCartID: aCartID) ifFalse: [self error: self class invalidCartIDErrorMessage].
	(self isExpiredCart: aCartID) ifTrue: [self error: self class expiredCartErrorMessage]. ! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:51:51'!
test14cartCheckoutCallsMerchantProcessor
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI listCart: invalidCartID ]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:52:25' prior: 50789496!
test14cartCheckoutCallsMerchantProcessor
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self should: [userAPI checkoutCart: cartID ]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 18:53:21' prior: 50789515!
test14cartCheckoutCallsMerchantProcessor
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI checkoutCart: cartID.
! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:05:30'!
test14cartCheckoutRegistersSales
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI checkoutCart: cartID.
! !

!methodRemoval: UserAPITest #test14cartCheckoutCallsMerchantProcessor stamp: 'fz 11/11/2019 19:05:31'!
test14cartCheckoutCallsMerchantProcessor
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI checkoutCart: cartID.
!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:09:26' prior: 50789543!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook total |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI checkoutCart: cartID.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = total.
! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:09:59' prior: 50789566!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI checkoutCart: cartID.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = 5.
! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:10:21' prior: 50789582!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	userAPI checkoutCart: cartID.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = 5.
! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:11:03' prior: 50789597!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	userAPI checkoutCart: cartID.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = testObjectsFactory itemSellByTheStorePrice.
! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'fz 11/11/2019 19:11:32'!
itemSoldByTheStorePrice
	
	^10! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:11:32' prior: 50786849!
test02CalculatedTotalIsCorrect

	| cart cashier |
	
	cart := testObjectsFactory createCart.
	cart add: 2 of: testObjectsFactory itemSoldByTheStore.
	
	cashier :=  Cashier
		toCheckout: cart 
		charging: testObjectsFactory notExpiredCreditCard 
		throught: self
		on: testObjectsFactory today 
		registeringOn: OrderedCollection new.
		
	self assert: cashier checkOut = (testObjectsFactory itemSoldByTheStorePrice * 2)! !
!StoreTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:11:32' prior: 50787918!
defaultCatalog
	
	^ Dictionary new
		at: self itemSoldByTheStore put: self itemSoldByTheStorePrice;
		at: self anotherItemSoldByTheStore put: self anotherItemSellByTheStorePrice;
		yourself ! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:11:32' prior: 50789615!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	userAPI checkoutCart: cartID.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = testObjectsFactory itemSoldByTheStorePrice.
! !

!methodRemoval: StoreTestObjectsFactory #itemSellByTheStorePrice stamp: 'fz 11/11/2019 19:11:32'!
itemSellByTheStorePrice
	
	^10!
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'fz 11/11/2019 19:11:44'!
anotherItemSoldByTheStorePrice
	
	^25! !
!StoreTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:11:44' prior: 50789656!
defaultCatalog
	
	^ Dictionary new
		at: self itemSoldByTheStore put: self itemSoldByTheStorePrice;
		at: self anotherItemSoldByTheStore put: self anotherItemSoldByTheStorePrice;
		yourself ! !

!methodRemoval: StoreTestObjectsFactory #anotherItemSellByTheStorePrice stamp: 'fz 11/11/2019 19:11:44'!
anotherItemSellByTheStorePrice
	
	^25!
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'fz 11/11/2019 19:12:06'!
itemNotSoldByTheStore
	
	^'invalidBook'! !
!CartTest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:12:06' prior: 50785417!
test02CanNotAddItemsThatDoNotBelongToStore

	| cart |
	
	cart := testObjectsFactory createCart.
	
	self 
		should: [ cart add: testObjectsFactory itemNotSoldByTheStore ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = cart invalidItemErrorMessage.
			self assert: cart isEmpty ]! !
!CartTest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:12:06' prior: 50785461!
test05CanNotAddMoreThanOneItemNotSellByTheStore

	| cart |
	
	cart := testObjectsFactory createCart.
	
	self 
		should: [cart add: 2 of: testObjectsFactory itemNotSoldByTheStore  ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = cart invalidItemErrorMessage.
			self assert: cart isEmpty ]! !

!methodRemoval: StoreTestObjectsFactory #itemNotSellByTheStore stamp: 'fz 11/11/2019 19:12:06'!
itemNotSellByTheStore
	
	^'invalidBook'!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/11/2019 19:13:53'!
initializeWithUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook   
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.
	cartTimeRegister := Dictionary new.! !
!UserAPI class methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:13:53' prior: 50788561!
withUserManager: aUM clock: aClock catalog: aCatalog  
	^self new initializeWithUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook . ! !

!methodRemoval: UserAPI #initializeWithUserManager:clock:catalog: stamp: 'fz 11/11/2019 19:13:53'!
initializeWithUserManager: aUM clock: aClock catalog: aCatalog  
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.
	cartTimeRegister := Dictionary new.!

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/11/2019 19:14:04'!
Object subclass: #UserAPI
	instanceVariableNames: 'uM cartsRegister catalog currentID clock cartTimeRegister salesBook'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/11/2019 19:14:03' prior: 50789745!
initializeWithUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook   
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.
	cartTimeRegister := Dictionary new.
	salesBook := aSalesBook .! !
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/11/2019 19:14:05' prior: 50789782!
initializeWithUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook   
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.
	cartTimeRegister := Dictionary new.
	salesBook := aSalesBook.! !
!UserAPI class methodsFor: 'instance creation' stamp: 'fz 11/11/2019 19:14:48'!
withUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook   
	^self new initializeWithUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook . ! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50788415!
test07ListCartOfNewCartIsEmpty
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI listCart: cartID) isEmpty.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50788427!
test06AddingItemsWithMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	
	
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cart2ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: ((userAPI cartOfID: cart1ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 0.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50788677!
test10canNotAddItemsToCartAfter30Mins
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50788494!
test02CartIsCreatedForValidUserAndIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI isValidCartID: cartID).! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50789363!
test13CanNotLIstInvalidCartID
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI listCart: invalidCartID ]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50788506!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: OrderedCollection new.
	
	self should: [userAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50788394!
test05CanNotAddItemsToInvalidCartID
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50789070!
test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 20).
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 20).
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: itemsList size equals: 2.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50788453!
test08ListCartReflectsAddedItems
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: (itemsList occurrencesOf: testObjectsFactory anotherItemSoldByTheStore) equals: 1.
	self assert: itemsList size equals: 3.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50789295!
test12canNotListCartAfter30Mins
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [userAPI listCart: cartID]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50789666!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	userAPI checkoutCart: cartID.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = testObjectsFactory itemSoldByTheStorePrice.
! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50788481!
test09newCartHasLastAccesedTimeRightNow
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI lastAccesedTime: cartID) equals: self currentTime.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50788522!
test03CreateCartFailsWithWrongPassword
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: OrderedCollection new.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:14:48' prior: 50788538!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !

!methodRemoval: UserAPI class #withUserManager:clock:catalog: stamp: 'fz 11/11/2019 19:14:48'!
withUserManager: aUM clock: aClock catalog: aCatalog  
	^self new initializeWithUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook . !

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:15:25'!
ERROR!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:15:25'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:15:31'!
checkoutCart: aSmallInteger 
	self shouldBeImplemented.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:18:00' prior: 50790104!
checkoutCart: aCartID
	! !

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:18:02'!
FAILURE!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:19:04' prior: 50790021!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = testObjectsFactory itemSoldByTheStorePrice.
! !

!methodRemoval: UserAPI #checkoutCart: stamp: 'fz 11/11/2019 19:19:14'!
checkoutCart: aCartID
	!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:19:19'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:19:26'!
checkoutCart: aSmallInteger withCreditCard: aCreditCard 
	self shouldBeImplemented.! !

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/11/2019 19:21:06'!
Object subclass: #UserAPI
	instanceVariableNames: 'uM cartsRegister catalog currentID clock cartTimeRegister salesBook merchantProcessor'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:21:03' prior: 50790144!
checkoutCart: aCartID withCreditCard: aCreditCard
	|cashier|
	cashier:= Cashier 
		toCheckout: (self cartOfID: aCartID)
		charging: aCreditCard
		throught: merchantProcessor
		on: clock today
		registeringOn: salesBook.
		
	^cashier checkOut.! !

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:21:12'!
ERROR!
!UserAPITest methodsFor: 'clock' stamp: 'fz 11/11/2019 19:21:19'!
today
	self shouldBeImplemented.! !
!UserAPITest methodsFor: 'clock' stamp: 'fz 11/11/2019 19:21:56' prior: 50790172!
today
	^testObjectsFactory today.! !

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:21:58'!
ERROR!
!UserAPI class methodsFor: 'instance creation' stamp: 'fz 11/11/2019 19:24:34'!
withUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMP    
	^self new initializeWithUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook . ! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50789813!
test07ListCartOfNewCartIsEmpty
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI listCart: cartID) isEmpty.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50789826!
test06AddingItemsWithMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	
	
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cart2ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: ((userAPI cartOfID: cart1ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 0.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50789853!
test10canNotAddItemsToCartAfter30Mins
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50789874!
test02CartIsCreatedForValidUserAndIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI isValidCartID: cartID).! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50789887!
test13CanNotLIstInvalidCartID
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI listCart: invalidCartID ]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50789907!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: OrderedCollection new merchantProcessor: self.
	
	self should: [userAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50789924!
test05CanNotAddItemsToInvalidCartID
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50789946!
test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 20).
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 20).
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: itemsList size equals: 2.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50789973!
test08ListCartReflectsAddedItems
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: (itemsList occurrencesOf: testObjectsFactory anotherItemSoldByTheStore) equals: 1.
	self assert: itemsList size equals: 3.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50790002!
test12canNotListCartAfter30Mins
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [userAPI listCart: cartID]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50790116!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = testObjectsFactory itemSoldByTheStorePrice.
! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50790042!
test09newCartHasLastAccesedTimeRightNow
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI lastAccesedTime: cartID) equals: self currentTime.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50790056!
test03CreateCartFailsWithWrongPassword
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: OrderedCollection new merchantProcessor: self.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:24:34' prior: 50790073!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !

!methodRemoval: UserAPI class #withUserManager:clock:catalog:salesBook: stamp: 'fz 11/11/2019 19:24:34'!
withUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook   
	^self new initializeWithUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook . !
!UserAPI class methodsFor: 'instance creation' stamp: 'fz 11/11/2019 19:24:46' prior: 50790183!
withUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMP    
	^self new initializeWithUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook . ! !
!UserAPI class methodsFor: 'instance creation' stamp: 'fz 11/11/2019 19:24:54' prior: 50790492!
withUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMerchantProcessor    
	^self new initializeWithUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook . ! !
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/11/2019 19:25:25'!
initializeWithUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMerchantProcessor    
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.
	cartTimeRegister := Dictionary new.
	salesBook := aSalesBook.! !
!UserAPI class methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:25:25' prior: 50790502!
withUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMerchantProcessor    
	^self new initializeWithUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMerchantProcessor . ! !

!methodRemoval: UserAPI #initializeWithUserManager:clock:catalog:salesBook: stamp: 'fz 11/11/2019 19:25:25'!
initializeWithUserManager: aUM clock: aClock catalog: aCatalog salesBook: aSalesBook   
	uM := aUM.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.
	cartTimeRegister := Dictionary new.
	salesBook := aSalesBook.!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/11/2019 19:25:35' prior: 50790512!
initializeWithUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMerchantProcessor    
	uM := aUserManager.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.
	cartTimeRegister := Dictionary new.
	salesBook := aSalesBook.! !

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/11/2019 19:25:41'!
Object subclass: #UserAPI
	instanceVariableNames: 'userManager cartsRegister catalog currentID clock cartTimeRegister salesBook merchantProcessor'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:25:41' prior: 50788772!
createCartOf: aUser withPassword: aPassword 
	|cartID|
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotCreateCartWithInvalidCredentialsErrorMessage].
	
	cartID := currentID.
	currentID  := currentID +1.
	
	cartsRegister at: cartID put: (Cart acceptingItemsOf: catalog).
	cartTimeRegister at: cartID put: clock currentTime.
	
	^cartID.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:25:41' prior: 50790548!
initializeWithUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMerchantProcessor    
	userManager := aUserManager.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.
	cartTimeRegister := Dictionary new.
	salesBook := aSalesBook.! !
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/11/2019 19:25:53' prior: 50790586!
initializeWithUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMerchantProcessor    
	userManager := aUserManager.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.
	cartTimeRegister := Dictionary new.
	salesBook := aSalesBook.
	merchantProcessor := aMerchantProcessor.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:26:11' prior: 50790159!
checkoutCart: aCartID withCreditCard: aCreditCard
	|cashier|
	
	cashier:= Cashier 
		toCheckout: (self cartOfID: aCartID)
		charging: aCreditCard
		throught: merchantProcessor
		on: clock today
		registeringOn: salesBook.
		
	^cashier checkOut.! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/11/2019 19:26:37'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time total'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:26:35' prior: 50790409!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = total.
! !

TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/11/2019 19:26:44'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:26:58' prior: 50790636!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook total|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: OrderedCollection new merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = total.
! !

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:27:01'!
ERROR!
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:27:10'!
debit: aSmallInteger from: aCreditCard 
	self shouldBeImplemented.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:28:07' prior: 50790702!
debit: anAmount from: aCreditCard ! !

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:28:08'!
FAILURE!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:32:54' prior: 50790677!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook total|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = total.
! !

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:32:56'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/11/2019 19:33:00'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:33:00'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:36:41'!
test15afterCheckOutCartIDIsInvalid
	|userAPI cartID salesBook total|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = total.
! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:37:34' prior: 50790785!
test15afterCheckOutCartIDIsInvalid
	|userAPI cartID salesBook|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/11/2019 19:37:36'!
FAILURE!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:37:49' prior: 50790614!
checkoutCart: aCartID withCreditCard: aCreditCard
	|cashier|
	
	cashier:= Cashier 
		toCheckout: (self cartOfID: aCartID)
		charging: aCreditCard
		throught: merchantProcessor
		on: clock today
		registeringOn: salesBook.
		
		
		
	^cashier checkOut.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:39:02' prior: 50790837!
checkoutCart: aCartID withCreditCard: aCreditCard
	|cashier total|
	
	cashier:= Cashier 
		toCheckout: (self cartOfID: aCartID)
		charging: aCreditCard
		throught: merchantProcessor
		on: clock today
		registeringOn: salesBook.
		
	total := cashier checkOut.
	cartsRegister removeKey: aCartID.
	cartTimeRegister removeKey: aCartID.
	
	^total.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 19:39:06'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 19:39:06'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 19:39:06'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 19:39:06'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 19:39:06'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 19:39:06'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 19:39:06'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 19:39:06'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 19:39:06'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 19:39:06'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/11/2019 19:39:07'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/11/2019 19:39:07'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/11/2019 19:39:07'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:39:07'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/11/2019 19:39:07'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:39:49'!
test16cannotCheckoutAfter30Minutes
	|userAPI cartID salesBook|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:40:19' prior: 50790910!
test16cannotCheckoutAfter30Minutes
	|userAPI cartID salesBook|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
			
	self should: [userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage ].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:40:30' prior: 50790936!
test16cannotCheckoutAfter30Minutes
	|userAPI cartID salesBook|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 31).
			
	self should: [userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage ].! !

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/11/2019 19:40:31'!
FAILURE!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:40:53' prior: 50790848!
checkoutCart: aCartID withCreditCard: aCreditCard
	|cashier total|
	self assertValidCart: aCartID.
	
	cashier:= Cashier 
		toCheckout: (self cartOfID: aCartID)
		charging: aCreditCard
		throught: merchantProcessor
		on: clock today
		registeringOn: salesBook.
		
	total := cashier checkOut.
	cartsRegister removeKey: aCartID.
	cartTimeRegister removeKey: aCartID.
	
	^total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:41:14'!
test16cannotCheckoutInvalidCart
	|userAPI cartID salesBook|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 31).
			
	self should: [userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage ].! !

!methodRemoval: UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/11/2019 19:41:20'!
test16cannotCheckoutAfter30Minutes
	|userAPI cartID salesBook|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 31).
			
	self should: [userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage ].!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:41:47'!
test16cannotCheckoutAfter30Minutes
	|userAPI cartID salesBook|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 31).
			
	self should: [userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage ].! !

!methodRemoval: UserAPITest #test16cannotCheckoutInvalidCart stamp: 'fz 11/11/2019 19:41:47'!
test16cannotCheckoutInvalidCart
	|userAPI cartID salesBook|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 31).
			
	self should: [userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage ].!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:52:30' prior: 50790715!
test14cartCheckoutRegistersSales
	|userAPI cartID salesBook total|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = total.
	
	"ac podran venir muchos tests medio redudantes de la lgica de cashier, no sera TDD sino testing, decidimos no agregarlos ya que nos parece que no es lo importante del ejercicio"
! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:53:51'!
test17ListPurchasesFailsWithInvalidCredentials
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: OrderedCollection new merchantProcessor: self.
	
	self should: [userAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:54:30' prior: 50791130!
test17ListPurchasesFailsWithInvalidCredentials
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: OrderedCollection new merchantProcessor: self.
	
	self should: [userAPI listPurchasesOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotListPurchasesWithInvalidCredentialsErrorMessage].! !

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/11/2019 19:54:33'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:54:39'!
listPurchasesOf: aString withPassword: aString2 
	self shouldBeImplemented.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:54:50' prior: 50791168!
listPurchasesOf: aUser withPassword: aPassword
	! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 19:55:48' prior: 50791174!
listPurchasesOf: aUser withPassword: aPassword
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotListPurchasesWithInvalidCredentialsErrorMessage].! !

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/11/2019 19:55:50'!
ERROR!
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/11/2019 19:55:59'!
canNotListPurchasesWithInvalidCredentialsErrorMessage
	self shouldBeImplemented.! !
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/11/2019 19:56:13' prior: 50791192!
canNotListPurchasesWithInvalidCredentialsErrorMessage
	^'invalid credentials'! !

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/11/2019 19:56:15'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/11/2019 19:56:15'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 19:58:47'!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI cartID salesBook total|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: salesBook size = 1.
	self assert: salesBook first total = total.
! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/11/2019 20:00:06'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time purchases'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:00:05' prior: 50791262!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI cartID salesBook total|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases 
! !

TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/11/2019 20:00:16'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:00:28' prior: 50791296!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI cartID salesBook total purchases |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases .
! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:01:15' prior: 50791338!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI cartID salesBook total purchases |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: (purchases includes: 3).
! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:03:15' prior: 50791362!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI cartID salesBook total purchases |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: purchases first .
	self assert: purchases first total = total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:09:15' prior: 50791386!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI cartID salesBook total purchases |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:10:43'!
ERROR!
!Sale class methodsFor: 'instance creation' stamp: 'fz 11/11/2019 20:13:30'!
of: aTotal listOfItems: aListOfItems 

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal ! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 20:13:30' prior: 50785507!
createSale

	^ Sale of: total listOfItems: OrderedCollection new
! !

!methodRemoval: Sale class #of: stamp: 'fz 11/11/2019 20:13:30'!
of: aTotal

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal !
!Sale methodsFor: 'initialization' stamp: 'fz 11/11/2019 20:17:13'!
initializeTotal: aTotal listOfItems: aListOfItems 

	total := aTotal ! !
!Sale class methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 20:17:13' prior: 50791444!
of: aTotal listOfItems: aListOfItems 

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems ! !

!methodRemoval: Sale #initializeTotal: stamp: 'fz 11/11/2019 20:17:13'!
initializeTotal: aTotal

	total := aTotal !

!classDefinition: #Sale category: #TusLibros stamp: 'fz 11/11/2019 20:17:44'!
Object subclass: #Sale
	instanceVariableNames: 'total listOfItems'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Sale methodsFor: 'initialization' stamp: 'fz 11/11/2019 20:17:41' prior: 50791461!
initializeTotal: aTotal listOfItems: aListOfItems 

	total := aTotal.
	listOfItems := aListOfItems.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 20:21:03' prior: 50791179!
listPurchasesOf: aUser withPassword: aPassword
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotListPurchasesWithInvalidCredentialsErrorMessage].
	
	^salesBook first.! !

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:21:19'!
ERROR!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:21:19'!
ERROR!
!Sale methodsFor: 'nil' stamp: 'fz 11/11/2019 20:22:06'!
size
	^listOfItems size.! !

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:22:32'!
FAILURE!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:22:32'!
FAILURE!

self first!

self first!

self size!
!Cashier methodsFor: 'checkout - private' stamp: 'fz 11/11/2019 20:23:50' prior: 50791451!
createSale

	^ Sale of: total listOfItems: cart listItems
! !

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:23:54'!
ERROR!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:23:54'!
ERROR!
!Sale methodsFor: 'testing' stamp: 'fz 11/11/2019 20:24:07'!
occurrencesOf: aString 
	self shouldBeImplemented.! !
!Sale methodsFor: 'testing' stamp: 'fz 11/11/2019 20:24:25' prior: 50791534!
occurrencesOf: anItem
	^listOfItems occurrencesOf: anItem
	! !

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:24:26'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:24:29'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:24:35'!
PASSED!

----SNAPSHOT----(11 November 2019 20:24:41) CuisUniversity-3938.image priorSource: 14644516!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/11/2019 20:24:46'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:24:46'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:28:11'!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID salesBook total purchases |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/11/2019 20:29:16'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time anotherValidClient'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:29:13' prior: 50791718!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID salesBook total purchases |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	anotherClientCartID := userAPI createCartOf: anotherValidClient withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:29:33' prior: 50791759!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID salesBook total purchases |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	anotherClientCartID := userAPI createCartOf: anotherValidClient withPassword: validUserPassword.
	userAPI addToCart: anotherClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/11/2019 20:29:45'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time anotherValidUser'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 20:29:45' prior: 50791795!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID salesBook total purchases |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	anotherClientCartID := userAPI createCartOf: anotherValidUser withPassword: validUserPassword.
	userAPI addToCart: anotherClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/11/2019 20:29:59'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time anotherValidUser anotherValidUserPassword'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:29:57' prior: 50791843!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID salesBook total purchases |
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: salesBook merchantProcessor: self.
	
	anotherClientCartID := userAPI createCartOf: anotherValidUser withPassword: anotherValidUserPassword.
	userAPI addToCart: anotherClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:30:51' prior: 50788630!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	validUserButWrongPassword := 'wrongPassword'.	
	
	anotherValidUser := 'anotherValidUser'.
	anotherValidUserPassword := 'anotherValidUserPassword'.
	
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword .
	
	testObjectsFactory := StoreTestObjectsFactory new.
	
	time := GregorianDateTime now.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:30:53' prior: 50791927!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	validUserButWrongPassword := 'wrongPassword'.	
	
	anotherValidUser := 'anotherValidUser'.
	anotherValidUserPassword := 'anotherValidUserPassword'.
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword .
	
	testObjectsFactory := StoreTestObjectsFactory new.
	
	time := GregorianDateTime now.! !

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/11/2019 20:31:37'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time anotherValidUser anotherValidUserPassword emptySalesBook'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:31:36' prior: 50791891!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	anotherClientCartID := userAPI createCartOf: anotherValidUser withPassword: anotherValidUserPassword.
	userAPI addToCart: anotherClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:32:00' prior: 50791945!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	validUserButWrongPassword := 'wrongPassword'.	
	
	anotherValidUser := 'anotherValidUser'.
	anotherValidUserPassword := 'anotherValidUserPassword'.
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword .
	
	testObjectsFactory := StoreTestObjectsFactory new.
	
	time := GregorianDateTime now.
	
	emptySalesBook := OrderedCollection new.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:32:17' prior: 50791412!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI cartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/11/2019 20:32:19'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:32:40' prior: 50790807!
test15afterCheckOutCartIDIsInvalid
	|userAPI cartID salesBook|
	
	salesBook := OrderedCollection new.
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:32:45' prior: 50792061!
test15afterCheckOutCartIDIsInvalid
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:32:54' prior: 50791053!
test16cannotCheckoutAfter30Minutes
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 31).
			
	self should: [userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage ].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:33:17' prior: 50791147!
test17ListPurchasesFailsWithInvalidCredentials
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: emptySalesBook merchantProcessor: self.
	
	self should: [userAPI listPurchasesOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotListPurchasesWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:33:26' prior: 50790271!
test13CanNotLIstInvalidCartID
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI listCart: invalidCartID ]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:33:40' prior: 50791103!
test14cartCheckoutRegistersSales
	|userAPI cartID total|
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	
	"ac podran venir muchos tests medio redudantes de la lgica de cashier, no sera TDD sino testing, decidimos no agregarlos ya que nos parece que no es lo importante del ejercicio"
! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:33:50' prior: 50790389!
test12canNotListCartAfter30Mins
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [userAPI listCart: cartID]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:33:56' prior: 50790332!
test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 20).
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 20).
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: itemsList size equals: 2.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:34:01' prior: 50790235!
test10canNotAddItemsToCartAfter30Mins
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:34:08' prior: 50790432!
test09newCartHasLastAccesedTimeRightNow
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI lastAccesedTime: cartID) equals: self currentTime.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:34:21' prior: 50790360!
test08ListCartReflectsAddedItems
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: (itemsList occurrencesOf: testObjectsFactory anotherItemSoldByTheStore) equals: 1.
	self assert: itemsList size equals: 3.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:34:26' prior: 50790193!
test07ListCartOfNewCartIsEmpty
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI listCart: cartID) isEmpty.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:34:32' prior: 50790207!
test06AddingItemsWithMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	
	
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cart2ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: ((userAPI cartOfID: cart1ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 0.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:34:37' prior: 50790309!
test05CanNotAddItemsToInvalidCartID
	|userAPI cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:34:43' prior: 50790465!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI cartOfID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:34:51' prior: 50790447!
test03CreateCartFailsWithWrongPassword
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: emptySalesBook merchantProcessor: self.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:34:56' prior: 50790257!
test02CartIsCreatedForValidUserAndIsEmpty
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI isValidCartID: cartID).! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:35:04' prior: 50790292!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: emptySalesBook merchantProcessor: self.
	
	self should: [userAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI canNotCreateCartWithInvalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:35:29' prior: 50791976!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	anotherClientCartID := userAPI createCartOf: anotherValidUser withPassword: anotherValidUserPassword.
	userAPI addToCart: anotherClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI checkoutCart: anotherClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:35:56' prior: 50792439!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	anotherClientCartID := userAPI createCartOf: anotherValidUser withPassword: anotherValidUserPassword.
	userAPI addToCart: anotherClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI checkoutCart: anotherClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:36:09' prior: 50792477!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	anotherClientCartID := userAPI createCartOf: anotherValidUser withPassword: anotherValidUserPassword.
	userAPI addToCart: anotherClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 2.
	userAPI checkoutCart: anotherClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases size = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 20:36:14'!
ERROR!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 20:36:15'!
ERROR!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/11/2019 20:36:42' prior: 50792011!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	validUserButWrongPassword := 'wrongPassword'.	
	
	anotherValidUser := 'anotherValidUser'.
	anotherValidUserPassword := 'anotherValidUserPassword'.
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword.
	usersLog at: anotherValidUser put: anotherValidUserPassword.	
	
	testObjectsFactory := StoreTestObjectsFactory new.
	
	time := GregorianDateTime now.
	
	emptySalesBook := OrderedCollection new.! !

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 20:36:46'!
FAILURE!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 20:36:46'!
FAILURE!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 20:47:46'!
FAILURE!
!Cashier class methodsFor: 'instance creation' stamp: 'fz 11/11/2019 21:13:30'!
toCheckout: aCart ofClient: aClient charging: aCreditCard throught: aMerchantProcessor on: aDate registeringOn: aSalesBook
	
	self assertIsNotEmpty: aCart.
	self assertIsNotExpired: aCreditCard on: aDate.
	
	^self new initializeToCheckout: aCart charging: aCreditCard throught: aMerchantProcessor registeringOn: aSalesBook! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:13:30' prior: 50786824!
test05CashierChargesCreditCardUsingMerchantProcessor

	| cart cashier salesBook total creditCard debitedAmout debitedCreditCard  |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSoldByTheStore.
	creditCard := testObjectsFactory notExpiredCreditCard.
	salesBook := OrderedCollection new.
 
	cashier:= Cashier 
		toCheckout: cart 
		ofClient: testObjectsFactory validClient charging: creditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.
		
	debitBehavior := [ :anAmount :aCreditCard | 
		debitedAmout := anAmount.
		debitedCreditCard := aCreditCard ].
	total := cashier checkOut.
					
	self assert: debitedCreditCard = creditCard.
	self assert: debitedAmout = total.! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:13:30' prior: 50789639!
test02CalculatedTotalIsCorrect

	| cart cashier |
	
	cart := testObjectsFactory createCart.
	cart add: 2 of: testObjectsFactory itemSoldByTheStore.
	
	cashier :=  Cashier
		toCheckout: cart 
		ofClient: testObjectsFactory validClient charging: testObjectsFactory notExpiredCreditCard 
		throught: self
		on: testObjectsFactory today 
		registeringOn: OrderedCollection new.
		
	self assert: cashier checkOut = (testObjectsFactory itemSoldByTheStorePrice * 2)! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:13:30' prior: 50786888!
test04CheckoutRegistersASale

	| cart cashier salesBook total |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSoldByTheStore.
	salesBook := OrderedCollection new.
 
	cashier:= Cashier 
		toCheckout: cart 
		ofClient: testObjectsFactory validClient charging: testObjectsFactory notExpiredCreditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.
		
	total := cashier checkOut.
					
	self assert: salesBook size = 1.
	self assert: salesBook first total = total.! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:13:30' prior: 50786866!
test03CanNotCheckoutWithAnExpiredCreditCart

	| cart salesBook |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSoldByTheStore.
	salesBook := OrderedCollection new.
	
	self
		should: [ Cashier 
				toCheckout: cart 
				ofClient: testObjectsFactory validClient charging: testObjectsFactory expiredCreditCard 
				throught: self
				on: testObjectsFactory today
				registeringOn: salesBook ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError | 
			self assert: anError messageText = Cashier canNotChargeAnExpiredCreditCardErrorMessage.
			self assert: salesBook isEmpty ]! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:13:30' prior: 50786906!
test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit

	| cart cashier salesBook creditCard |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSoldByTheStore.
	creditCard := testObjectsFactory notExpiredCreditCard.
	salesBook := OrderedCollection new.
 	debitBehavior := [ :anAmount :aCreditCard | self error: Cashier creditCardHasNoCreditErrorMessage].
	
	cashier:= Cashier 
		toCheckout: cart 
		ofClient: testObjectsFactory validClient charging: creditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.
		
	self 
		should: [cashier checkOut ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cashier creditCardHasNoCreditErrorMessage.
			self assert: salesBook isEmpty ]! !
!CashierTest methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:13:30' prior: 50785687!
test01CanNotCheckoutAnEmptyCart

	| salesBook |
	
	salesBook := OrderedCollection new.
	self 
		should: [ Cashier 
			toCheckout: testObjectsFactory createCart 
			ofClient: testObjectsFactory validClient charging: testObjectsFactory notExpiredCreditCard 
			throught: self
			on: testObjectsFactory today
			registeringOn:  salesBook ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cashier cartCanNotBeEmptyErrorMessage.
			self assert: salesBook isEmpty ]! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:13:30' prior: 50790989!
checkoutCart: aCartID withCreditCard: aCreditCard
	|cashier total|
	self assertValidCart: aCartID.
	
	cashier:= Cashier 
		toCheckout: (self cartOfID: aCartID)
		ofClient: testObjectsFactory validClient charging: aCreditCard
		throught: merchantProcessor
		on: clock today
		registeringOn: salesBook.
		
	total := cashier checkOut.
	cartsRegister removeKey: aCartID.
	cartTimeRegister removeKey: aCartID.
	
	^total.! !

!methodRemoval: Cashier class #toCheckout:charging:throught:on:registeringOn: stamp: 'fz 11/11/2019 21:13:30'!
toCheckout: aCart charging: aCreditCard throught: aMerchantProcessor on: aDate registeringOn: aSalesBook
	
	self assertIsNotEmpty: aCart.
	self assertIsNotExpired: aCreditCard on: aDate.
	
	^self new initializeToCheckout: aCart charging: aCreditCard throught: aMerchantProcessor registeringOn: aSalesBook!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'fz 11/11/2019 21:13:35'!
ERROR!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'fz 11/11/2019 21:13:35'!
ERROR!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'fz 11/11/2019 21:13:35'!
ERROR!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'fz 11/11/2019 21:13:35'!
ERROR!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'fz 11/11/2019 21:13:35'!
ERROR!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'fz 11/11/2019 21:13:35'!
ERROR!
!Cashier methodsFor: 'initialization' stamp: 'fz 11/11/2019 21:14:00'!
initializeToCheckout: aCart ofClient: aClient charging: aCreditCard throught: aMerchantProcessor registeringOn: aSalesBook
	
	cart := aCart.
	creditCard := aCreditCard.
	merchantProcessor := aMerchantProcessor.
	salesBook := aSalesBook! !
!Cashier class methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:14:00' prior: 50792592!
toCheckout: aCart ofClient: aClient charging: aCreditCard throught: aMerchantProcessor on: aDate registeringOn: aSalesBook
	
	self assertIsNotEmpty: aCart.
	self assertIsNotExpired: aCreditCard on: aDate.
	
	^self new initializeToCheckout: aCart ofClient: aClient charging: aCreditCard throught: aMerchantProcessor registeringOn: aSalesBook! !

!methodRemoval: Cashier #initializeToCheckout:charging:throught:registeringOn: stamp: 'fz 11/11/2019 21:14:00'!
initializeToCheckout: aCart charging: aCreditCard throught: aMerchantProcessor registeringOn: aSalesBook
	
	cart := aCart.
	creditCard := aCreditCard.
	merchantProcessor := aMerchantProcessor.
	salesBook := aSalesBook!
!StoreTestObjectsFactory methodsFor: 'nil' stamp: 'fz 11/11/2019 21:14:13'!
validClient
	^'validClient'! !

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'fz 11/11/2019 21:14:20'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'fz 11/11/2019 21:14:20'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'fz 11/11/2019 21:14:20'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'fz 11/11/2019 21:14:20'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'fz 11/11/2019 21:14:20'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'fz 11/11/2019 21:14:20'!
PASSED!

!classDefinition: #Cashier category: #TusLibros stamp: 'fz 11/11/2019 21:14:36'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook merchantProcessor creditCard total client'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Cashier methodsFor: 'initialization' stamp: 'fz 11/11/2019 21:14:35' prior: 50792790!
initializeToCheckout: aCart ofClient: aClient charging: aCreditCard throught: aMerchantProcessor registeringOn: aSalesBook
	
	cart := aCart.
	creditCard := aCreditCard.
	merchantProcessor := aMerchantProcessor.
	salesBook := aSalesBook.
	client := aClient.! !
!Sale class methodsFor: 'instance creation' stamp: 'fz 11/11/2019 21:15:50'!
of: aTotal listOfItems: aListOfItems forClient: aClient  

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems ! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:15:50' prior: 50791522!
createSale

	^ Sale of: total listOfItems: cart listItems forClient: client
! !

!methodRemoval: Sale class #of:listOfItems: stamp: 'fz 11/11/2019 21:15:50'!
of: aTotal listOfItems: aListOfItems 

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems !
!Sale methodsFor: 'initialization' stamp: 'fz 11/11/2019 21:16:13'!
initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient  

	total := aTotal.
	listOfItems := aListOfItems.! !
!Sale class methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:16:13' prior: 50792868!
of: aTotal listOfItems: aListOfItems forClient: aClient  

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient ! !

!methodRemoval: Sale #initializeTotal:listOfItems: stamp: 'fz 11/11/2019 21:16:13'!
initializeTotal: aTotal listOfItems: aListOfItems 

	total := aTotal.
	listOfItems := aListOfItems.!

!classDefinition: #Sale category: #TusLibros stamp: 'fz 11/11/2019 21:16:22'!
Object subclass: #Sale
	instanceVariableNames: 'total listOfItems client'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Sale methodsFor: 'initialization' stamp: 'fz 11/11/2019 21:16:21' prior: 50792889!
initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient  

	total := aTotal.
	listOfItems := aListOfItems.
	client := aClient.! !
!Sale methodsFor: 'testing' stamp: 'fz 11/11/2019 21:16:50'!
client
	^client! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:20:00' prior: 50791492!
listPurchasesOf: aUser withPassword: aPassword
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotListPurchasesWithInvalidCredentialsErrorMessage].
	
	^salesBook inject: OrderedCollection new into: [:clientSales :aSale | aSale client = aUser ifTrue: [clientSales add: aSale]].! !

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 21:20:14'!
ERROR!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 21:20:14'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:21:04' prior: 50792741!
checkoutCart: aCartID withCreditCard: aCreditCard
	|cashier total|
	self assertValidCart: aCartID.
	
	cashier:= Cashier 
		toCheckout: (self cartOfID: aCartID)
		ofClient: (self clientOfID: aCartID) 
		charging: aCreditCard
		throught: merchantProcessor
		on: clock today
		registeringOn: salesBook.
		
	total := cashier checkOut.
	cartsRegister removeKey: aCartID.
	cartTimeRegister removeKey: aCartID.
	
	^total.! !

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/11/2019 21:21:39'!
Object subclass: #UserAPI
	instanceVariableNames: 'userManager cartsRegister catalog currentID clock cartTimeRegister salesBook merchantProcessor cartClientRegister'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:21:38' prior: 50792950!
checkoutCart: aCartID withCreditCard: aCreditCard
	|cashier total|
	self assertValidCart: aCartID.
	
	cashier:= Cashier 
		toCheckout: (self cartOfID: aCartID)
		ofClient: (self clientOfID: aCartID) 
		charging: aCreditCard
		throught: merchantProcessor
		on: clock today
		registeringOn: salesBook.
		
	total := cashier checkOut.
	cartsRegister removeKey: aCartID.
	cartTimeRegister removeKey: aCartID.
	cartClientRegister removeKey: aCartID.
	
	^total.! !
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/11/2019 21:22:07' prior: 50790599!
initializeWithUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMerchantProcessor    
	userManager := aUserManager.
	catalog := aCatalog.
	cartsRegister := Dictionary new.
	currentID := 1.
	clock := aClock.
	cartTimeRegister := Dictionary new.
	cartClientRegister := Dictionary new.
	salesBook := aSalesBook.
	merchantProcessor := aMerchantProcessor.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/11/2019 21:22:33' prior: 50790571!
createCartOf: aUser withPassword: aPassword 
	|cartID|
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotCreateCartWithInvalidCredentialsErrorMessage].
	
	cartID := currentID.
	currentID  := currentID +1.
	
	cartsRegister at: cartID put: (Cart acceptingItemsOf: catalog).
	cartTimeRegister at: cartID put: clock currentTime.
	cartClientRegister at: cartID put: aUser.
	
	^cartID.! !

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 21:22:38'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:22:44'!
clientOfID: aSmallInteger 
	self shouldBeImplemented.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:23:03' prior: 50793029!
clientOfID: aCartID
	^cartClientRegister at: aCartID ! !

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 21:23:05'!
ERROR!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 21:23:17'!
ERROR!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 21:23:17'!
ERROR!
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/11/2019 21:26:20' prior: 50792929!
listPurchasesOf: aUser withPassword: aPassword
	| clientSales |
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotListPurchasesWithInvalidCredentialsErrorMessage].
	
	clientSales := OrderedCollection new.
	salesBook do:[:aSale | aSale client = aUser ifTrue: [clientSales add: aSale]].
	^clientSales ! !

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/11/2019 21:26:25'!
FAILURE!

----SNAPSHOT----(11 November 2019 21:27:12) CuisUniversity-3938.image priorSource: 14718722!

----QUIT----(13 November 2019 19:22:49) CuisUniversity-3938.image priorSource: 14765328!

----STARTUP---- (14 November 2019 17:18:12) as /home/akima/Documents/ing_II/repo/cuis/CuisUniversity-3938.image!


!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 17:18:18'!
FAILURE!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 17:18:18'!
FAILURE!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 17:19:31'!
FAILURE!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 17:19:31'!
FAILURE!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 17:19:38'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 17:19:44'!
FAILURE!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 17:19:44'!
FAILURE!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 17:19:54'!
FAILURE!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 17:19:54'!
FAILURE!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 17:20:02'!
FAILURE!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 17:20:02'!
FAILURE!
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 17:24:19' prior: 50793050!
listPurchasesOf: aUser withPassword: aPassword
	| clientPurchases |
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotListPurchasesWithInvalidCredentialsErrorMessage].
	
	clientPurchases := OrderedCollection new.
	salesBook do:[:aSale | aSale client = aUser ifTrue: [clientPurchases add: aSale]].
	^clientPurchases ! !
!Sale methodsFor: 'initialization' stamp: 'fz 11/14/2019 17:25:38'!
items
	^ listOfItems copy! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 17:33:54' prior: 50793118!
listPurchasesOf: aUser withPassword: aPassword
	| clientPurchases |
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotListPurchasesWithInvalidCredentialsErrorMessage].
	
	clientPurchases := OrderedCollection new.
	salesBook select:[:aSale | aSale client = aUser].
	^clientPurchases ! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 17:33:59' prior: 50793136!
listPurchasesOf: aUser withPassword: aPassword
	| clientPurchases |
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotListPurchasesWithInvalidCredentialsErrorMessage].
	
	clientPurchases := salesBook select:[:aSale | aSale client = aUser].
	^clientPurchases ! !

!classDefinition: #PurchaseSummary category: #TusLibros stamp: 'fz 11/14/2019 17:44:05'!
Object subclass: #PurchaseSummary
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 17:44:01' prior: 50793149!
listPurchasesOf: aUser withPassword: aPassword
	| clientPurchases |
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotListPurchasesWithInvalidCredentialsErrorMessage].
	
	
	clientPurchases := PurchaseSummary ofClient: aUser withSales: (salesBook select:[:aSale | aSale client = aUser]).
	^clientPurchases ! !

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 17:44:22'!
ERROR!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 17:44:22'!
ERROR!
!PurchaseSummary class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 17:44:29'!
ofClient: aString withSales: anOrderedCollection 
	"DO NOT FORGET TO RENAME COLLABORATORS AND REMOVE THIS COMMENT!!!!"
	self shouldBeImplemented.
	^self new initializeOfClient: aString withSales: anOrderedCollection ! !
!PurchaseSummary class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 17:44:45' prior: 50793190!
ofClient: aClient withSales: anOrderedCollection 
	^self new initializeOfClient: aClient withSales: anOrderedCollection ! !
!PurchaseSummary class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 17:44:53' prior: 50793201!
ofClient: aClient withSales: aSales 
	^self new initializeOfClient: aClient withSales: aSales ! !

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 17:45:03'!
ERROR!

!classDefinition: #PurchaseSummary category: #TusLibros stamp: 'fz 11/14/2019 17:45:15'!
Object subclass: #PurchaseSummary
	instanceVariableNames: 'client'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #PurchaseSummary category: #TusLibros stamp: 'fz 11/14/2019 17:45:15'!
Object subclass: #PurchaseSummary
	instanceVariableNames: 'client sales'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!PurchaseSummary methodsFor: 'initialization' stamp: 'fz 11/14/2019 17:45:15'!
initializeOfClient: aClient withSales: aSales 
	self shouldBeImplemented.
	client := aClient.
	sales := aSales.! !
!PurchaseSummary methodsFor: 'initialization' stamp: 'fz 11/14/2019 17:45:32' prior: 50793233!
initializeOfClient: aClient withSales: salesOfClient
	client := aClient.
	sales := salesOfClient.! !
!PurchaseSummary class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 17:45:48' prior: 50793209!
ofClient: aClient withSales: salesOfClient 
	^self new initializeOfClient: aClient withSales: salesOfClient ! !

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 17:45:52'!
ERROR!
!PurchaseSummary methodsFor: 'nil' stamp: 'fz 11/14/2019 17:50:12'!
itemsPurchased
	^sales size! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 17:57:13' prior: 50792030!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI cartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

#(1 2 3) inject: 0 into: [:total :next | total + next]!
!PurchaseSummary methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 17:58:48' prior: 50793257!
itemsPurchased
	^sales inject: 0 into: [:total :sale | total + sale size]! !
!PurchaseSummary methodsFor: 'testing' stamp: 'fz 11/14/2019 17:59:56'!
occurrencesOf: anItem
	^sales inject: 0 into: [:total :sale | total + (sale occurrencesOf: anItem)]! !
!PurchaseSummary methodsFor: 'testing' stamp: 'fz 11/14/2019 18:00:28'!
total
	^sales inject: 0 into: [:total :sale | total + sale total]! !

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 18:00:33'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:00:36'!
ERROR!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:00:36'!
ERROR!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 18:00:50' prior: 50792515!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	anotherClientCartID := userAPI createCartOf: anotherValidUser withPassword: anotherValidUserPassword.
	userAPI addToCart: anotherClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 2.
	userAPI checkoutCart: anotherClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:00:53'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 18:00:55'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:00:56'!
PASSED!

----SNAPSHOT----(14 November 2019 18:01:08) CuisUniversity-3938.image priorSource: 14765422!
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:01:42' prior: 50792877!
createSale

	^ Ticket of: total listOfItems: cart listItems forClient: client
! !
!Cashier methodsFor: 'checkout - private' stamp: 'fz 11/14/2019 18:02:25'!
createTicket

	^ Ticket of: total listOfItems: cart listItems forClient: client
! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:02:25' prior: 50785502!
registerSale

	salesBook add: self createTicket! !

!methodRemoval: Cashier #createSale stamp: 'fz 11/14/2019 18:02:25'!
createSale

	^ Ticket of: total listOfItems: cart listItems forClient: client
!
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:03:38' prior: 50793168!
listPurchasesOf: aUser withPassword: aPassword
	| |
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotListPurchasesWithInvalidCredentialsErrorMessage].
	
	^PurchaseSummary ofClient: aUser withSales: (salesBook select:[:aSale | aSale client = aUser]).! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:03:46' prior: 50793512!
listPurchasesOf: aUser withPassword: aPassword
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotListPurchasesWithInvalidCredentialsErrorMessage].
	
	^PurchaseSummary ofClient: aUser withSales: (salesBook select:[:aSale | aSale client = aUser]).! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:04:15' prior: 50793524!
listPurchasesOf: aUser withPassword: aPassword
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class canNotListPurchasesWithInvalidCredentialsErrorMessage].
	
	^PurchaseSummary ofClient: aUser withSales: (salesBook select:[:aSale | aSale isOfClient: aUser]).! !
!Ticket methodsFor: 'testing' stamp: 'fz 11/14/2019 18:04:33'!
isOfClient: aClient
	^client = aClient ! !

!methodRemoval: Ticket #client stamp: 'fz 11/14/2019 18:04:38'!
client
	^client!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:04:58'!
PASSED!

!methodRemoval: Ticket #items stamp: 'fz 11/14/2019 18:05:18'!
items
	^ listOfItems copy!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:05:22'!
PASSED!

----SNAPSHOT----(14 November 2019 18:05:29) CuisUniversity-3938.image priorSource: 14778790!
!UserAPI methodsFor: 'testing' stamp: 'fz 11/14/2019 18:07:17'!
clientOfCartID: aCartID
	^cartClientRegister at: aCartID ! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:07:17' prior: 50792976!
checkoutCart: aCartID withCreditCard: aCreditCard
	|cashier total|
	self assertValidCart: aCartID.
	
	cashier:= Cashier 
		toCheckout: (self cartOfID: aCartID)
		ofClient: (self clientOfCartID: aCartID) 
		charging: aCreditCard
		throught: merchantProcessor
		on: clock today
		registeringOn: salesBook.
		
	total := cashier checkOut.
	cartsRegister removeKey: aCartID.
	cartTimeRegister removeKey: aCartID.
	cartClientRegister removeKey: aCartID.
	
	^total.! !

!methodRemoval: UserAPI #clientOfID: stamp: 'fz 11/14/2019 18:07:17'!
clientOfID: aCartID
	^cartClientRegister at: aCartID !
!UserAPI class methodsFor: 'error messages' stamp: 'fz 11/14/2019 18:08:26'!
invalidCredentialsErrorMessage
	^ 'usuario o contrasea invalida'! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:08:26' prior: 50793009!
createCartOf: aUser withPassword: aPassword 
	|cartID|
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class invalidCredentialsErrorMessage].
	
	cartID := currentID.
	currentID  := currentID +1.
	
	cartsRegister at: cartID put: (Cart acceptingItemsOf: catalog).
	cartTimeRegister at: cartID put: clock currentTime.
	cartClientRegister at: cartID put: aUser.
	
	^cartID.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:08:26' prior: 50792392!
test03CreateCartFailsWithWrongPassword
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: emptySalesBook merchantProcessor: self.
	
	self should: [userAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:08:26' prior: 50792422!
test01CreateCartFailsWithUnknownUser
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: emptySalesBook merchantProcessor: self.
	
	self should: [userAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCredentialsErrorMessage].! !

!methodRemoval: UserAPI class #canNotCreateCartWithInvalidCredentialsErrorMessage stamp: 'fz 11/14/2019 18:08:26'!
canNotCreateCartWithInvalidCredentialsErrorMessage
	^ 'usuario o contrasea invalida'!
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:09:43'!
assertCredentialsOfUser: aUser withPassword: aPassword
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class invalidCredentialsErrorMessage].! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:10:16' prior: 50793536!
listPurchasesOf: aUser withPassword: aPassword
	self assertCredentialsOfUser: aUser withPassword: aPassword.
	
	^PurchaseSummary ofClient: aUser withSales: (salesBook select:[:aSale | aSale isOfClient: aUser]).! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 18:10:38' prior: 50792137!
test17ListPurchasesFailsWithInvalidCredentials
	|userAPI|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: emptySalesBook merchantProcessor: self.
	
	self should: [userAPI listPurchasesOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCredentialsErrorMessage].! !

!methodRemoval: UserAPI class #canNotListPurchasesWithInvalidCredentialsErrorMessage stamp: 'fz 11/14/2019 18:10:46'!
canNotListPurchasesWithInvalidCredentialsErrorMessage
	^'invalid credentials'!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:10:57'!
PASSED!

----SNAPSHOT----(14 November 2019 18:11:04) CuisUniversity-3938.image priorSource: 14785043!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 18:20:13'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:20:13'!
PASSED!
!PurchaseSummary methodsFor: 'testing' stamp: 'fz 11/14/2019 18:22:01'!
namesOfBooks
	^sales inject: Set new into: [:total :sale | total addAll: sale items]! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 18:30:05'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:30:05'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 18:30:06'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:30:06'!
PASSED!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/14/2019 18:32:46' prior: 50792994!
initializeWithUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMerchantProcessor    
	userManager := aUserManager.
	catalog := aCatalog.
	clock := aClock.
	salesBook := aSalesBook.
	merchantProcessor := aMerchantProcessor.
	
	currentID := 1.
	
	cartsRegister := Dictionary new.
	cartTimeRegister := Dictionary new.
	cartClientRegister := Dictionary new.! !

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/14/2019 18:33:21'!
Object subclass: #UserAPI
	instanceVariableNames: 'userManager cartsRegister catalog currentID clock cartTimeRegister salesBook merchantProcessor cartClientRegister sessions'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/14/2019 18:33:20' prior: 50794012!
initializeWithUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMerchantProcessor    
	userManager := aUserManager.
	catalog := aCatalog.
	clock := aClock.
	salesBook := aSalesBook.
	merchantProcessor := aMerchantProcessor.
	
	currentID := 1.
	
	sessions := Dictionary new.
	
	cartsRegister := Dictionary new.
	cartTimeRegister := Dictionary new.
	cartClientRegister := Dictionary new.! !

!classDefinition: #Session category: #TusLibros stamp: 'fz 11/14/2019 18:36:43'!
Object subclass: #Session
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:37:46' prior: 50793718!
createCartOf: aUser withPassword: aPassword 
	|cartID cart |
	(userManager isValidUser: aUser withPassword: aPassword) ifFalse: [self error: self class invalidCredentialsErrorMessage].
	
	cartID := currentID.
	currentID  := currentID +1.
	
	cart := Cart acceptingItemsOf: catalog.
	sessions at: cartID put: (Session ofUser: aUser withCart: cart lastUsedTime: clock currentTime).
	
	^cartID.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 18:37:59'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:38:02'!
ERROR!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:38:02'!
ERROR!
!Session class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 18:38:11'!
ofUser: aString withCart: aCart lastUsedTime: aGregorianDateTime 
	"DO NOT FORGET TO RENAME COLLABORATORS AND REMOVE THIS COMMENT!!!!"
	self shouldBeImplemented.
	^self new initializeOfUser: aString withCart: aCart lastUsedTime: aGregorianDateTime ! !
!Session class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 18:38:45' prior: 50794086!
ofUser: aUser withCart: aCart lastUsedTime: theLastUsedTime 
	^self new initializeOfUser: aUser withCart: aCart lastUsedTime: theLastUsedTime ! !

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:38:49'!
ERROR!

!classDefinition: #Session category: #TusLibros stamp: 'fz 11/14/2019 18:39:08'!
Object subclass: #Session
	instanceVariableNames: 'user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #Session category: #TusLibros stamp: 'fz 11/14/2019 18:39:08'!
Object subclass: #Session
	instanceVariableNames: 'user cart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #Session category: #TusLibros stamp: 'fz 11/14/2019 18:39:08'!
Object subclass: #Session
	instanceVariableNames: 'user cart theLastUsedTime_CHANGE_ME'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Session methodsFor: 'initialization' stamp: 'fz 11/14/2019 18:39:08'!
initializeOfUser: aUser withCart: aCart lastUsedTime: theLastUsedTime 
	self shouldBeImplemented.
	user := aUser.
	cart := aCart.
	theLastUsedTime_CHANGE_ME := theLastUsedTime.! !

!classDefinition: #Session category: #TusLibros stamp: 'fz 11/14/2019 18:39:24'!
Object subclass: #Session
	instanceVariableNames: 'user cart theLastUsedTime_CHANGE_ME lastUsedTime'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Session methodsFor: 'initialization' stamp: 'fz 11/14/2019 18:39:22' prior: 50794128!
initializeOfUser: aUser withCart: aCart lastUsedTime: theLastUsedTime 
	user := aUser.
	cart := aCart.
	lastUsedTime := theLastUsedTime.! !

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:39:30'!
FAILURE!

Object subclass: #Session
	instanceVariableNames: 'user cart lastUsedTime'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #Session category: #TusLibros stamp: 'fz 11/14/2019 18:39:41'!
Object subclass: #Session
	instanceVariableNames: 'user cart lastUsedTime'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:41:13' prior: 50789453!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	self assertValidCart: aCartID.
	
	(sessions at: aCartID) updateTime: clock currentTime.

	^ (self cartOfID: aCartID) add: aQuantity of: aBookISBN.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:46:03' prior: 50794167!
addToCart: aCartID book: aBookISBN quantity: aQuantity 

	self assertValidCart: aCartID.
	
	(sessions at: aCartID) add: aQuantity of: aBookISBN on: clock currentTime.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:48:15' prior: 50793691!
checkoutCart: aCartID withCreditCard: aCreditCard
	|total|
	self assertValidCart: aCartID.
	
	total := (sessions at: aCartID) checkoutCharging: aCreditCard
		throught: merchantProcessor
		on: clock today
		registeringOn: salesBook.
		
	cartsRegister removeKey: aCartID.
	cartTimeRegister removeKey: aCartID.
	cartClientRegister removeKey: aCartID.
	
	^total.! !
!Session methodsFor: 'nil' stamp: 'fz 11/14/2019 18:50:11'!
checkoutCharging: aCreditCard throught: aMerchantProcessor on: aTime registeringOn: aSalesBook
	|cashier|
	
	cashier:= Cashier 
			toCheckout: cart
			ofClient: user
			charging: aCreditCard
			throught: aMerchantProcessor
			on: aTime
			registeringOn: aSalesBook.
		
	^cashier checkOut.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:50:30' prior: 50794184!
checkoutCart: aCartID withCreditCard: aCreditCard
	|total|
	self assertValidCart: aCartID.
	
	total := (sessions at: aCartID) checkoutCharging: aCreditCard
		throught: merchantProcessor
		on: clock today
		registeringOn: salesBook.
		
	sessions removeKey: aCartID.
	
	^total.! !
!Session methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:51:08'!
add: aQuantity of: aBookISBN on: aTime
	cart add: aQuantity of: aBookISBN.
	lastUsedTime := aTime.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:51:55' prior: 50794061!
createCartOf: aUser withPassword: aPassword 
	|cartID cart |
	self assertCredentialsOfUser: aUser withPassword: aPassword.
	
	cartID := currentID.
	currentID  := currentID +1.
	
	cart := Cart acceptingItemsOf: catalog.
	sessions at: cartID put: (Session ofUser: aUser withCart: cart lastUsedTime: clock currentTime).
	
	^cartID.! !
!UserAPI methodsFor: 'API' stamp: 'fz 11/14/2019 18:52:28' prior: 50789462!
listCart: aCartID
	self assertValidCart: aCartID.
	^ (sessions at: aCartID) listItems.! !
!Session methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:52:40'!
listItems
	^cart listItems ! !
!UserAPI methodsFor: 'testing' stamp: 'fz 11/14/2019 18:57:17' prior: 50789169!
cartOfID: aCartID
	^sessions at: aCartID.! !
!Session methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:57:33'!
occurrencesOf: anItem
	^cart occurrencesOf: anItem! !
!UserAPI methodsFor: 'testing' stamp: 'fz 11/14/2019 18:58:09' prior: 50787351!
isValidCartID: aCartID 
	^sessions includesKey: aCartID ! !
!UserAPI methodsFor: 'testing' stamp: 'fz 11/14/2019 18:58:47' prior: 50789174!
lastAccesedTime: aCartID 
	^ (sessions at: aCartID) lastAccesedTime.! !
!Session methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:58:58'!
lastAccesedTime
	^lastUsedTime! !
!Session methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:59:13'!
lastUsedTime
	^lastUsedTime! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:59:13' prior: 50794265!
lastAccesedTime: aCartID 
	^ (sessions at: aCartID) lastUsedTime.! !

!methodRemoval: Session #lastAccesedTime stamp: 'fz 11/14/2019 18:59:13'!
lastAccesedTime
	^lastUsedTime!
!UserAPI methodsFor: 'testing' stamp: 'fz 11/14/2019 18:59:25'!
lastUsedTime: aCartID 
	^ (sessions at: aCartID) lastUsedTime.! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:59:26' prior: 50789249!
isExpiredCart: aCartID 
	^clock currentTime > ((self lastUsedTime: aCartID) next: (TimeUnits minute with: 30))! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 18:59:26' prior: 50792268!
test09newCartHasLastAccesedTimeRightNow
	|userAPI cartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: Dictionary new salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI lastUsedTime: cartID) equals: self currentTime.! !

!methodRemoval: UserAPI #lastAccesedTime: stamp: 'fz 11/14/2019 18:59:26'!
lastAccesedTime: aCartID 
	^ (sessions at: aCartID) lastUsedTime.!
!UserAPI methodsFor: 'initialization' stamp: 'fz 11/14/2019 18:59:40' prior: 50794038!
initializeWithUserManager: aUserManager clock: aClock catalog: aCatalog salesBook: aSalesBook merchantProcessor: aMerchantProcessor    
	userManager := aUserManager.
	catalog := aCatalog.
	clock := aClock.
	salesBook := aSalesBook.
	merchantProcessor := aMerchantProcessor.
	
	currentID := 1.
	
	sessions := Dictionary new.! !

Object subclass: #UserAPI
	instanceVariableNames: 'userManager catalog currentID clock salesBook merchantProcessor sessions'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classDefinition: #UserAPI category: #TusLibros stamp: 'fz 11/14/2019 18:59:52'!
Object subclass: #UserAPI
	instanceVariableNames: 'userManager catalog currentID clock salesBook merchantProcessor sessions'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 18:59:59'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:00:06'!
PASSED!

----SNAPSHOT----(14 November 2019 19:00:12) CuisUniversity-3938.image priorSource: 14791252!
!UserAPI methodsFor: 'testing' stamp: 'fz 11/14/2019 19:03:26'!
inCartID: aCartID
	^sessions at: aCartID.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:03:26' prior: 50792324!
test06AddingItemsWithMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	
	
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI inCartID: cart2ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: ((userAPI inCartID: cart1ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 0.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:03:26' prior: 50792374!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI inCartID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !

!methodRemoval: UserAPI #cartOfID: stamp: 'fz 11/14/2019 19:03:26'!
cartOfID: aCartID
	^sessions at: aCartID.!
!UserAPI methodsFor: 'testing' stamp: 'fz 11/14/2019 19:04:27'!
itemsOf: anItem inCartID: aCartID
	^sessions at: aCartID.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:04:27' prior: 50794477!
test06AddingItemsWithMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	
	
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cart2ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: ((userAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cart1ID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 0.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:04:27' prior: 50794505!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: ((userAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cartID) occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.! !

!methodRemoval: UserAPI #inCartID: stamp: 'fz 11/14/2019 19:04:27'!
inCartID: aCartID
	^sessions at: aCartID.!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:04:36'!
PASSED!

----SNAPSHOT----(14 November 2019 19:04:41) CuisUniversity-3938.image priorSource: 14810203!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 19:05:01' prior: 50794562!
test04CreatedCartCanAddItems
	|userAPI cartID |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: (userAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cartID) equals: 1.! !
!UserAPI methodsFor: 'testing' stamp: 'fz 11/14/2019 19:05:21' prior: 50794526!
itemsOf: anItem inCartID: aCartID
	^(sessions at: aCartID) .! !
!UserAPI methodsFor: 'testing' stamp: 'fz 11/14/2019 19:05:48' prior: 50794669!
itemsOf: anItem inCartID: aCartID
	^(sessions at: aCartID) occurrencesOf: anItem.! !

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:05:52'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 19:06:12' prior: 50794531!
test06AddingItemsWithMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	
	
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: (userAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cart2ID) equals: 2.
	self assert: (userAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cart1ID) equals: 0.! !

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:06:14'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:06:23'!
PASSED!

----SNAPSHOT----(14 November 2019 19:06:31) CuisUniversity-3938.image priorSource: 14815894!
!Cart methodsFor: 'queries' stamp: 'fz 11/14/2019 19:09:04'!
quantityOf: anItem

	^items occurrencesOf: anItem  ! !
!PurchaseSummary methodsFor: 'testing' stamp: 'fz 11/14/2019 19:09:04'!
quantityOf: anItem
	^sales inject: 0 into: [:total :sale | total + (sale occurrencesOf: anItem)]! !
!Session methodsFor: 'using cart' stamp: 'fz 11/14/2019 19:09:04'!
quantityOf: anItem
	^cart occurrencesOf: anItem! !
!Ticket methodsFor: 'testing' stamp: 'fz 11/14/2019 19:09:04'!
quantityOf: anItem
	^listOfItems occurrencesOf: anItem
	! !
!Cart methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:04' prior: 50785351!
occurrencesOf: anItem

	^items quantityOf: anItem  ! !
!CartTest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:04' prior: 50786786!
test08CartRemembersTheNumberOfAddedItems

	| cart |
	
	cart := testObjectsFactory createCart.
	
	cart add: 2 of: testObjectsFactory itemSoldByTheStore.
	self assert: (cart quantityOf: testObjectsFactory itemSoldByTheStore) = 2! !
!PurchaseSummary methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:04' prior: 50793295!
occurrencesOf: anItem
	^sales inject: 0 into: [:total :sale | total + (sale quantityOf: anItem)]! !
!Session methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:04' prior: 50794255!
occurrencesOf: anItem
	^cart quantityOf: anItem! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:04' prior: 50791539!
occurrencesOf: anItem
	^listOfItems quantityOf: anItem
	! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:04' prior: 50794674!
itemsOf: anItem inCartID: aCartID
	^(sessions at: aCartID) quantityOf: anItem.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:04' prior: 50792220!
test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 20).
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 20).
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList quantityOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: itemsList size equals: 2.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:04' prior: 50792282!
test08ListCartReflectsAddedItems
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList quantityOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: (itemsList quantityOf: testObjectsFactory anotherItemSoldByTheStore) equals: 1.
	self assert: itemsList size equals: 3.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:04' prior: 50793261!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI cartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases quantityOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:04' prior: 50793317!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	anotherClientCartID := userAPI createCartOf: anotherValidUser withPassword: anotherValidUserPassword.
	userAPI addToCart: anotherClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 2.
	userAPI checkoutCart: anotherClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases quantityOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!Cart methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:05' prior: 50794779!
quantityOf: anItem

	^items quantityOf: anItem  ! !
!PurchaseSummary methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:05' prior: 50794783!
quantityOf: anItem
	^sales inject: 0 into: [:total :sale | total + (sale quantityOf: anItem)]! !
!Session methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:05' prior: 50794789!
quantityOf: anItem
	^cart quantityOf: anItem! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:05' prior: 50794793!
quantityOf: anItem
	^listOfItems quantityOf: anItem
	! !

!methodRemoval: Cart #occurrencesOf: stamp: 'fz 11/14/2019 19:09:05'!
occurrencesOf: anItem

	^items quantityOf: anItem  !

!methodRemoval: PurchaseSummary #occurrencesOf: stamp: 'fz 11/14/2019 19:09:05'!
occurrencesOf: anItem
	^sales inject: 0 into: [:total :sale | total + (sale quantityOf: anItem)]!

!methodRemoval: Session #occurrencesOf: stamp: 'fz 11/14/2019 19:09:05'!
occurrencesOf: anItem
	^cart quantityOf: anItem!

!methodRemoval: Ticket #occurrencesOf: stamp: 'fz 11/14/2019 19:09:05'!
occurrencesOf: anItem
	^listOfItems quantityOf: anItem
	!
!Cart methodsFor: 'queries' stamp: 'fz 11/14/2019 19:09:39'!
occurrencesOf: anItem

	^items quantityOf: anItem  ! !
!Ticket methodsFor: 'testing' stamp: 'fz 11/14/2019 19:09:40'!
occurrencesOf: anItem
	^listOfItems quantityOf: anItem
	! !
!PurchaseSummary methodsFor: 'testing' stamp: 'fz 11/14/2019 19:09:40'!
occurrencesOf: anItem
	^sales inject: 0 into: [:total :sale | total + (sale quantityOf: anItem)]! !
!Session methodsFor: 'using cart' stamp: 'fz 11/14/2019 19:09:40'!
occurrencesOf: anItem
	^cart quantityOf: anItem! !
!Cart methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794957!
quantityOf: anItem

	^items occurrencesOf: anItem  ! !
!CartTest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794803!
test08CartRemembersTheNumberOfAddedItems

	| cart |
	
	cart := testObjectsFactory createCart.
	
	cart add: 2 of: testObjectsFactory itemSoldByTheStore.
	self assert: (cart occurrencesOf: testObjectsFactory itemSoldByTheStore) = 2! !
!PurchaseSummary methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794962!
quantityOf: anItem
	^sales inject: 0 into: [:total :sale | total + (sale occurrencesOf: anItem)]! !
!Session methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794968!
quantityOf: anItem
	^cart occurrencesOf: anItem! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794973!
quantityOf: anItem
	^listOfItems occurrencesOf: anItem
	! !
!UserAPI methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794830!
itemsOf: anItem inCartID: aCartID
	^(sessions at: aCartID) occurrencesOf: anItem.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794836!
test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 20).
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 20).
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: itemsList size equals: 2.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794863!
test08ListCartReflectsAddedItems
	|userAPI cartID itemsList |
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: (itemsList occurrencesOf: testObjectsFactory anotherItemSoldByTheStore) equals: 1.
	self assert: itemsList size equals: 3.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794892!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI cartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794919!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID anotherClientCartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	anotherClientCartID := userAPI createCartOf: anotherValidUser withPassword: anotherValidUserPassword.
	userAPI addToCart: anotherClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 2.
	userAPI checkoutCart: anotherClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!Cart methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794995!
occurrencesOf: anItem

	^items occurrencesOf: anItem  ! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50794999!
occurrencesOf: anItem
	^listOfItems occurrencesOf: anItem
	! !
!PurchaseSummary methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50795004!
occurrencesOf: anItem
	^sales inject: 0 into: [:total :sale | total + (sale occurrencesOf: anItem)]! !
!Session methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:09:40' prior: 50795010!
occurrencesOf: anItem
	^cart occurrencesOf: anItem! !

!methodRemoval: Cart #quantityOf: stamp: 'fz 11/14/2019 19:09:40'!
quantityOf: anItem

	^items occurrencesOf: anItem  !

!methodRemoval: Ticket #quantityOf: stamp: 'fz 11/14/2019 19:09:40'!
quantityOf: anItem
	^listOfItems occurrencesOf: anItem
	!

!methodRemoval: PurchaseSummary #quantityOf: stamp: 'fz 11/14/2019 19:09:40'!
quantityOf: anItem
	^sales inject: 0 into: [:total :sale | total + (sale occurrencesOf: anItem)]!

!methodRemoval: Session #quantityOf: stamp: 'fz 11/14/2019 19:09:40'!
quantityOf: anItem
	^cart occurrencesOf: anItem!
!UserAPI methodsFor: 'testing' stamp: 'fz 11/14/2019 19:09:58' prior: 50795047!
itemsOf: anItem inCartID: aCartID
	^(sessions at: aCartID) occurrencesOf: anItem.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:10:08'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:10:08'!
PASSED!
!Session methodsFor: 'using cart' stamp: 'fz 11/14/2019 19:10:52'!
quantityOf: anItem
	^cart occurrencesOf: anItem! !
!Session methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:10:52' prior: 50795192!
occurrencesOf: anItem
	^cart quantityOf: anItem! !
!Session methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:10:52' prior: 50795282!
quantityOf: anItem
	^cart quantityOf: anItem! !

!methodRemoval: Session #occurrencesOf: stamp: 'fz 11/14/2019 19:10:52'!
occurrencesOf: anItem
	^cart quantityOf: anItem!
!UserAPI methodsFor: 'testing' stamp: 'fz 11/14/2019 19:11:05' prior: 50795214!
itemsOf: anItem inCartID: aCartID
	^(sessions at: aCartID) quantityOf: anItem.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:11:09'!
ERROR!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:11:09'!
ERROR!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:11:09'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:11:13'!
ERROR!
!Session methodsFor: 'using cart' stamp: 'fz 11/14/2019 19:11:28' prior: 50795292!
quantityOf: anItem
	^cart occurrencesOf: anItem! !

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:11:30'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:11:32'!
PASSED!

!methodRemoval: UserAPI #clientOfCartID: stamp: 'fz 11/14/2019 19:12:05'!
clientOfCartID: aCartID
	^cartClientRegister at: aCartID !

!methodRemoval: Ticket #occurrencesOf: stamp: 'fz 11/14/2019 19:23:01'!
occurrencesOf: anItem
	^listOfItems occurrencesOf: anItem
	!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:23:06'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:23:06'!
ERROR!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:23:06'!
ERROR!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:23:09'!
ERROR!
!Ticket methodsFor: 'testing' stamp: 'fz 11/14/2019 19:23:40'!
occurrencesOf: anItem
	^listOfItems occurrencesOf: anItem! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:23:52'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:23:52'!
PASSED!
!Ticket class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 19:26:16'!
of: aTotal listOfItems: aListOfItems forClient: aClient withCatalog: aCatalog   

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient ! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:26:16' prior: 50793497!
createTicket

	^ Ticket of: total listOfItems: cart listItems forClient: client withCatalog: catalog
! !

!methodRemoval: Ticket class #of:listOfItems:forClient: stamp: 'fz 11/14/2019 19:26:16'!
of: aTotal listOfItems: aListOfItems forClient: aClient  

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient !
!Ticket methodsFor: 'initialization' stamp: 'fz 11/14/2019 19:26:42'!
initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient withCatalog: aCatalog   

	total := aTotal.
	listOfItems := aListOfItems.
	client := aClient.! !
!Ticket class methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:26:42' prior: 50795584!
of: aTotal listOfItems: aListOfItems forClient: aClient withCatalog: aCatalog   

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient withCatalog: aCatalog ! !

!methodRemoval: Ticket #initializeTotal:listOfItems:forClient: stamp: 'fz 11/14/2019 19:26:42'!
initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient  

	total := aTotal.
	listOfItems := aListOfItems.
	client := aClient.!
!Ticket methodsFor: 'initialization' stamp: 'fz 11/14/2019 19:27:59'!
initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient    

	total := aTotal.
	listOfItems := aListOfItems.
	client := aClient.! !
!Ticket class methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:27:59' prior: 50795618!
of: aTotal listOfItems: aListOfItems forClient: aClient withCatalog: aCatalog   

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient ! !

!methodRemoval: Ticket #initializeTotal:listOfItems:forClient:withCatalog: stamp: 'fz 11/14/2019 19:27:59'!
initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient withCatalog: aCatalog   

	total := aTotal.
	listOfItems := aListOfItems.
	client := aClient.!
!Ticket class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 19:28:11'!
of: aTotal listOfItems: aListOfItems forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient ! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:28:11' prior: 50795594!
createTicket

	^ Ticket of: total listOfItems: cart listItems forClient: client ! !

!methodRemoval: Ticket class #of:listOfItems:forClient:withCatalog: stamp: 'fz 11/14/2019 19:28:11'!
of: aTotal listOfItems: aListOfItems forClient: aClient withCatalog: aCatalog   

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient !
!Cashier methodsFor: 'checkout - private' stamp: 'fz 11/14/2019 19:32:39' prior: 50795670!
createTicket

	^ Ticket of: total listOfItems: cart listItemsWithPrices forClient: client ! !
!Cart methodsFor: 'queries' stamp: 'fz 11/14/2019 19:32:49'!
listItemsWithPrices
	^items copy! !
!Cart methodsFor: 'queries' stamp: 'fz 11/14/2019 19:33:51' prior: 50795691!
listItemsWithPrices
	^items inject: Dictionary new into: [:itemsWithPrice :item | itemsWithPrice at: item put: (catalog at: item)]! !
!Ticket class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 19:34:41'!
of: aTotal itemsWithPrices: aListOfItems forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient ! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:34:41' prior: 50795686!
createTicket

	^ Ticket of: total itemsWithPrices: cart listItemsWithPrices forClient: client ! !

!methodRemoval: Ticket class #of:listOfItems:forClient: stamp: 'fz 11/14/2019 19:34:41'!
of: aTotal listOfItems: aListOfItems forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient !
!Ticket methodsFor: 'initialization' stamp: 'fz 11/14/2019 19:35:48'!
initializeTotal: aTotal itemsWithPrices: aListOfItems forClient: aClient    

	total := aTotal.
	listOfItems := aListOfItems.
	client := aClient.! !
!Ticket class methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:35:48' prior: 50795702!
of: aTotal itemsWithPrices: aListOfItems forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal itemsWithPrices: aListOfItems forClient: aClient ! !

!methodRemoval: Ticket #initializeTotal:listOfItems:forClient: stamp: 'fz 11/14/2019 19:35:48'!
initializeTotal: aTotal listOfItems: aListOfItems forClient: aClient    

	total := aTotal.
	listOfItems := aListOfItems.
	client := aClient.!

!classDefinition: #Ticket category: #TusLibros stamp: 'fz 11/14/2019 19:35:57'!
Object subclass: #Ticket
	instanceVariableNames: 'total listOfItemsWithPrice client'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:35:57' prior: 50795516!
occurrencesOf: anItem
	^listOfItemsWithPrice occurrencesOf: anItem! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:35:57' prior: 50791509!
size
	^listOfItemsWithPrice size.! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:35:57' prior: 50795725!
initializeTotal: aTotal itemsWithPrices: aListOfItems forClient: aClient    

	total := aTotal.
	listOfItemsWithPrice := aListOfItems.
	client := aClient.! !
!Ticket class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 19:36:23' prior: 50795733!
of: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient ! !
!Ticket methodsFor: 'initialization' stamp: 'fz 11/14/2019 19:36:30' prior: 50795767!
initializeTotal: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient    

	total := aTotal.
	listOfItemsWithPrice := theItemsAndPrices.
	client := aClient.! !

----SNAPSHOT----(14 November 2019 19:36:34) CuisUniversity-3938.image priorSource: 14820012!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 19:37:21'!
test20cartCheckoutHasDetailedPricesOfBooks
	|userAPI cartID total|
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	
	"ac podran venir muchos tests medio redudantes de la lgica de cashier, no sera TDD sino testing, decidimos no agregarlos ya que nos parece que no es lo importante del ejercicio"
! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 19:38:30' prior: 50795796!
test20cartCheckoutHasDetailedPricesOfBooks
	|userAPI cartID total|
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	self assert: (emptySalesBook first priceOf: testObjectsFactory itemSoldByTheStore) = total.! !

!testRun: #UserAPITest #test20cartCheckoutHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 19:38:34'!
ERROR!

!testRun: #UserAPITest #test20cartCheckoutHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 19:38:34'!
ERROR!
!Ticket methodsFor: 'testing' stamp: 'fz 11/14/2019 19:38:45'!
priceOf: aString 
	self shouldBeImplemented.! !
!Ticket methodsFor: 'testing' stamp: 'fz 11/14/2019 19:38:59' prior: 50795853!
priceOf: anItem
	^listOfItemsWithPrice at: anItem
	! !

!classDefinition: #Ticket category: #TusLibros stamp: 'fz 11/14/2019 19:39:08'!
Object subclass: #Ticket
	instanceVariableNames: 'total itemsWithPrice client'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:39:08' prior: 50795785!
initializeTotal: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient    

	total := aTotal.
	itemsWithPrice := theItemsAndPrices.
	client := aClient.! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:39:08' prior: 50795763!
size
	^itemsWithPrice size.! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:39:08' prior: 50795857!
priceOf: anItem
	^itemsWithPrice at: anItem
	! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:39:08' prior: 50795757!
occurrencesOf: anItem
	^itemsWithPrice occurrencesOf: anItem! !

!testRun: #UserAPITest #test20cartCheckoutHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 19:39:21'!
ERROR!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:40:00'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:40:01'!
ERROR!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:40:01'!
ERROR!

!testRun: #UserAPITest #test20cartCheckoutHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 19:40:01'!
ERROR!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:40:04'!
ERROR!
!Cart methodsFor: 'queries' stamp: 'fz 11/14/2019 19:41:06' prior: 50795695!
listItemsWithPrices
	^items inject: Dictionary new into: [:itemsWithPrice :item | itemsWithPrice at: item put: (catalog at: item). itemsWithPrice]! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:41:11'!
FAILURE!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:41:11'!
FAILURE!

!testRun: #UserAPITest #test20cartCheckoutHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 19:41:11'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:41:14'!
FAILURE!
!Ticket class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 19:44:08'!
of: aTotal itemsQuantity: theItemsAndPrices forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient ! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:44:08' prior: 50795711!
createTicket

	^ Ticket of: total itemsQuantity: cart listItemsWithPrices forClient: client ! !

!methodRemoval: Ticket class #of:itemsWithPrices:forClient: stamp: 'fz 11/14/2019 19:44:08'!
of: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient !
!Ticket class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 19:45:14'!
of: aTotal itemsPrices: theItemsAndPrices forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient ! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:45:14' prior: 50796052!
createTicket

	^ Ticket of: total itemsPrices: cart listItemsWithPrices forClient: client ! !

!methodRemoval: Ticket class #of:itemsQuantity:forClient: stamp: 'fz 11/14/2019 19:45:14'!
of: aTotal itemsQuantity: theItemsAndPrices forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient !
!Ticket class methodsFor: 'instance creation' stamp: 'fz 11/14/2019 19:45:49'!
of: aTotal itemsQuantity: theItemsQuantity itemsPrices: theItemsAndPrices forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient ! !
!Cashier methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:45:49' prior: 50796077!
createTicket

	^ Ticket of: total itemsQuantity: cart listItems itemsPrices: cart listItemsWithPrices forClient: client ! !

!methodRemoval: Ticket class #of:itemsPrices:forClient: stamp: 'fz 11/14/2019 19:45:49'!
of: aTotal itemsPrices: theItemsAndPrices forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient !
!Ticket methodsFor: 'initialization' stamp: 'fz 11/14/2019 19:46:07'!
initializeTotal: aTotal itemsPrices: theItemsAndPrices forClient: aClient    

	total := aTotal.
	itemsWithPrice := theItemsAndPrices.
	client := aClient.! !
!Ticket class methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:46:07' prior: 50796092!
of: aTotal itemsQuantity: theItemsQuantity itemsPrices: theItemsAndPrices forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal itemsPrices: theItemsAndPrices forClient: aClient ! !

!methodRemoval: Ticket #initializeTotal:itemsWithPrices:forClient: stamp: 'fz 11/14/2019 19:46:07'!
initializeTotal: aTotal itemsWithPrices: theItemsAndPrices forClient: aClient    

	total := aTotal.
	itemsWithPrice := theItemsAndPrices.
	client := aClient.!
!Ticket methodsFor: 'initialization' stamp: 'fz 11/14/2019 19:46:30'!
initializeTotal: aTotal itemsQuantity: theItemsQuantity itemsPrices: theItemsAndPrices forClient: aClient    

	total := aTotal.
	itemsWithPrice := theItemsAndPrices.
	client := aClient.! !
!Ticket class methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:46:30' prior: 50796127!
of: aTotal itemsQuantity: theItemsQuantity itemsPrices: theItemsAndPrices forClient: aClient    

	"should assert total is not negative or 0!!"
	^self new initializeTotal: aTotal itemsQuantity: theItemsQuantity itemsPrices: theItemsAndPrices forClient: aClient ! !

!methodRemoval: Ticket #initializeTotal:itemsPrices:forClient: stamp: 'fz 11/14/2019 19:46:30'!
initializeTotal: aTotal itemsPrices: theItemsAndPrices forClient: aClient    

	total := aTotal.
	itemsWithPrice := theItemsAndPrices.
	client := aClient.!

!classDefinition: #Ticket category: #TusLibros stamp: 'fz 11/14/2019 19:46:42'!
Object subclass: #Ticket
	instanceVariableNames: 'total itemsPrice client'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:46:42' prior: 50795886!
occurrencesOf: anItem
	^itemsPrice occurrencesOf: anItem! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:46:42' prior: 50795877!
size
	^itemsPrice size.! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:46:42' prior: 50795881!
priceOf: anItem
	^itemsPrice at: anItem
	! !
!Ticket methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 19:46:42' prior: 50796145!
initializeTotal: aTotal itemsQuantity: theItemsQuantity itemsPrices: theItemsAndPrices forClient: aClient    

	total := aTotal.
	itemsPrice := theItemsAndPrices.
	client := aClient.! !

!classDefinition: #Ticket category: #TusLibros stamp: 'fz 11/14/2019 19:46:56'!
Object subclass: #Ticket
	instanceVariableNames: 'total itemsPrice client itemsQuantity'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!Ticket methodsFor: 'initialization' stamp: 'fz 11/14/2019 19:46:54' prior: 50796195!
initializeTotal: aTotal itemsQuantity: theItemsQuantity itemsPrices: theItemsAndPrices forClient: aClient    

	total := aTotal.
	itemsQuantity := theItemsQuantity.
	itemsPrice := theItemsAndPrices.
	client := aClient.! !
!Ticket methodsFor: 'testing' stamp: 'fz 11/14/2019 19:47:07' prior: 50796181!
occurrencesOf: anItem
	^itemsQuantity occurrencesOf: anItem! !
!Ticket methodsFor: 'testing' stamp: 'fz 11/14/2019 19:47:16' prior: 50796186!
size
	^itemsQuantity size.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test20cartCheckoutHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 19:47:23'!
PASSED!

!testRun: #UserAPITest #test20cartCheckoutHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 19:47:38'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 19:48:25' prior: 50795823!
test20cartCheckoutHasDetailedPricesOfBooks
	|userAPI cartID total|
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	self assert: (emptySalesBook first priceOf: testObjectsFactory itemSoldByTheStore) = total.
	
	"este test deberia haber estado en checkout, como no se sabia el formato del ticket que debia devolver lo testeamos aca"! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 19:48:47' prior: 50796300!
test20cartCheckoutHasDetailedPricesOfBooks
	|userAPI cartID total|
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	self assert: (emptySalesBook first priceOf: testObjectsFactory itemSoldByTheStore) = total.
	
	"este test en cierta manera deberia haber estado en checkout, como no se sabia el formato del ticket que debia devolver lo testeamos aca"! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 19:49:17'!
test20cartCheckoutTicketHasDetailedPricesOfBooks
	|userAPI cartID total|
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	self assert: (emptySalesBook first priceOf: testObjectsFactory itemSoldByTheStore) = total.
	
	"este test en cierta manera deberia haber estado en checkout, como no se sabia el formato del ticket que debia devolver lo testeamos aca"! !

!methodRemoval: UserAPITest #test20cartCheckoutHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 19:49:17'!
test20cartCheckoutHasDetailedPricesOfBooks
	|userAPI cartID total|
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	self assert: (emptySalesBook first priceOf: testObjectsFactory itemSoldByTheStore) = total.
	
	"este test en cierta manera deberia haber estado en checkout, como no se sabia el formato del ticket que debia devolver lo testeamos aca"!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 19:50:41'!
test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect
	|userAPI cartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 19:51:30' prior: 50796412!
test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect
	|userAPI cartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := total + userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 2.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: purchases total = total.! !

!testRun: #UserAPITest #test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect stamp: 'fz 11/14/2019 19:51:33'!
ERROR!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 19:51:50' prior: 50796439!
test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect
	|userAPI cartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := total + (userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard).
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 2.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: purchases total = total.! !

!testRun: #UserAPITest #test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect stamp: 'fz 11/14/2019 19:51:52'!
FAILURE!

self itemsPurchased !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test20cartCheckoutHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 19:52:30'!
ERROR!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:52:30'!
PASSED!

!testRun: #UserAPITest #test20cartCheckoutHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 19:52:30'!
ERROR!

self size!

self inject: 0 into: [:total :sale | total + sale size]!

self inject: 0 into: [:total :sale | total + (sale occurrencesOf: 'validBook')]!

self  inject: 0 into: [:total :sale | total + sale total]!

!testRun: #UserAPITest #test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect stamp: 'fz 11/14/2019 19:56:51'!
PASSED!

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test20cartCheckoutTicketHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

!testRun: #UserAPITest #test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect stamp: 'fz 11/14/2019 19:57:02'!
PASSED!

----SNAPSHOT----(14 November 2019 19:57:06) CuisUniversity-3938.image priorSource: 14852551!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:00:03' prior: 50795136!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	self createCartForUser: anotherValidUser withPassword: anotherValidUserPassword andBuy: 2 of: testObjectsFactory itemSoldByTheStore.
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 20:00:11'!
ERROR!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 20:00:11'!
ERROR!
!UserAPITest methodsFor: 'private' stamp: 'fz 11/14/2019 20:00:26'!
createCartForUser: aString withPassword: aString2 andBuy: aSmallInteger of: aString4 
	self shouldBeImplemented.! !
!UserAPITest methodsFor: 'private' stamp: 'fz 11/14/2019 20:01:51' prior: 50796711!
createCartForUser: aUser withPassword: aPassword andBuy: aQuantity of: anItem
	|cartID userAPI |
	cartID := userAPI createCartOf: aUser withPassword: aPassword.
	userAPI addToCart: cartID book: anItem quantity: aQuantity.
	userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	! !

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 20:02:14'!
ERROR!
!UserAPITest methodsFor: 'private' stamp: 'fz 11/14/2019 20:02:47'!
createCartForUser: aUser withPassword: aPassword andBuy: aQuantity of: anItem withAPI: anUserAPI 
	|cartID userAPI |
	cartID := userAPI createCartOf: aUser withPassword: aPassword.
	userAPI addToCart: cartID book: anItem quantity: aQuantity.
	userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:02:47' prior: 50796672!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	self createCartForUser: anotherValidUser withPassword: anotherValidUserPassword andBuy: 2 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

!methodRemoval: UserAPITest #createCartForUser:withPassword:andBuy:of: stamp: 'fz 11/14/2019 20:02:47'!
createCartForUser: aUser withPassword: aPassword andBuy: aQuantity of: anItem
	|cartID userAPI |
	cartID := userAPI createCartOf: aUser withPassword: aPassword.
	userAPI addToCart: cartID book: anItem quantity: aQuantity.
	userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:03:03' prior: 50796748!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI queringClientCartID total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	self createCartForUser: anotherValidUser withPassword: anotherValidUserPassword andBuy: 2 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
	
	self createCartForUser: anotherValidUser withPassword: anotherValidUserPassword andBuy: 2 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
	
	queringClientCartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: queringClientCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	total := userAPI checkoutCart: queringClientCartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'private' stamp: 'fz 11/14/2019 20:03:29' prior: 50796734!
createCartForUser: aUser withPassword: aPassword andBuy: aQuantity of: anItem withAPI: anUserAPI 
	|cartID |
	cartID := anUserAPI createCartOf: aUser withPassword: aPassword.
	anUserAPI addToCart: cartID book: anItem quantity: aQuantity.
	^ anUserAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:04:01' prior: 50796794!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	self createCartForUser: anotherValidUser withPassword: anotherValidUserPassword andBuy: 2 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
	
	total := self createCartForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:05:17' prior: 50796356!
test20cartCheckoutTicketHasDetailedPricesOfBooks
	|userAPI total|
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	total := self createCartForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	self assert: (emptySalesBook first priceOf: testObjectsFactory itemSoldByTheStore) = total.
	
	"este test en cierta manera deberia haber estado en checkout, como no se sabia el formato del ticket que debia devolver lo testeamos aca"! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test20cartCheckoutTicketHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 20:05:22'!
PASSED!

!testRun: #UserAPITest #test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect stamp: 'fz 11/14/2019 20:05:22'!
PASSED!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:05:49' prior: 50795109!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	total := self createCartForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:06:42' prior: 50796478!
test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect
	|userAPI total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	total := self createCartForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
	total := total + (self createCartForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI).
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 2.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'private' stamp: 'fz 11/14/2019 20:07:05'!
makePurchaseForUser: aUser withPassword: aPassword andBuy: aQuantity of: anItem withAPI: anUserAPI 
	|cartID |
	cartID := anUserAPI createCartOf: aUser withPassword: aPassword.
	anUserAPI addToCart: cartID book: anItem quantity: aQuantity.
	^ anUserAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:07:05' prior: 50796991!
test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect
	|userAPI total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
	total := total + (self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI).
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 2.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:07:05' prior: 50796968!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|userAPI total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:07:05' prior: 50796873!
test20cartCheckoutTicketHasDetailedPricesOfBooks
	|userAPI total|
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	self assert: (emptySalesBook first priceOf: testObjectsFactory itemSoldByTheStore) = total.
	
	"este test en cierta manera deberia haber estado en checkout, como no se sabia el formato del ticket que debia devolver lo testeamos aca"! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:07:05' prior: 50796845!
test19ListPurchasesOnlyListSalesOfQueringClient
	|userAPI total purchases |
 
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	self makePurchaseForUser: anotherValidUser withPassword: anotherValidUserPassword andBuy: 2 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
	
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: userAPI.
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

!methodRemoval: UserAPITest #createCartForUser:withPassword:andBuy:of:withAPI: stamp: 'fz 11/14/2019 20:07:05'!
createCartForUser: aUser withPassword: aPassword andBuy: aQuantity of: anItem withAPI: anUserAPI 
	|cartID |
	cartID := anUserAPI createCartOf: aUser withPassword: aPassword.
	anUserAPI addToCart: cartID book: anItem quantity: aQuantity.
	^ anUserAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/14/2019 20:09:29'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time anotherValidUser anotherValidUserPassword emptySalesBook validUserAPI'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:09:27' prior: 50792560!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	validUserButWrongPassword := 'wrongPassword'.	
	
	anotherValidUser := 'anotherValidUser'.
	anotherValidUserPassword := 'anotherValidUserPassword'.
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword.
	usersLog at: anotherValidUser put: anotherValidUserPassword.	
	
	testObjectsFactory := StoreTestObjectsFactory new.
	
	time := GregorianDateTime now.
	
	emptySalesBook := OrderedCollection new.
	
	validUserAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:09:48' prior: 50793751!
test01CreateCartFailsWithUnknownUser

	self should: [validUserAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:10:02' prior: 50792409!
test02CartIsCreatedForValidUserAndIsEmpty
	| cartID |

	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (validUserAPI isValidCartID: cartID).! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:10:13' prior: 50793734!
test03CreateCartFailsWithWrongPassword

	self should: [validUserAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:10:24' prior: 50794651!
test04CreatedCartCanAddItems
	| cartID |
	
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	
	validUserAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: (validUserAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cartID) equals: 1.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:10:40' prior: 50792351!
test05CanNotAddItemsToInvalidCartID
	| cartID invalidCartID|
	
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [validUserAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:10:58' prior: 50794683!
test06AddingItemsWithMultipleCartsBehavesCorrectly
	|userAPI cart1ID cart2ID|
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	
	
	validUserAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	validUserAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: (validUserAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cart2ID) equals: 2.
	self assert: (validUserAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cart1ID) equals: 0.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:11:15' prior: 50797256!
test06AddingItemsWithMultipleCartsBehavesCorrectly
	| cart1ID cart2ID|
	
	cart1ID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := validUserAPI createCartOf: validUser withPassword: validUserPassword.	
	
	validUserAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	validUserAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: (validUserAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cart2ID) equals: 2.
	self assert: (validUserAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cart1ID) equals: 0.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:11:28' prior: 50792311!
test07ListCartOfNewCartIsEmpty
	|cartID|
	
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (validUserAPI listCart: cartID) isEmpty.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:11:44' prior: 50795080!
test08ListCartReflectsAddedItems
	|cartID itemsList |
	
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	
	validUserAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	validUserAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	validUserAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	itemsList := validUserAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: (itemsList occurrencesOf: testObjectsFactory anotherItemSoldByTheStore) equals: 1.
	self assert: itemsList size equals: 3.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:11:55' prior: 50794298!
test09newCartHasLastAccesedTimeRightNow
	|cartID|
	
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (validUserAPI lastUsedTime: cartID) equals: self currentTime.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:12:26' prior: 50792247!
test10canNotAddItemsToCartAfter30Mins
	| cartID|
	
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [validUserAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:12:44' prior: 50795053!
test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween
	|cartID itemsList |
	
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 20).
	validUserAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 20).
	
	validUserAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	itemsList := validUserAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: itemsList size equals: 2.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:12:59' prior: 50792201!
test12canNotListCartAfter30Mins
	|cartID|
	
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [validUserAPI listCart: cartID]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:13:10' prior: 50792154!
test13CanNotLIstInvalidCartID
	|cartID invalidCartID|
	
	validUserAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [validUserAPI listCart: invalidCartID ]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:13:26' prior: 50792175!
test14cartCheckoutRegistersSales
	|cartID total|
 
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	validUserAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := validUserAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	
	"ac podran venir muchos tests medio redudantes de la lgica de cashier, no sera TDD sino testing, decidimos no agregarlos ya que nos parece que no es lo importante del ejercicio"
! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:13:41' prior: 50792088!
test15afterCheckOutCartIDIsInvalid
	|cartID|
	
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	validUserAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	validUserAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self should: [validUserAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:13:56' prior: 50792113!
test16cannotCheckoutAfter30Minutes
	|cartID|
	
	cartID := validUserAPI createCartOf: validUser withPassword: validUserPassword.
	validUserAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 31).
			
	self should: [validUserAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage ].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:14:04' prior: 50793792!
test17ListPurchasesFailsWithInvalidCredentials
	
	self should: [validUserAPI listPurchasesOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:14:16' prior: 50797062!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|total purchases |
 
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: validUserAPI.
	
	purchases := validUserAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:14:32' prior: 50797111!
test19ListPurchasesOnlyListSalesOfQueringClient
	|total purchases |
	
	self makePurchaseForUser: anotherValidUser withPassword: anotherValidUserPassword andBuy: 2 of: testObjectsFactory itemSoldByTheStore withAPI: validUserAPI.
	
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: validUserAPI.
	
	purchases := validUserAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:14:44' prior: 50797086!
test20cartCheckoutTicketHasDetailedPricesOfBooks
	|total|
 
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: validUserAPI.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	self assert: (emptySalesBook first priceOf: testObjectsFactory itemSoldByTheStore) = total.
	
	"este test en cierta manera deberia haber estado en checkout, como no se sabia el formato del ticket que debia devolver lo testeamos aca"! !
!UserAPITest methodsFor: 'tests' stamp: 'fz 11/14/2019 20:15:00' prior: 50797033!
test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect
	|total purchases |
 
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: validUserAPI.
	total := total + (self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore withAPI: validUserAPI).
	
	purchases := validUserAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 2.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'private' stamp: 'fz 11/14/2019 20:15:40' prior: 50797019!
makePurchaseForUser: aUser withPassword: aPassword andBuy: aQuantity of: anItem withAPI: anUserAPI 
	|cartID |
	cartID := validUserAPI createCartOf: aUser withPassword: aPassword.
	validUserAPI addToCart: cartID book: anItem quantity: aQuantity.
	^ validUserAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	! !
!UserAPITest methodsFor: 'private' stamp: 'fz 11/14/2019 20:15:49'!
makePurchaseForUser: aUser withPassword: aPassword andBuy: aQuantity of: anItem  
	|cartID |
	cartID := validUserAPI createCartOf: aUser withPassword: aPassword.
	validUserAPI addToCart: cartID book: anItem quantity: aQuantity.
	^ validUserAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:49' prior: 50797558!
test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect
	|total purchases |
 
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore .
	total := total + (self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore ).
	
	purchases := validUserAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 2.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:49' prior: 50797496!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|total purchases |
 
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore .
	
	purchases := validUserAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:49' prior: 50797538!
test20cartCheckoutTicketHasDetailedPricesOfBooks
	|total|
 
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore .
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	self assert: (emptySalesBook first priceOf: testObjectsFactory itemSoldByTheStore) = total.
	
	"este test en cierta manera deberia haber estado en checkout, como no se sabia el formato del ticket que debia devolver lo testeamos aca"! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:49' prior: 50797515!
test19ListPurchasesOnlyListSalesOfQueringClient
	|total purchases |
	
	self makePurchaseForUser: anotherValidUser withPassword: anotherValidUserPassword andBuy: 2 of: testObjectsFactory itemSoldByTheStore .
	
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore .
	
	purchases := validUserAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !

!methodRemoval: UserAPITest #makePurchaseForUser:withPassword:andBuy:of:withAPI: stamp: 'fz 11/14/2019 20:15:49'!
makePurchaseForUser: aUser withPassword: aPassword andBuy: aQuantity of: anItem withAPI: anUserAPI 
	|cartID |
	cartID := validUserAPI createCartOf: aUser withPassword: aPassword.
	validUserAPI addToCart: cartID book: anItem quantity: aQuantity.
	^ validUserAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	!

!classDefinition: #UserAPITest category: #TusLibros stamp: 'fz 11/14/2019 20:15:59'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time anotherValidUser anotherValidUserPassword emptySalesBook userAPI'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797238!
test05CanNotAddItemsToInvalidCartID
	| cartID invalidCartID|
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI addToCart: invalidCartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797609!
test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect
	|total purchases |
 
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore .
	total := total + (self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore ).
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 2.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797484!
test17ListPurchasesFailsWithInvalidCredentials
	
	self should: [userAPI listPurchasesOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797465!
test16cannotCheckoutAfter30Minutes
	|cartID|
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 31).
			
	self should: [userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage ].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797279!
test06AddingItemsWithMultipleCartsBehavesCorrectly
	| cart1ID cart2ID|
	
	cart1ID := userAPI createCartOf: validUser withPassword: validUserPassword.
	cart2ID := userAPI createCartOf: validUser withPassword: validUserPassword.	
	
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cart2ID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: (userAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cart2ID) equals: 2.
	self assert: (userAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cart1ID) equals: 0.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797213!
test03CreateCartFailsWithWrongPassword

	self should: [userAPI createCartOf: validUser withPassword: validUserButWrongPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797302!
test07ListCartOfNewCartIsEmpty
	|cartID|
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI listCart: cartID) isEmpty.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797401!
test13CanNotLIstInvalidCartID
	|cartID invalidCartID|
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	invalidCartID := cartID +1. "asumimos que los IDs son incrementales"
	
	self should: [userAPI listCart: invalidCartID ]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797166!
setUp
	validUser := 'validUser'.
	validUserPassword := 'validUserPassword'.
	validUserButWrongPassword := 'wrongPassword'.	
	
	anotherValidUser := 'anotherValidUser'.
	anotherValidUserPassword := 'anotherValidUserPassword'.
	
	invalidUser := 'invalidUser'.
	invalidUserPassword := 'invalidUserPassword'.
	
	usersLog := Dictionary new.
	usersLog at: validUser put: validUserPassword.
	usersLog at: anotherValidUser put: anotherValidUserPassword.	
	
	testObjectsFactory := StoreTestObjectsFactory new.
	
	time := GregorianDateTime now.
	
	emptySalesBook := OrderedCollection new.
	
	userAPI := UserAPI withUserManager: self clock: self catalog: testObjectsFactory defaultCatalog salesBook: emptySalesBook merchantProcessor: self.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797422!
test14cartCheckoutRegistersSales
	|cartID total|
 
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	total := userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self assert: emptySalesBook size = 1.
	self assert: emptySalesBook first total = total.
	
	"ac podran venir muchos tests medio redudantes de la lgica de cashier, no sera TDD sino testing, decidimos no agregarlos ya que nos parece que no es lo importante del ejercicio"
! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797363!
test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween
	|cartID itemsList |
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 20).
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	time := time next: (TimeUnits minute with: 20).
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: itemsList size equals: 2.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797670!
test19ListPurchasesOnlyListSalesOfQueringClient
	|total purchases |
	
	self makePurchaseForUser: anotherValidUser withPassword: anotherValidUserPassword andBuy: 2 of: testObjectsFactory itemSoldByTheStore .
	
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore .
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797204!
test02CartIsCreatedForValidUserAndIsEmpty
	| cartID |

	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI isValidCartID: cartID).! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797632!
test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect
	|total purchases |
 
	total := self makePurchaseForUser: validUser withPassword: validUserPassword andBuy: 1 of: testObjectsFactory itemSoldByTheStore .
	
	purchases := userAPI listPurchasesOf: validUser withPassword: validUserPassword.
	
	self assert: purchases itemsPurchased = 1.
	self assert: (purchases occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 1.
	self assert: purchases total = total.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797346!
test10canNotAddItemsToCartAfter30Mins
	| cartID|
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797311!
test08ListCartReflectsAddedItems
	|cartID itemsList |
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	userAPI addToCart: cartID book: testObjectsFactory anotherItemSoldByTheStore quantity: 1.
	
	itemsList := userAPI listCart: cartID.
	self assert: (itemsList occurrencesOf: testObjectsFactory itemSoldByTheStore) equals: 2.
	self assert: (itemsList occurrencesOf: testObjectsFactory anotherItemSoldByTheStore) equals: 1.
	self assert: itemsList size equals: 3.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797336!
test09newCartHasLastAccesedTimeRightNow
	|cartID|
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	self assert: (userAPI lastUsedTime: cartID) equals: self currentTime.! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797444!
test15afterCheckOutCartIDIsInvalid
	|cartID|
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
			
	self should: [userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCartIDErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:15:59' prior: 50797595!
makePurchaseForUser: aUser withPassword: aPassword andBuy: aQuantity of: anItem  
	|cartID |
	cartID := userAPI createCartOf: aUser withPassword: aPassword.
	userAPI addToCart: cartID book: anItem quantity: aQuantity.
	^ userAPI checkoutCart: cartID withCreditCard: testObjectsFactory notExpiredCreditCard.
	! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:16:00' prior: 50797192!
test01CreateCartFailsWithUnknownUser

	self should: [userAPI createCartOf: invalidUser withPassword: invalidUserPassword.]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI invalidCredentialsErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:16:00' prior: 50797386!
test12canNotListCartAfter30Mins
	|cartID|
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	time := time next: (TimeUnits minute with: 31).
	
	self should: [userAPI listCart: cartID]
	 raise: Error - MessageNotUnderstood 
	 withExceptionDo: [ :anError | 
			self assert: anError messageText = UserAPI expiredCartErrorMessage].! !
!UserAPITest methodsFor: 'as yet unclassified' stamp: 'fz 11/14/2019 20:16:00' prior: 50797225!
test04CreatedCartCanAddItems
	| cartID |
	
	cartID := userAPI createCartOf: validUser withPassword: validUserPassword.
	
	userAPI addToCart: cartID book: testObjectsFactory itemSoldByTheStore quantity: 1.
	
	self assert: (userAPI itemsOf: testObjectsFactory itemSoldByTheStore inCartID: cartID) equals: 1.! !

!testRun: #UserAPITest #test01CreateCartFailsWithUnknownUser stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test02CartIsCreatedForValidUserAndIsEmpty stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test03CreateCartFailsWithWrongPassword stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test04CreatedCartCanAddItems stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test05CanNotAddItemsToInvalidCartID stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test06AddingItemsWithMultipleCartsBehavesCorrectly stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test07ListCartOfNewCartIsEmpty stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test08ListCartReflectsAddedItems stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test09newCartHasLastAccesedTimeRightNow stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test10canNotAddItemsToCartAfter30Mins stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test11canAddItemsToCartIfItWasCreated30MinsAgoButWasUsedInBetween stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test12canNotListCartAfter30Mins stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test13CanNotLIstInvalidCartID stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test14cartCheckoutRegistersSales stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test15afterCheckOutCartIDIsInvalid stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test16cannotCheckoutAfter30Minutes stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test17ListPurchasesFailsWithInvalidCredentials stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test18ListPurchasesOfAValidClientWithOnlyOneSaleIsCorrect stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test19ListPurchasesOnlyListSalesOfQueringClient stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test20cartCheckoutTicketHasDetailedPricesOfBooks stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

!testRun: #UserAPITest #test21ListPurchasesOfAValidClientWithMultipleSalesIsCorrect stamp: 'fz 11/14/2019 20:16:04'!
PASSED!

----SNAPSHOT----(14 November 2019 20:16:11) CuisUniversity-3938.image priorSource: 14880569!

----QUIT----(14 November 2019 21:29:29) CuisUniversity-3938.image priorSource: 14928643!

----STARTUP---- (21 November 2019 17:23:30) as /home/akima/Documents/ing_II/repo/cuis/CuisUniversity-3938.image!


!classRemoval: #UserAPI stamp: 'fz 11/21/2019 19:11:08'!
Object subclass: #UserAPI
	instanceVariableNames: 'userManager catalog currentID clock salesBook merchantProcessor sessions'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #Ticket stamp: 'fz 11/21/2019 19:11:09'!
Object subclass: #Ticket
	instanceVariableNames: 'total itemsPrice client itemsQuantity'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #StoreTestObjectsFactory stamp: 'fz 11/21/2019 19:11:09'!
Object subclass: #StoreTestObjectsFactory
	instanceVariableNames: 'today'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #Session stamp: 'fz 11/21/2019 19:11:10'!
Object subclass: #Session
	instanceVariableNames: 'user cart lastUsedTime'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #PurchaseSummary stamp: 'fz 11/21/2019 19:11:10'!
Object subclass: #PurchaseSummary
	instanceVariableNames: 'client sales'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #CreditCard stamp: 'fz 11/21/2019 19:11:11'!
Object subclass: #CreditCard
	instanceVariableNames: 'expiration'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #Cashier stamp: 'fz 11/21/2019 19:11:11'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook merchantProcessor creditCard total client'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #Cart stamp: 'fz 11/21/2019 19:11:12'!
Object subclass: #Cart
	instanceVariableNames: 'catalog items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #UserAPITest stamp: 'fz 11/21/2019 19:11:12'!
TestCase subclass: #UserAPITest
	instanceVariableNames: 'testObjectsFactory debitBehavior usersLog validUser validUserPassword validUserButWrongPassword invalidUser invalidUserPassword time anotherValidUser anotherValidUserPassword emptySalesBook userAPI'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #CashierTest stamp: 'fz 11/21/2019 19:11:13'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'testObjectsFactory debitBehavior'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #CartTest stamp: 'fz 11/21/2019 19:11:13'!
TestCase subclass: #CartTest
	instanceVariableNames: 'testObjectsFactory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

----End fileIn of /home/akima/Documents/ing_II/repo/25-TusLibros/4/TusLibros.st----!

----End fileIn of /home/akima/Documents/ing_II/repo/25-TusLibros/4/StringServer.st----!

----End fileIn of /home/akima/Documents/ing_II/repo/cuis/Packages/System/Collections-CompactArrays.pck.st----!

----End fileIn of /home/akima/Documents/ing_II/repo/cuis/Packages/Features/Compression.pck.st----!

----End fileIn of /home/akima/Documents/ing_II/repo/cuis/Packages/Features/Sound.pck.st----!

----End fileIn of /home/akima/Documents/ing_II/repo/cuis/Packages/Features/Cryptography-DigitalSignatures.pck.st----!

----End fileIn of /home/akima/Documents/ing_II/repo/cuis/Packages/Features/Identities-UUID.pck.st----!

----End fileIn of /home/akima/Documents/ing_II/repo/cuis/Packages/System/Network-Kernel.pck.st----!

----End fileIn of /home/akima/Documents/ing_II/repo/cuis/Packages/Features/WebClient.pck.st----!

Object subclass: #TusLibrosServerController
	instanceVariableNames: 'webServer port stringGenius hiList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'StringServer'!

!classDefinition: #TusLibrosServerController category: #StringServer stamp: 'fz 11/21/2019 19:17:36'!
Object subclass: #TusLibrosServerController
	instanceVariableNames: 'webServer port stringGenius hiList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'StringServer'!

TusLibrosServerController class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosServerController class' category: #StringServer stamp: 'fz 11/21/2019 19:17:36'!
TusLibrosServerController class
	instanceVariableNames: ''!
!TusLibrosServerController methodsFor: 'enabling services' stamp: 'fz 11/21/2019 19:17:36'!
destroy
	
	webServer ifNotNil:[webServer destroy].! !
!TusLibrosServerController methodsFor: 'enabling services' stamp: 'fz 11/21/2019 19:17:36'!
startListening
	
	webServer startListener.

	^ 'Listening on port: ', self port asString.
	! !
!TusLibrosServerController methodsFor: 'enabling services' stamp: 'fz 11/21/2019 19:17:36'!
stopListening
	
	webServer stopListener.
	
	^'Stopped listening from port: ', self port asString! !
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 19:17:36'!
initializeWith: aPortNumber

	hiList := self hiList.
	
	stringGenius := StringGenius new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/sayHi' action:[:request |	
		
		"request send200Response: (self sayRandomHi)"
		request send200Response: (self sayRandomHi asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		].
	
	webServer addService: '/substrings' action:[:request | |substringsAsJson sentence substrings |
		
		[sentence := (request fields at:'sentence').
		substrings := stringGenius substrings: sentence.
		substringsAsJson:= WebUtils jsonEncode: (substrings).
		"request send200Response: (substringsAsJson)"
		request send200Response: (substringsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := stringGenius firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := stringGenius vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := stringGenius toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 19:17:36'!
port
	"Use a random port to minimise chances of concurrently running test suites clashing."
	"^ port
		ifNil: [port := (10000 to: 50000) atRandom]"
	
	^port ifNil: [port:=8080].
	
	! !
!TusLibrosServerController methodsFor: 'private' stamp: 'fz 11/21/2019 19:17:36'!
hiList
	
	^OrderedCollection with: 'Hi!!' with: 'Hodor!!' with: 'I am Groot!!' with: 'My name is Homer Simp... Doh!!' with: 'I am inevitable...' with: 'Because Im Baaaatman!!'.
	
	! !
!TusLibrosServerController methodsFor: 'private' stamp: 'fz 11/21/2019 19:17:36'!
sayRandomHi
	
	^hiList at: (hiList size atRandom).
	! !
!TusLibrosServerController class methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:17:36'!
listeningOn: aPortNumber

	^self new initializeWith: aPortNumber.! !

Object subclass: #TusLibrosServerController
	instanceVariableNames: 'webServer port stringGenius hiList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!

!classDefinition: #TusLibrosServerController category: #'TusLibros-Server' stamp: 'fz 11/21/2019 19:17:58'!
Object subclass: #TusLibrosServerController
	instanceVariableNames: 'webServer port stringGenius hiList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!

!methodRemoval: TusLibrosServerController #sayRandomHi stamp: 'fz 11/21/2019 19:18:19'!
sayRandomHi
	
	^hiList at: (hiList size atRandom).
	!

!methodRemoval: TusLibrosServerController #hiList stamp: 'fz 11/21/2019 19:18:21'!
hiList
	
	^OrderedCollection with: 'Hi!!' with: 'Hodor!!' with: 'I am Groot!!' with: 'My name is Homer Simp... Doh!!' with: 'I am inevitable...' with: 'Because Im Baaaatman!!'.
	
	!

!classDefinition: #TusLibrosServerController category: #'TusLibros-Server' stamp: 'fz 11/21/2019 19:18:47'!
Object subclass: #TusLibrosServerController
	instanceVariableNames: 'webServer port tusLibrosAPI hiList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!
!TusLibrosServerController methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:18:47' prior: 50838250!
initializeWith: aPortNumber

	hiList := self hiList.
	
	tusLibrosAPI := StringGenius new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/sayHi' action:[:request |	
		
		"request send200Response: (self sayRandomHi)"
		request send200Response: (self sayRandomHi asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		].
	
	webServer addService: '/substrings' action:[:request | |substringsAsJson sentence substrings |
		
		[sentence := (request fields at:'sentence').
		substrings := tusLibrosAPI substrings: sentence.
		substringsAsJson:= WebUtils jsonEncode: (substrings).
		"request send200Response: (substringsAsJson)"
		request send200Response: (substringsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 19:21:19' prior: 50838404!
initializeWith: aPortNumber

	hiList := self hiList.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/sayHi' action:[:request |	
		
		"request send200Response: (self sayRandomHi)"
		request send200Response: (self sayRandomHi asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		].
	
	webServer addService: '/substrings' action:[:request | |substringsAsJson sentence substrings |
		
		[sentence := (request fields at:'sentence').
		substrings := tusLibrosAPI substrings: sentence.
		substringsAsJson:= WebUtils jsonEncode: (substrings).
		"request send200Response: (substringsAsJson)"
		request send200Response: (substringsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 19:22:07'!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	hiList := self hiList.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/sayHi' action:[:request |	
		
		"request send200Response: (self sayRandomHi)"
		request send200Response: (self sayRandomHi asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		].
	
	webServer addService: '/substrings' action:[:request | |substringsAsJson sentence substrings |
		
		[sentence := (request fields at:'sentence').
		substrings := tusLibrosAPI substrings: sentence.
		substringsAsJson:= WebUtils jsonEncode: (substrings).
		"request send200Response: (substringsAsJson)"
		request send200Response: (substringsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !
!TusLibrosServerController class methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:22:07' prior: 50838361!
listeningOn: aPortNumber

	^self new initializeWith: aPortNumber withAPI: ASD.! !

!methodRemoval: TusLibrosServerController #initializeWith: stamp: 'fz 11/21/2019 19:22:07'!
initializeWith: aPortNumber

	hiList := self hiList.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/sayHi' action:[:request |	
		
		"request send200Response: (self sayRandomHi)"
		request send200Response: (self sayRandomHi asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		].
	
	webServer addService: '/substrings' action:[:request | |substringsAsJson sentence substrings |
		
		[sentence := (request fields at:'sentence').
		substrings := tusLibrosAPI substrings: sentence.
		substringsAsJson:= WebUtils jsonEncode: (substrings).
		"request send200Response: (substringsAsJson)"
		request send200Response: (substringsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
!
!TusLibrosServerController class methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:22:35'!
listeningOn: aPortNumber withAPI: aTusLibrosAPI 

	^self new initializeWith: aPortNumber withAPI: ASD.! !

!methodRemoval: TusLibrosServerController class #listeningOn: stamp: 'fz 11/21/2019 19:22:35'!
listeningOn: aPortNumber

	^self new initializeWith: aPortNumber withAPI: ASD.!
!TusLibrosServerController class methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:22:39' prior: 50838758!
listeningOn: aPortNumber withAPI: aTusLibrosAPI 

	^self new initializeWith: aPortNumber withAPI: aTusLibrosAPI.! !
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 19:22:54' prior: 50838578!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	hiList := self hiList.
	
	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/sayHi' action:[:request |	
		
		"request send200Response: (self sayRandomHi)"
		request send200Response: (self sayRandomHi asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		].
	
	webServer addService: '/substrings' action:[:request | |substringsAsJson sentence substrings |
		
		[sentence := (request fields at:'sentence').
		substrings := tusLibrosAPI substrings: sentence.
		substringsAsJson:= WebUtils jsonEncode: (substrings).
		"request send200Response: (substringsAsJson)"
		request send200Response: (substringsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 19:23:00' prior: 50838778!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/sayHi' action:[:request |	
		
		"request send200Response: (self sayRandomHi)"
		request send200Response: (self sayRandomHi asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		].
	
	webServer addService: '/substrings' action:[:request | |substringsAsJson sentence substrings |
		
		[sentence := (request fields at:'sentence').
		substrings := tusLibrosAPI substrings: sentence.
		substringsAsJson:= WebUtils jsonEncode: (substrings).
		"request send200Response: (substringsAsJson)"
		request send200Response: (substringsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !

Object subclass: #TusLibrosServerController
	instanceVariableNames: 'webServer port tusLibrosAPI'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!

!classDefinition: #TusLibrosServerController category: #'TusLibros-Server' stamp: 'fz 11/21/2019 19:23:06'!
Object subclass: #TusLibrosServerController
	instanceVariableNames: 'webServer port tusLibrosAPI'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 19:26:25' prior: 50838867!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/sayHi' action:[:request |	
		
		"request send200Response: (self sayRandomHi)"
		request send200Response: ('iego' asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		].
	
	webServer addService: '/substrings' action:[:request | |substringsAsJson sentence substrings |
		
		[sentence := (request fields at:'sentence').
		substrings := tusLibrosAPI substrings: sentence.
		substringsAsJson:= WebUtils jsonEncode: (substrings).
		"request send200Response: (substringsAsJson)"
		request send200Response: (substringsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !

|server|

server := StringServerController listeningOn: 8000.

server startListening !

|server|

server := StringServerController listeningOn: 8000.

server startListening !

StringServerController listeningOn: 8000.!

self startListening !

self startListening !

self stopListening !

self stopListening !

----SNAPSHOT----(21 November 2019 19:31:36) CuisUniversity-3938.image priorSource: 14928737!

StringServerController allInstances!
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 19:38:51' prior: 50838969!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/substrings' action:[:request | |substringsAsJson sentence substrings |
		
		[sentence := (request fields at:'sentence').
		substrings := tusLibrosAPI substrings: sentence.
		substringsAsJson:= WebUtils jsonEncode: (substrings).
		"request send200Response: (substringsAsJson)"
		request send200Response: (substringsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !

TestCase subclass: #TusLibrosServerControllerTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!

!classDefinition: #TusLibrosServerControllerTest category: #'TusLibros-Server' stamp: 'fz 11/21/2019 19:39:35'!
TestCase subclass: #TusLibrosServerControllerTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!
!TusLibrosServerControllerTest methodsFor: 'nil' stamp: 'fz 11/21/2019 19:40:05'!
test01createCartXXX
	! !

!classDefinition: #TusLibrosServerControllerTest category: #'TusLibros-Server' stamp: 'fz 11/21/2019 19:40:33'!
TestCase subclass: #TusLibrosServerControllerTest
	instanceVariableNames: 'testObjectsFactory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!

!classDefinition: #TusLibrosServerControllerTest category: #'TusLibros-Server' stamp: 'fz 11/21/2019 19:40:35'!
TestCase subclass: #TusLibrosServerControllerTest
	instanceVariableNames: 'testObjectsFactory clock'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!

!classDefinition: #TusLibrosServerControllerTest category: #'TusLibros-Server' stamp: 'fz 11/21/2019 19:40:38'!
TestCase subclass: #TusLibrosServerControllerTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!
!TusLibrosServerControllerTest methodsFor: 'nil' stamp: 'fz 11/21/2019 19:40:31'!
setUp
	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock! !
!TusLibrosServerControllerTest methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:41:50' prior: 50839177!
test01createCartXXX
	|server|
	
	server := TusLibrosServerController listeningOn: 8080 withAPI: 2.
	! !
!TusLibrosServerControllerTest methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:42:00' prior: 50839223!
test01createCartXXX
	|server|
	
	server := TusLibrosServerController listeningOn: 8080 withAPI: systemFacade.
	! !
!TusLibrosServerControllerTest methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:42:21' prior: 50839230!
test01createCartXXX
	|server|
	
	server := TusLibrosServerController listeningOn: 8080 withAPI: systemFacade.
	server startListening.
	
	
	! !
!TusLibrosServerControllerTest methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:42:44' prior: 50839238!
test01createCartXXX
	|server|
	
	server := TusLibrosServerController listeningOn: 8080 withAPI: systemFacade.
	server startListening.
	
	! !

!classRemoval: #TusLibrosServerControllerTest stamp: 'fz 11/21/2019 19:46:05'!
TestCase subclass: #TusLibrosServerControllerTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!

Object subclass: #TusLibrosServerControllerXXX
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!

!classDefinition: #TusLibrosServerControllerXXX category: #'TusLibros-Server' stamp: 'fz 11/21/2019 19:52:26'!
Object subclass: #TusLibrosServerControllerXXX
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!

!classDefinition: #TusLibrosServerControllerXXX category: #'TusLibros-Server' stamp: 'fz 11/21/2019 19:52:33'!
Object subclass: #TusLibrosServerControllerXXX
	instanceVariableNames: 'testObjectsFactory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!

!classDefinition: #TusLibrosServerControllerXXX category: #'TusLibros-Server' stamp: 'fz 11/21/2019 19:52:34'!
Object subclass: #TusLibrosServerControllerXXX
	instanceVariableNames: 'testObjectsFactory clock'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!

!classDefinition: #TusLibrosServerControllerXXX category: #'TusLibros-Server' stamp: 'fz 11/21/2019 19:52:34'!
Object subclass: #TusLibrosServerControllerXXX
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!
!TusLibrosServerControllerXXX methodsFor: 'nil' stamp: 'fz 11/21/2019 19:52:32'!
initialize
	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock! !
!TusLibrosServerControllerXXX methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:54:43'!
getNewServerListeningOn: aPortNumber
	^ TusLibrosServerController listeningOn: aPortNumber withAPI: systemFacade.
	! !
!TusLibrosServerControllerXXX methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:59:04'!
validUsersAndPasswords
	^Dictionary new
		at: 'pepe' put: '1234';
		yourself! !
!TusLibrosServerControllerXXX methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 19:59:49' prior: 50839303!
initialize
	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: OrderedCollection new
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock! !
!TusLibrosServerControllerXXX methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 20:00:16' prior: 50839332!
initialize
	| salesBook |
	salesBook := OrderedCollection new.

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: salesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock! !
!TusLibrosServerControllerXXX methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 20:00:47' prior: 50839348!
initialize


	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: 1
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock! !

!classDefinition: #TusLibrosServerControllerXXX category: #'TusLibros-Server' stamp: 'fz 11/21/2019 20:00:56'!
Object subclass: #TusLibrosServerControllerXXX
	instanceVariableNames: 'testObjectsFactory clock systemFacade salesBook'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!
!TusLibrosServerControllerXXX methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 20:00:54' prior: 50839365!
initialize
	salesBook := OrderedCollection new.

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: salesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock! !
!TusLibrosServerControllerXXX methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 20:01:04' prior: 50839390!
initialize
	salesBook := OrderedCollection new.

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: salesBook
		debitingThrought: self 
		measuringTimeWith: clock! !
!TusLibrosServerControllerXXX methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 20:01:16'!
debit: anAmount from: aCreditCard! !
!TusLibrosServerControllerXXX methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 20:02:18'!
defaultCatalog

	^ Dictionary new
		at: 'harry popoter' put: 23445;
		at: 'sarlanga' put: 1123;
		yourself ! !
!TusLibrosServerControllerXXX methodsFor: 'as yet unclassified' stamp: 'fz 11/21/2019 20:02:24' prior: 50839406!
initialize
	salesBook := OrderedCollection new.

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: salesBook
		debitingThrought: self 
		measuringTimeWith: clock! !
!TusLibrosServerControllerXXX methodsFor: 'initialize' stamp: 'fz 11/21/2019 20:03:29' prior: 50839433!
initialize
	salesBook := OrderedCollection new.

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: salesBook
		debitingThrought: self 
		measuringTimeWith: clock! !
!TusLibrosServerControllerXXX methodsFor: 'initialize' stamp: 'fz 11/21/2019 20:03:40' prior: 50839448!
initialize
	salesBook := OrderedCollection new.

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: salesBook
		debitingThrought: self 
		measuringTimeWith: Clock new.! !
!TusLibrosServerControllerXXX methodsFor: 'server' stamp: 'fz 11/21/2019 20:05:22'!
newServerListeningOn: aPortNumber
	^ TusLibrosServerController listeningOn: aPortNumber withAPI: systemFacade.
	! !

!methodRemoval: TusLibrosServerControllerXXX #getNewServerListeningOn: stamp: 'fz 11/21/2019 20:05:22'!
getNewServerListeningOn: aPortNumber
	^ TusLibrosServerController listeningOn: aPortNumber withAPI: systemFacade.
	!

!classDefinition: #TusLibrosServerControllerXXX category: #'TusLibros-Server' stamp: 'fz 11/21/2019 20:05:31'!
Object subclass: #TusLibrosServerControllerXXX
	instanceVariableNames: 'testObjectsFactory clock systemFacade salesBook server'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Server'!
!TusLibrosServerControllerXXX methodsFor: 'server' stamp: 'fz 11/21/2019 20:05:30' prior: 50839478!
newServerListeningOn: aPortNumber
	server := TusLibrosServerController listeningOn: aPortNumber withAPI: systemFacade.
	! !
!TusLibrosServerControllerXXX methodsFor: 'server' stamp: 'fz 11/21/2019 20:05:38' prior: 50839502!
newServerListeningOn: aPortNumber
	server := TusLibrosServerController listeningOn: aPortNumber withAPI: systemFacade.
	
	server startListening.
	! !
!TusLibrosServerControllerXXX methodsFor: 'server' stamp: 'fz 11/21/2019 20:06:00'!
stopServer
	server stopListening.
	server destroy.
	! !

TusLibrosServerControllerXXX new.!

self newServerListeningOn: 8080!

self stopServer !
!TusLibrosServerControllerXXX methodsFor: 'initialize' stamp: 'fz 11/21/2019 20:13:39' prior: 50839463!
initialize
	salesBook := OrderedCollection new.

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: salesBook
		debitingThrought: self 
		measuringTimeWith: clock.! !

TusLibrosServerControllerXXX new!

 a TusLibrosServerControllerXXX !

TusLibrosServerControllerXXX new!
!TusLibrosServerControllerXXX methodsFor: 'server' stamp: 'fz 11/21/2019 20:14:28' prior: 50839509!
newServerListeningOn: aPortNumber
	server := TusLibrosServerController listeningOn: 8080 withAPI: systemFacade.
	
	server startListening.
	! !
!TusLibrosServerControllerXXX methodsFor: 'server' stamp: 'fz 11/21/2019 20:14:37'!
startServer
	server := TusLibrosServerController listeningOn: 8080 withAPI: systemFacade.
	
	server startListening.
	! !

	TusLibrosServerControllerXXX new!
!TusLibrosServerControllerXXX methodsFor: 'server' stamp: 'fz 11/21/2019 20:14:57' prior: 50839551!
startServer
	server := TusLibrosServerController listeningOn: 8080 withAPI: systemFacade.
	
	server startListening.! !

self startServer !
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 20:15:34' prior: 50839070!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/substrings' action:[:request | |substringsAsJson sentence substrings |
		
		[sentence := (request fields at:'sentence').
		substrings := tusLibrosAPI substrings: sentence.
		substringsAsJson:= WebUtils jsonEncode: (substrings).
		"request send200Response: (substringsAsJson)"
		request send200Response: (substringsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !

self stopServer !

self startServer !
!TusLibrosSystemFacade methodsFor: 'nil' stamp: 'fz 11/21/2019 20:26:27'!
catalog
	^catalog copy! !
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 20:27:23' prior: 50839568!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/catalog' action:[:request | |catalog|
		
		[catalog := tusLibrosAPI catalog.
		request send200Response: (catalog asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !

self startServer !

self stopServer !

self startServer !

self startServer !
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 20:28:52' prior: 50839668!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/catalog' action:[:request | |catalog|
		
		[catalog := tusLibrosAPI catalog.
		request send200Response: (catalog asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: ('asd') ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !

self stopServer.
self startServer !
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 20:29:31' prior: 50839759!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/catalog' action:[:request | |catalog|
		
		[catalog := tusLibrosAPI catalog.
		request send200Response: (catalog asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !
!TusLibrosServerControllerXXX methodsFor: 'initialize' stamp: 'fz 11/21/2019 20:30:39'!
restartAPI
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: salesBook
		debitingThrought: self 
		measuringTimeWith: clock.! !
!TusLibrosServerControllerXXX methodsFor: 'server' stamp: 'fz 11/21/2019 20:31:08' prior: 50839560!
startServer
	self restartAPI.
	server := TusLibrosServerController listeningOn: 8080 withAPI: systemFacade.
	
	server startListening.! !

self stopServer.
self startServer !

	TusLibrosServerControllerXXX new!
!TusLibrosServerControllerXXX methodsFor: 'server' stamp: 'fz 11/21/2019 20:31:42' prior: 50839947!
startServer
	self restartAPI.
	server := TusLibrosServerController listeningOn: 8080 withAPI: systemFacade.
	
	server startListening.! !

self startServer!

----SNAPSHOT----(21 November 2019 20:32:39) CuisUniversity-3938.image priorSource: 16237260!

----SNAPSHOT----(21 November 2019 20:32:49) CuisUniversity-3938.image priorSource: 16266043!

self startServer!

self stopServer.
self startServer!

self stopServer.
self startServer!

----SNAPSHOT----(21 November 2019 20:34:07) CuisUniversity-3938.image priorSource: 16266137!
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 20:34:52' prior: 50839848!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/catalog' action:[:request | |catalog|
		
		[catalog := tusLibrosAPI catalog.
		request send200Response: (catalog asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'word').
		letter := tusLibrosAPI firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		"request send200Response: (letterAsJson)"
		request send200Response: (letterAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'word').
		vowels := tusLibrosAPI vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		"request send200Response: (vowelsAsJson)"
		request send200Response: (vowelsAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'word').
		upperCasedWord := tusLibrosAPI toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		"request send200Response: (upperCasedWordAsJson)"
		request send200Response: (upperCasedWordAsJson asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
! !

self stopServer.
self startServer!
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 20:41:43' prior: 50839977!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/catalog' action:[:request | |catalog|
		
		[catalog := tusLibrosAPI catalog.
		request send200Response: (catalog asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/addToCart' action:[:request | |cartID book quantity|
		
		[cartID := (request fields at:'cartID').
		 book := (request fields at:'book').
		quantity := (request fields at:'quantity').
		
		tusLibrosAPI add: quantity of: book toCartIdentifiedAs: cartID.	
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	! !

self stopServer.
self startServer!

self stopServer.
self startServer!
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 20:45:25' prior: 50840067!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/catalog' action:[:request | |catalog|
		
		[catalog := tusLibrosAPI catalog.
		request send200Response: (catalog asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/listCart' action:[:request | |cartID|
		
		[cartID := (request fields at:'cartID').
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/addToCart' action:[:request | |cartID book quantity|
		
		[cartID := (request fields at:'cartID').
		 book := (request fields at:'book').
		quantity := (request fields at:'quantity').
		
		tusLibrosAPI add: quantity of: book toCartIdentifiedAs: cartID.	
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	! !

self stopServer.
self startServer!

self stopServer.
self startServer!

systemFacade !

self listCartIdentifiedAs: 1!

self listCartIdentifiedAs: 2!
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 20:48:50' prior: 50840125!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/catalog' action:[:request | |catalog|
		
		[catalog := tusLibrosAPI catalog.
		request send200Response: (catalog asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/listCart' action:[:request | |cartID|
		
		[cartID := (request fields at:'cartID') asNumber.
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/addToCart' action:[:request | |cartID book quantity|
		
		[cartID := (request fields at:'cartID').
		 book := (request fields at:'book').
		quantity := (request fields at:'quantity').
		
		tusLibrosAPI add: quantity of: book toCartIdentifiedAs: cartID.	
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	! !

self stopServer.
self startServer!
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 20:50:00' prior: 50840198!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/catalog' action:[:request | |catalog|
		
		[catalog := tusLibrosAPI catalog.
		request send200Response: (catalog asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/listCart' action:[:request | |cartID|
		
		[cartID := (request fields at:'cartID') asNumber.
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/addToCart' action:[:request | |cartID book quantity|
		
		[cartID := (request fields at:'cartID') asNumber.
		 book := (request fields at:'book').
		quantity := (request fields at:'quantity') asNumber.
		
		tusLibrosAPI add: quantity of: book toCartIdentifiedAs: cartID.	
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	! !

self stopServer.
self startServer!
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 20:51:37' prior: 50840268!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/catalog' action:[:request | |catalog|
		
		[catalog := tusLibrosAPI catalog.
		request send200Response: (catalog asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/listCart' action:[:request | |cartID|
		
		[cartID := (request fields at:'cartID') asNumber.
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/addToCart' action:[:request | |cartID book quantity|
		
		[cartID := (request fields at:'cartID') asNumber.
		 book := (request fields at:'book').
		quantity := (request fields at:'quantity') asNumber.
		
		tusLibrosAPI add: quantity of: book toCartIdentifiedAs: cartID.	
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/removeFromCart' action:[:request | |cartID book quantity|
		
		[cartID := (request fields at:'cartID') asNumber.
		 book := (request fields at:'book').
		quantity := (request fields at:'quantity') asNumber.
		
		tusLibrosAPI regressionTestFrom: quantity using: book stats: cartID.	
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	! !
!TusLibrosServerController methodsFor: 'initialization' stamp: 'fz 11/21/2019 20:52:30' prior: 50840339!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/catalog' action:[:request | |catalog|
		
		[catalog := tusLibrosAPI catalog.
		request send200Response: (catalog asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/listCart' action:[:request | |cartID|
		
		[cartID := (request fields at:'cartID') asNumber.
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/addToCart' action:[:request | |cartID book quantity|
		
		[cartID := (request fields at:'cartID') asNumber.
		 book := (request fields at:'book').
		quantity := (request fields at:'quantity') asNumber.
		
		tusLibrosAPI add: quantity of: book toCartIdentifiedAs: cartID.	
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/removeFromCart' action:[:request | |cartID book quantity|
		
		[cartID := (request fields at:'cartID') asNumber.
		 book := (request fields at:'book').
		quantity := (request fields at:'quantity') asNumber.
		
		tusLibrosAPI remove: quantity of: book toCartIdentifiedAs: cartID.	
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	! !

----SNAPSHOT----(21 November 2019 20:53:01) CuisUniversity-3938.image priorSource: 16266322!
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart ' stamp: 'fz 11/21/2019 20:55:05'!
test20CanRemoveItemsFromACreatedCartWithThatItem

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'fz 11/21/2019 20:57:12' prior: 50840520!
test20CanRemoveItemsFromACreatedCartWithThatItem

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 2 of: StoreTestObjectsFactory toCartIdentifiedAs: cartId.

	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'fz 11/21/2019 20:57:33' prior: 50840535!
test20CanRemoveItemsFromACreatedCartWithThatItem

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 2 of: StoreTestObjectsFactory itemSellByTheStore toCartIdentifiedAs: cartId.

	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1
		! !

self stopServer.!

----SNAPSHOT----(21 November 2019 21:00:57) CuisUniversity-3938.image priorSource: 16283683!

----QUIT----(21 November 2019 21:01:01) CuisUniversity-3938.image priorSource: 16285378!

----STARTUP---- (2 December 2019 18:05:31) as /home/flopy/Documents/ing/repo/cuis/CuisUniversity-3938.image!


self startServer.!

self stopServer.!

TusLibrosServerControllerBuilder new!
!TusLibrosServerController methodsFor: 'initialization' stamp: 'asd 12/2/2019 18:07:13' prior: 50840428!
initializeWith: aPortNumber withAPI: aTusLibrosAPI 

	tusLibrosAPI := aTusLibrosAPI.
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: aPortNumber.
	
	webServer addService: '/createCart' action:[:request | |user password cartID|
		[user := (request fields at:'user').
		password := (request fields at:'password').
		
		cartID := tusLibrosAPI createCartFor: user authenticatedWith: password.
		
		request send200Response: (cartID asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]
		].
	
	webServer addService: '/catalog' action:[:request | |catalog|
		
		[catalog := tusLibrosAPI catalog.
		request send200Response: (catalog asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/listCart' action:[:request | |cartID|
		
		[cartID := (request fields at:'cartID') asNumber.
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/addToCart' action:[:request | |cartID book quantity|
		
		[cartID := (request fields at:'cartID') asNumber.
		 book := (request fields at:'book').
		quantity := (request fields at:'quantity') asNumber.
		
		tusLibrosAPI add: quantity of: book toCartIdentifiedAs: cartID.	
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	
	webServer addService: '/removeFromCart' action:[:request | |cartID book quantity|
		
		[cartID := (request fields at:'cartID') asNumber.
		 book := (request fields at:'book').
		quantity := (request fields at:'quantity') asNumber.
		
		tusLibrosAPI remove: quantity of: book fromCartIdentifiedAs: cartID.	
		
		request send200Response: ((tusLibrosAPI listCartIdentifiedAs: cartID) asString asUtf8) 
				 contentType: 'application/json; charset=utf-8' do: [:resp | 
					resp headerAt: 'Access-Control-Allow-Origin' put: '*'.]
		 ] 
		on: Error 
		do: [ :anError |
			request send404Response: (anError messageText) ]].
	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'asd 12/2/2019 18:07:46' prior: 50840552!
test20CanRemoveItemsFromACreatedCartWithThatItem

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 2 of: StoreTestObjectsFactory itemSellByTheStore toCartIdentifiedAs: cartId.

	systemFacade remove: 1 of: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1
		! !

!testRun: #TusLibrosSystemFacadeTest #test20CanRemoveItemsFromACreatedCartWithThatItem stamp: 'asd 12/2/2019 18:07:48'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20CanRemoveItemsFromACreatedCartWithThatItem stamp: 'asd 12/2/2019 18:07:48'!
ERROR!
!StoreTestObjectsFactory class methodsFor: 'as yet unclassified' stamp: 'asd 12/2/2019 18:07:51'!
itemSellByTheStore
	self shouldBeImplemented.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'asd 12/2/2019 18:08:34' prior: 50840671!
test20CanRemoveItemsFromACreatedCartWithThatItem

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 2 of: testObjectsFactory itemSellByTheStore toCartIdentifiedAs: cartId.

	systemFacade remove: 1 of: self validBook fromCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1
		! !

!methodRemoval: StoreTestObjectsFactory class #itemSellByTheStore stamp: 'asd 12/2/2019 18:08:45'!
itemSellByTheStore
	self shouldBeImplemented.!

!testRun: #TusLibrosSystemFacadeTest #test20CanRemoveItemsFromACreatedCartWithThatItem stamp: 'asd 12/2/2019 18:08:54'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20CanRemoveItemsFromACreatedCartWithThatItem stamp: 'asd 12/2/2019 18:08:54'!
ERROR!
!TusLibrosSystemFacade methodsFor: 'as yet unclassified' stamp: 'asd 12/2/2019 18:09:05'!
remove: aSmallInteger of: aString fromCartIdentifiedAs: aSmallInteger3 
	self shouldBeImplemented.! !
!TusLibrosSystemFacade methodsFor: 'as yet unclassified' stamp: 'asd 12/2/2019 18:09:51' prior: 50840731!
remove: anAmount of: aBook fromCartIdentifiedAs: aCartId

	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession removeFromCart: anAmount of: aBook ]! !

!testRun: #TusLibrosSystemFacadeTest #test20CanRemoveItemsFromACreatedCartWithThatItem stamp: 'asd 12/2/2019 18:09:58'!
ERROR!
!CartSession methodsFor: 'as yet unclassified' stamp: 'asd 12/2/2019 18:10:04'!
removeFromCart: aSmallInteger of: aString 
	self shouldBeImplemented.! !
!CartSession methodsFor: 'as yet unclassified' stamp: 'asd 12/2/2019 18:10:29' prior: 50840750!
removeFromCart: anAmount of: aBook
	^cart remove: anAmount of: aBook! !

!testRun: #TusLibrosSystemFacadeTest #test20CanRemoveItemsFromACreatedCartWithThatItem stamp: 'asd 12/2/2019 18:10:31'!
ERROR!
!Cart methodsFor: 'as yet unclassified' stamp: 'asd 12/2/2019 18:10:34'!
remove: aSmallInteger of: aString 
	self shouldBeImplemented.! !
!Cart methodsFor: 'as yet unclassified' stamp: 'asd 12/2/2019 18:11:07' prior: 50840765!
remove: aQuantity of: anItem

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	aQuantity timesRepeat: [items remove: anItem].! !

!testRun: #TusLibrosSystemFacadeTest #test20CanRemoveItemsFromACreatedCartWithThatItem stamp: 'asd 12/2/2019 18:11:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanRemoveItemsFromACreatedCartWithThatItem stamp: 'asd 12/2/2019 18:11:14'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20CanRemoveItemsFromACreatedCartWithThatItem stamp: 'asd 12/2/2019 18:11:16'!
PASSED!

----SNAPSHOT----(2 December 2019 18:11:19) CuisUniversity-3938.image priorSource: 16285472!